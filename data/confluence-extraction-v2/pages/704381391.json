{
  "id": "704381391",
  "title": "104_【FIX】商品編集機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】商品マスタ（統合版） の登録済みのデータ1件を編集するための機能です。 3. 要求事項 管理画面にログインすることができるシステム管理者、塾ステーション管理者のみが本機能を利用することができる。 登録されている 【FIX】商品マスタ（統合版） 1件の登録済み情報を閲覧し、 本ページの「要件定義」-「入力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381391#4.2.-%E5%85%A5%E5%8A%9B ）で入力元が「入力フォーム」と定義されている項目 を編集することができる。 画面上には以下の項目を表示する 本ページの「要件定義」-「入力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381391#4.2.-%E5%85%A5%E5%8A%9B ）で入力元が「入力フォーム」と定義されている項目 の、保存された項目値が反映された入力フォーム 本ページの「要件定義」-「出力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381391#4.3.-%E5%87%BA%E5%8A%9B ）で出力先として「画面」が定義されている項目 の名称と保存された項目値 キャンセルボタン 保存ボタン キャンセルボタンを押下することで編集を取り消し、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/717455936 に遷移する。 保存ボタンを押下することで、編集した入力フォームの内容をデータベースに保存し、システム全体に適用する。 購 入可フラグが「可」と保存された商品は、下記の機能から新規に選択可能とし、「不可」と保存された商品は、選択不可とする。 全体管理画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/714637353 クライアント企業向け管理画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705527850 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705396812 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705265775 公開フラグが「公開」と保存された商品は、下記の機能で選択肢として表示され、「非公開」と保存された商品は、非表示とする。 クライアント企業向け管理画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705527850 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705396812 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705265775 3.1. 権限 システム管理者、塾ステーション管理者のみ 3.2. 帳票 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 の記載と同じ 3.3. メールテンプレート なし 3.4. ワークフロー https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 の記載と同じ 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 商品編集画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1855%3A31106&amp;t=D8l394sON9r4knNS-1 4.1.2. 商品編集完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1203%3A24101&amp;t=D8l394sON9r4knNS-1 4.2. 入力 変数名、説明、バリデーションは、 【FIX】商品マスタ（統合版） の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 に記載の共通入力・取得項目は項目自体を省略する。 「制限」に「必須」とある場合に入力がない場合のエラーメッセージは統一して「{項目名}を入力してください」とする。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 商品番号 URL または 隠しフォーム 編集する対象の商品を一意に指定する。 入力がない、または、自然数ではない、または指定のレコードがデータベースに存在しない場合 エラーメッセージは出力せずレスポンスステータスを404 not foundとする 2 購入可フラグ 入力フォーム 初期値＝データベースから読み込んだ値 必須 3 公開フラグ 入力フォーム 初期値＝データベースから読み込んだ値 必須 4 後継商品番号 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 その他は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381384 と同様とする。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381384 と同様とする。 5 メモ 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー「1000文字以内で入力」 4.3. 出力 説明は、 【FIX】商品マスタ（統合版） の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 に記載の共通出力項目は項目自体を省略する。 出力項目 出力先 説明 1 商品番号 画面 HTMLエスケープ処理をして出力する。 2 商品ID 画面 HTMLエスケープ処理をして出力する。 3 表示名称 画面 HTMLエスケープ処理をして出力する。 4 単価 画面 HTMLエスケープ処理をし、文頭に「&yen;」をつけた上で、3桁カンマ区切りにして出力する。例） &yen;1,000,000 5 税区分 画面 保存された値が指し示す選択肢のラベルを出力する。 6 税率 画面 HTMLエスケープ処理をして出力する。 7 課税後単価 画面 単価、税区分、税率に応じて画面上で自動計算して 、文頭に「&yen;」をつけた上で、3桁カンマ区切りにして出力する。例） &yen;1,000,000 8 単位 画面 HTMLエスケープ処理をして出力する。 9 商品種別 画面 保存された値が指し示す選択肢のラベルを出力する。 10 課金形態種別 画面 保存された値が指し示す選択肢のラベルを出力する。 11 オプション種別 画面 保存された値が指し示す選択肢のラベルを出力する。 12 採用課金：雇用形態 画面 保存された値が指し示す選択肢のラベルを出力する。 13 採用課金：確定時期 画面 保存された値が指し示す選択肢のラベルを出力する。 14 請求タイミング 画面 保存された値が指し示す選択肢のラベルを出力する。 15 有効期間：有無フラグ 画面 保存された値が指し示す選択肢が選択された状態として出力する。 16 有効期間：月数 画面 HTMLエスケープ処理をして出力する。 17 契約可能月 画面 保存された複数の値が指し示す選択肢のラベルを全て出力する。 18 対象サイト 画面 保存された値が指し示す選択肢のラベルを出力する。 19 付与プラン 画面 保存された値が指し示す選択肢のラベルを出力する。 20 急募追加数 画面 HTMLエスケープ処理をし、文頭に3桁カンマ区切りにして出力する。例） 1,000,000 21 パーソナルオファー追加数 画面 HTMLエスケープ処理をし、文頭に3桁カンマ区切りにして出力する。例） 1,000,000 22 購入可フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 23 公開フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 24 商品詳細1 画面 HTMLエスケープ処理をして出力する。 25 商品詳細2 画面 HTMLエスケープ処理をして出力する。 26 商品詳細3 画面 HTMLエスケープ処理をして出力する。 27 商品詳細4 画面 HTMLエスケープ処理をして出力する。 28 前任商品 画面 本レコードを後継商品として紐づけている商品の情報を、HTMLエスケープ処理をして出力する。 29 後継商品番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 30 メモ データベース/画面 画面の対象フォーム内に 入力された改行を維持したまま HTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 31 作成者 画面 保存された管理者IDが示すユーザーの名前を表示する。 32 作成日時 画面 YYYY/mm/dd H:i:s形式の文字列で出力する。 33 最終更新者 画面 保存された管理者IDが示すユーザーの名前を表示する。 34 最終更新日時 画面 YYYY/mm/dd H:i:s形式の文字列で出力する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 URL文字列または隠しフォーム入力から商品番号文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定された商品番号でデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 編集フォーム画面表示処理 該当するレコードが見つかったら、「出力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381391#4.3.-%E5%87%BA%E5%8A%9B ） に記載の通り、表示項目と入力可能項目に項目値を反映させて画面を出力し処理を終了する。 4.4.2. 編集処理 該当するレコードが見つかったら、「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381391#4.2.-%E5%85%A5%E5%8A%9B ） に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で編集フォーム画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 該当のレコードの保存した情報を閲覧できる https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/717455936 へリダイレクトし処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 編集画面に遷移した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} started to update service . service_number={商品番号} service_id={商品ID} service_name={表示名称} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 編集処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} updated service . service_number={商品番号} service_id={商品ID} service_name={表示名称} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to update service . service_number={商品番号} service_id={商品ID} service_name={表示名称} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. 制限事項 同時編集に対する明示的な対策は施さない。 同時に編集が実行された際は後勝ちとし、後から保存ボタンを押して実行した時の編集値が適用される。 編集画面において他のユーザーまたは他のウィンドウ・タブが本機能にアクセスしたことをアプリケーションは検知しない。",
  "parentId": "704676285",
  "parentTitle": "100_【FIX】商品管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704381391/104_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-10-01T00:20:18.834Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】商品マスタ（統合版） の登録済みのデータ1件を編集するための機能です。 3. 要求事項 管理画面にログインすることができるシステム管理者、塾ステーション管理者のみが本機能を利用することができる。 登録されている 【FIX】商品マスタ（統合版） 1件の登録済み情報を閲覧し、 本ページの「要件定義」-「入力」欄（ https://giginc.atlassi..."
}