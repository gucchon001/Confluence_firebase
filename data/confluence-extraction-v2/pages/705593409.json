{
  "id": "705593409",
  "title": "622_【FIX】契約詳細閲覧機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】契約情報（統合版） の登録済みのデータの1件を閲覧するための機能です。 3. 要求事項 クライアント企業管理画面にログインすることができるクライアント企業管理者のみが利用することができる。 ただし自身の企業に紐づかない契約は閲覧できない。 本機能は 【FIX】契約情報（統合版） に記載の項目について、1URL=1レコードで保存された値を表示して閲覧することができる。以下「本ページ」と記載する。 本ページには、以下を表示する 一覧に戻るボタン 押下することで https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705462380 に遷移 することができる。 更新用契約の作成ボタン 「基本」の商品に紐づく契約の場合のみボタンが表示され、押下することで 623_【作成中】契約更新機能 に遷移することができる。 本ページの「要件定義」-「出力」欄で出力先として「画面」が定義されている項目 その契約に紐づく請求書PDFの一覧。出力する内容は本ページの「要件定義」-「出力」-「請求書PDF」欄で出力先として「画面」が定義されている項目とする。 存在しない契約が指定された場合は対象URLのページが存在しないように振る舞う。 3.1. 権限 要求事項の記載に同じ。 3.2. 帳票 概要に同じ。 3.3. メールテンプレート なし 3.4. ワークフロー 契約関連全体フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=70920-98161&amp;mode=design&amp;t=BOVjD2JKRibUdIrA-4 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 契約番号 URLパラメータ 閲覧する契約を一意に指定するための番号 入力がない、または、自然数ではない、またはデータベースに存在しない場合 エラーメッセージは出力せずレスポンスステータスを404 not foundとする 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 出力項目 出力先 説明 1 契約番号 画面 HTMLエスケープ処理をして出力する。 2 教室グループ 画面 保存された値が指し示す教室グループを「[教室グループID_[教室グループ名]」形式で出力する。 3 サービス種別 画面 保存された値が指し示すラベル名を出力する。 4 契約種別 画面 保存された「商品種別」の値が指し示すラベル名を出力する。 5 商品名称 画面 保存された値が指し示すラベル名を出力する。 6 商品詳細種別 商品概要 画面 保存された商品の種別（課金形態種別・オプション種別）の値が指し示すラベル名を出力する。「基本」の場合は「更新料」と表示する。 7 商品単価 画面 保存された値を、3桁ずつでコンマで切り、先頭に「&yen;」を付ける形で出力する。 8 数量 画面 保存された値を表示する。 9 総額 画面 保存された「商品単価」&times;「数量」の値を、3桁ずつでコンマで切り、先頭に「&yen;」を付ける形で出力する。 ただし、該当の契約の「無料フラグ」が有効な場合、「&yen;0（無料期間）」と表示する。 10 締結日 画面 yyyy年mm月dd日形式の文字列で出力する。 11 有効期間 画面 「yyyy年mm月dd日 hh:mm:ss 〜 yyyy年mm月dd日 hh:mm:ss」形式の文字列で表示する。 12 ステータス 画面 無効化日時の値が保存されてない場合は「有効」と出力する。 無効化日時値が保存されている場合は「[有効フラグ]（[無効化日時]）」形式で出力する。無効化日時は「yyyy年mm月dd日 hh:mm:ss」形式とする。 13 更新意向 画面 保存された「更新辞退フラグ」が有効状態の場合のみ「更新しない」と表示する。 基本契約の場合のみ表示し、その他の契約の場合は項目自体を表示しない。 4.3.1. 請求書PDF 出力項目 出力先 説明 1 請求書PDF配列 画面 指定されたフィルタリングを適用してデータベースから抽出した請求書PDF情報レコードの配列をページ上に表示する。各レコードの表示データは以下「請求書PDF情報：」プレフィックスで始まる出力項目として説明する。 2 請求書PDF情報：ファイル名 画面 HTMLエスケープ処理をして出力する。テキストリンクとし、押下すると https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/721027374 を実行する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合はクライアント企業管理者画面のログイン画面にリダイレクトする。 URL文字列から入力された契約番号文字列を取得し、契約番号文字列が自然数に変換できない場合、レスポンスステータス404 not foundを出力して処理を終了する。 契約番号文字列を元にデータベースから 【FIX】契約情報（統合版） を取得する。対象の契約番号のデータが存在しない場合、レスポンスステータス404 not foundを出力して処理を終了する。 対象の契約番号のデータが存在したら、本ページの出力欄の記載の通り、値に適切な変換処理を行ったのちに画面を出力し処理を終了する。 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 詳細画面を表示した場合に下記フォーマットでログを出力する User {クライアント企業管理者のユーザー番号} read contract detail. company_number={企業番号} contract_number={契約番号} {URI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "705265775",
  "parentTitle": "620_■契約管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/705593409/622_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-17T08:01:54.426Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】契約情報（統合版） の登録済みのデータの1件を閲覧するための機能です。 3. 要求事項 クライアント企業管理画面にログインすることができるクライアント企業管理者のみが利用することができる。 ただし自身の企業に紐づかない契約は閲覧できない。 本機能は 【FIX】契約情報（統合版） に記載の項目について、1URL=1レコードで保存された値を表示して閲覧するこ..."
}