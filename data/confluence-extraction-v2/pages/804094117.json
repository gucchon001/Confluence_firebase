{
  "id": "804094117",
  "title": "177_【FIX】求人削除機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】求人：基本情報 【FIX】求人：勤務条件・指導科目 【FIX】求人：応募条件・研修情報 【FIX】求人：応募情報等 【FIX】求人：PR情報 の登録済みのデータの1件を削除するための機能です。 また求人削除による影響は 【レビュー中】レコード削除時の動作一覧 にて列挙している。 3. 要 求事項 全体管理画面にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者のみが、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709296160 の画面から企業を削除できる。 ページの該当レコード内にある削除用ボタンを押下すると 削除確認モーダルを表示する。削除確認モーダルには以下の情報を表示する。 削除確認用モーダルには、本ページの「要件定義」-「出力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/804094117#4.3.-%E5%87%BA%E5%8A%9B ）で出力先として「画面」が定義されている項目を表示する。 削 除確認モーダル上 で削除実行用のボタンを押下すると、 以下の条件のいずれかを満たす 場合に、対象の求人情報を論理削除することができる。 対象の求人が「非掲載」状態である。 対象の求人に対しての 【FIX】応募情報 が存在しない。 対象の求人に対しての 【FIX】応募情報 は存在するが、その「採用ステータス（クライアント企業）」の値が「未登録」または「保留」のものが存在しない。 対象の求人に対しての 【FIX】応募情報 は存在するが、その「採用ステータス（クライアント企業）」の値が全て「採用」で、全ての「採用決定日」から1年以上が過ぎている。 削除確認モーダル上で削除実行用のボタンを押下すると、以下の条件の すべてを 満たす場合に、対象の求人情報を論理削除することができる。 対象の求人が「非掲載」状態である。 下記の いずれか を満たす。 対象の求人に対しての 【FIX】応募情報 が存在しない。 対象の求人に対しての 【FIX】応募情報 は存在するが、「採用ステータス（クライアント企業）」が「未登録」「保留」のものや、「採用」であり「採用決定日」から1年以内のものが存在しない。 削除に成功すると、削除されたことがわかる表示がされると同時に、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709296160 ページへ遷移する。削除に失敗した場合は、「求人を削除できませんでした」というエラーメッセージ と削除に失敗した理由をそれぞれ以下の通り ダイアログで表示する。（規制は要件定義で定義する。） 「掲載」状態のため、削除できません。 未完了の応募情報が存在するため、削除できません。 削除完了したら エリア平均給与算出共通処理 を実行する。 全体管理者情報は削除時に本ページの「要件定義」-「出力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/804094117#4.3.-%E5%87%BA%E5%8A%9B ）で説明欄に匿名化する旨の記載がある項目の匿名化を行う。 削除後は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709296160 ページから非表示となる。 削除に 成功または失敗 した場合、以下の情報が入ったログを出力する。 削除日時、削除操作を実施した全体管理者のユーザー番号、削除された求人の求人番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 全体管理画面にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者のみ 3.2. 帳票 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053484 の記載と同じ 3.3. メールテンプレート なし 3.4. ワークフロー https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053484 の記載と同じ 3.4.1. 本機能 3.4.2. 関連 4. 要件定義 4.1. ユーザーインターフェース（画面） 削除の確認を求めるポップアップ https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=14298-67933&amp;mode=design&amp;t=C3AyYMJepqMR8BFn-4 削除完了ポップアップ https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=8515-63569&amp;mode=design&amp;t=C3AyYMJepqMR8BFn-4 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 求人番号 入力フォーム（隠しフォーム） 削除する対象の 【FIX】求人：基本情報 の求人番号 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 出力項目 出力先 説明 1 求人番号 画面 HTMLエスケープ処理をして出力する。 2 教室名 画面 【FIX】求人：基本情報 で登録されている教室番号に紐ずく教室名を、HTMLエスケープ処理をして出力する。 3 求人タイトル 画面 HTMLエスケープ処理をして出力する。 4 採用担当者 データベース データベースへの保存時に匿名化する。 5 削除者 データベース 【作成中】帳票共通項目 に従う。 6 削除日時 データベース 【作成中】帳票共通項目 に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 隠しフォームから取得した求人番号の文字列を取得し、自然数に変換できない場合、レスポンスステータス404 not foundを出力して処理を終了する。 求人番号の文字列を元にデータベースから 【FIX】求人：基本情報 【FIX】求人：勤務条件・指導科目 【FIX】求人：応募条件・研修情報 【FIX】求人：応募情報等 【FIX】求人：PR情報 を取得 する。対象の求人番号のデータが存在しない場合、レスポンスステータス404 not foundを出力して処理を終了する。 削除対象の求人番号が存在し、以下の条件のすべてを満たす場合に、 【FIX】求人：基本情報 【FIX】求人：勤務条件・指導科目 【FIX】求人：応募条件・研修情報 【FIX】求人：応募情報等 【FIX】求人：PR情報 を 論理削除とし、削除時間のみを記録し処理を終了する。 対象の求人が「非掲載」状態である。 下記のいずれかを満たす。 対象の求人に対しての 【FIX】応募情報 が存在しない。 対象の求人に対しての 【FIX】応募情報 は存在するが、「採用ステータス（クライアント企業）」が「未登録」「保留」のものや、「採用」であり「採用決定日」から1年以内のものが存在しない。 削除が完了したポップアップを表示し、成功ログを出力する。 なお削除時の影響範囲については https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/772014210#2.-%E5%89%8A%E9%99%A4%E6%99%82%E3%81%AE%E5%8B%95%E4%BD%9C%E4%B8%80%E8%A6%A7 にて まとめている 。 4.5. エラー処理 途中で削除に失敗した場合は、それまでに削除した帳票は元に戻してエラーを表示する。 削除に失敗した理由をエラーとして表示する。 設定ファイルが存在しない、データベースにテーブル・フィールドが存在しない、メールテンプレートファイルが存在しない場合はプログラム上で特別な処理を行わず、Laravelの例外出力に任せる。 4.6. ログ 企業管理者の削除に成功した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} deleted job. job_number={求人番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 企業管理者の削除に失敗した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} failed to delete job. job_number={求人番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "704053484",
  "parentTitle": "170_【要求FIX】求人管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/804094117/177_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-17T02:44:39.456Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】求人：基本情報 【FIX】求人：勤務条件・指導科目 【FIX】求人：応募条件・研修情報 【FIX】求人：応募情報等 【FIX】求人：PR情報 の登録済みのデータの1件を削除するための機能です。 また求人削除による影響は 【レビュー中】レコード削除時の動作一覧 にて列挙している。 3. 要 求事項 全体管理画面にログインすることができるシステム管理者、塾講..."
}