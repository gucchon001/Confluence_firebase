{
  "id": "703660123",
  "title": "013_【FIX】求人キープ機能",
  "content": "1. 目次 2. 概要 本機能はエンドユーザーが 【レビュー中】求人キープ帳票 のデータを編集するためのAPIです。 本機能はログイン状態に関わらず使用できるが、ログイン時とログインしていない状態では挙動が異なる。 3. 要求事項 ログインしていない場合 キープの追加 Cookie に保存し、 有効期限は365日とする 。また最大登録数は20件とする。 21件目を登録しようとするとログインを促すポップアップを表示する。ポップアップには 042_【FIX】会員ログイン・ログアウト機能 への導線を設置する。 キープの削除 Cookieから該当のキープ情報を削除する。 ログインしている場合 サービスサイトからキープボタンを押下した際に呼び出すAPIとして実装する。 キープの追加 エラーがなければ、入力された「求人番号」と「追加時間」の値をキープ求人リストに追加する。 101件目を登録しようとするとそれ以上登録できないことを示すポップアップを表示する。ポップアップには 057_キープした求人一覧閲覧機能 への導線を設置する。 キープの削除 エラーがなければ、入力された「求人番号」と「ユーザー番号」の値のセットに合致するものがキープ求人リストにあればそれを削除する。 Cookieにキープ情報がある状態でログインした場合 Laravelのイベントを使用し、ログインイベントのときにCookieにキープ求人のデータが保存されていることが確認できればデータベースに登録処理を行う。 なお登録されたキープ求人の一覧は 057_キープした求人一覧閲覧機能 にて 閲覧できる 。 3.1. 権限 サービスサイトを利用するエンドユーザーがログイン状態に関わらず利用できる 3.2. 帳票 【レビュー中】求人キープ帳票 3.3. メールテンプレート なし 3.4. ワークフロー 3.4.1. 本機能 3.4.2. 関連 【FIX】ユーザー登録・退会フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） 登録上限到達通知ポップアップ（ログイン時） https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=70336-73762&amp;mode=design&amp;t=IbnbkrzSSgUBgUtU-4 登録上限到達通知ポップアップ（非ログイン時） https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=70336-73777&amp;mode=design&amp;t=IbnbkrzSSgUBgUtU-4 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 ログインしていない場合 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 求人番号 JSONボディ 操作する対象の求人の 【FIX】求人：基本情報 における求人番号 2 ユーザー番号 JSONボディ 操作しているユーザーの 【FIX】会員：アカウント情報 におけるユーザー番号 ログインしている場合 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 求人番号 JSONボディ 操作する対象の求人の 【FIX】求人：基本情報 における求人番号 2 ユーザー番号 JSONボディ 操作しているユーザーの 【FIX】会員：アカウント情報 におけるユーザー番号 4.3. 出力 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/811499640/API#1.1.-CRUD%E5%85%B1%E9%80%9A%E5%87%BA%E5%8A%9B を常に含める。また説明は、 【レビュー中】求人キープ帳票 の記載を前提とし、本ページに固有の特記事項のみ記載する。 出力項目 出力先 説明 1 求人番号 データベース エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 2 ユーザー番号 データベース エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 3 追加日時 データベース エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合はログイン認証エラーとする。 入力欄 に記載の項目の入力処理をおこなう。 出力欄 に記載した出力項目を出力する。 4.4.1. フラグ切り替え処理 該当するキープ求人レコードが見つかったら、 入力欄 に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーを返し処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっているユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 編集が完了したことが分かるボタン切り替え表示 を操作元の画面上で表示して処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ キープへの追加処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {ユーザー番号} added a job bookmark . job_number={求人番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {ユーザー番号} failed to add a job bookmark. job_number={求人番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} キープからの削除処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {ユーザー番号} deleted a job bookmark. job_number={求人番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {ユーザー番号} failed to delete a job bookmark. job_number={求人番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "703561854",
  "parentTitle": "010_■求人・教室管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/703660123/013_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-12-01T02:41:59.609Z",
  "author": "元ユーザー (Deleted)",
  "excerpt": "1. 目次 2. 概要 本機能はエンドユーザーが 【レビュー中】求人キープ帳票 のデータを編集するためのAPIです。 本機能はログイン状態に関わらず使用できるが、ログイン時とログインしていない状態では挙動が異なる。 3. 要求事項 ログインしていない場合 キープの追加 Cookie に保存し、 有効期限は365日とする 。また最大登録数は20件とする。 21件目を登録しようとするとログインを促すポ..."
}