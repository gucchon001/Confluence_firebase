{
  "id": "704479532",
  "title": "272_【FIX】請求新規作成機能",
  "content": "1. 目次 2. 概要 本機能は 【修正中】請求：基本情報 の新規データを1件を新規登録するための機能です。 3. 要求事項 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみが、 【修正中】請求：基本情報 のデータを新規登録することができる。 新規登録にあたって入力フォームに表示し入力可能とする項目は下記とする。 本ページの「要件定義」-「入力」欄で入力元が「入力フォーム」と定義されている項目 「登録する」ボタン 「登録する」ボタンを押下すると、入力項目に問題なければ、データベースにレコードを保存し、 273_【FIX】請求詳細閲覧機能 ページへ遷移して、保存したことが利用者にわかるメッセージを表示する。 入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるかわかるようにエラーメッセージを表示する。 「キャンセル」ボタン 押下すると登録はせずに 271_【FIX】請求一覧閲覧・検索機能 へ遷移する。 新規登録で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、管理者ID( 【FIX】全体管理者登録情報 のユーザー番号)、請求番号( 【修正中】請求：基本情報 の請求番号)、アクセス元IPアドレス、ユーザーエージェント 3.1. 権限 要求の記載に従う 3.2. 帳票 【修正中】請求：基本情報 3.3. メールテンプレート なし 3.4. ワークフロー 270_■請求管理機能 の記載と同じ 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 新規作成 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=75751-19326&amp;mode=design&amp;t=LwpebP8I5JFGl7Od-0 4.1.2. 作成完了 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=75751-19372&amp;mode=design&amp;t=LwpebP8I5JFGl7Od-0 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 請求先・振込先マスタ 対象企業 入力フォーム 初期値なし 「企業番号_企業名」を選択肢とするコンボボックスとする。 企業名を入力することによるサジェスト（ 121-2_【FIX】企業検索API 利用）で企業（企業番号）を選択できる。 必須 2 請求先・振込先マスタ 入力フォーム 初期値なし 「マスタ番号_名称」を選択肢とするセレクトボックスとする。 必須 請求先・振込先マスタ対象企業が選択されて初めて請求先マスタのフィールドが入力可能になる。 請求先・振込先マスタ対象企業に紐づく請求先・振込先マスタだけが選択肢として表示される。 3 請求対象年月：年 &nbsp; 入力フォーム 初期値なし 「2021年」以降から「処理時点の年」の期間の中の選択肢とする。 必須 4 請求対象年月：月 &nbsp; 入力フォーム 初期値なし 必須 5 備考 &nbsp; 入力フォーム 初期値なし 6 請求に関してのお知らせ &nbsp; 入力フォーム 初期値なし 7 管理メモ 入力フォーム 初期値なし 8 【作成中】帳票共通項目 で定める項目を持つ。 9 【作成中】帳票共通項目 で定める項目を持つ。 10 【作成中】帳票共通項目 で定める項目を持つ。 11 【作成中】帳票共通項目 で定める項目を持つ。 12 【作成中】帳票共通項目 で定める項目を持つ。 13 【作成中】帳票共通項目 で定める項目を持つ。 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 出力先 説明 1 請求先・振込先マスタ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 2 請求対象年月：年 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 3 請求対象年月：月 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 4 備考 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 請求に関してのお知らせ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 6 管理メモ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 7 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 8 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 9 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 10 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 4.4.1. 入力画面表示処理 本ページの「入力」に記載の全ての項目の入力フォームと登録ボタンを配置した画面を表示する。 4.4.2. 新規登録処理 入力フォームからのデータを受け取り、「入力」の定義にしたがって値の妥当性検査をおこなう。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、作成日時、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を作成者/更新者に設定した上でデータベースに新規レコードとして挿入する。 273_【FIX】請求詳細閲覧機能 ページへリダイレクトする。 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 新規登録画面を表示した場合に下記フォーマットでログを出力する。 User {全体管理者のユーザー番号} started to create invoice. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 新規登録処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} created invoice. invoice_number={請求番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {全体管理者のユーザー番号} failed to create invoice. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "704414005",
  "parentTitle": "270_■請求管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704479532/272_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-03-15T04:21:54.674Z",
  "author": "isamu saito",
  "excerpt": "1. 目次 2. 概要 本機能は 【修正中】請求：基本情報 の新規データを1件を新規登録するための機能です。 3. 要求事項 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみが、 【修正中】請求：基本情報 のデータを新規登録することができる。 新規登録にあたって入力フォームに表示し入力可能とする項目は下記とする。 本ページの「要件定義」-「入力」欄で入力元が「入力フォーム」と定..."
}