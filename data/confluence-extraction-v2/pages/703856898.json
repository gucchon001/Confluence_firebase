{
  "id": "703856898",
  "title": "444_【FIX】管理者情報編集機能",
  "content": "1. 目次 2. 概要 登録した全体管理者情報を、全体管理画面の https://giginc.atlassian.net/wiki/pages/resumedraft.action?draftId=703856898 で編集するための機能。 3. 要求事項 441_【FIX】管理者一覧閲覧機能 ページの編集する用ボタンを押下すると、 https://giginc.atlassian.net/wiki/pages/resumedraft.action?draftId=703856898 へ遷移する。 ただし 、操作している全体管理者自身の情報は編集不可とし、 441_【FIX】管理者一覧閲覧機能 においても編集用ボタンを配置しない。自身の情報を編集したい場合は、他の全体管理者に編集してもらうか、 452_【作成中】アカウント設定編集機能 を利用することとする。 全体管理者情報を編集し、更新する用ボタンを押下することで、変更を保存することができる。 全体管理者情報編集用ページで閲覧/編集できる情報は以下とする。尚、以下の他は 【FIX】全体管理者登録情報 に記載の内容に準ずる。 本ページの「要件定義」-「入力」 （ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/703856898#4.2.-%E5%85%A5%E5%8A%9B ）で入力元として「入力フォーム」が定義されている項目 メールアドレス変更用ボタンを押下すると、 454_メールアドレス変更機能 へ遷移する。 更新する用ボタンを押下すると入力項目に問題なければ、更新されたことが分かる表示がされると同時に、 441_【FIX】管理者一覧閲覧機能 へ遷移する。問題があればエラーメッセージが表示される。（入力規制は要件定義で定義する。） 全体管理者情報編集で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、編集を実施した全体管理者のユーザー番号、編集対象の全体管理者のユーザー番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 システム管理者のみが、全体管理者情報を編集することができる。 3.2. 帳票 【FIX】全体管理者登録情報 3.3. メールテンプレート なし 3.4. ワークフロー 【FIX】全体管理者登録・削除フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 管理者情報編集画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1806%3A29451&amp;t=r3IqqflxoqksJqnt-1 4.1.2. 管理者情報更新完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1806-29437&amp;mode=design&amp;t=1SHhS7Wt9wd3dII3-0 4.2. 入力 変数名、説明、バリデーションは、 【FIX】全体管理者登録情報 の記載を前提とし、本ページに固有の特記事項のみ記載する。 440_【FIX】管理者管理機能 に記載の共通入力・取得項目は項目自体を省略する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 ユーザー番号 隠しフォーム 編集対象のレコードを特定するID 2 管理者種別 &hellip; 入力フォーム 初期値＝データベースから読み込んだ値 必須 3 IPアドレス制限 入力フォーム 初期値＝データベースから読み込んだ値 必須 4 氏名 入力フォーム 初期値＝データベースから読み込んだ値 必須 5 氏名（フリガナ） 入力フォーム 初期値＝データベースから読み込んだ値 必須 6 ニックネーム 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー「20文字以下文字以内で入力」 必須 7 PR 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー「 1000文字以内で入力 」 8 自己紹介ページURL 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー 「255文字以内で入力」 9 画像 入力フォーム 初期値＝データベースから読み込んだ値 4.3. 出力 説明は、 【FIX】全体管理者登録情報 の記載を前提とし、本ページに固有の特記事項のみ記載する。 440_【FIX】管理者管理機能 に記載の共通出力項目は項目自体を省略する 出力項目 出力先 説明 1 メールアドレス 画面 HTMLエスケープ処理をして出力する。 2 管理者種別 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 3 IPアドレス制限 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 4 氏名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 氏名（フリガナ） データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 6 ニックネーム データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 7 PR データベース/画面 画面の対象フォーム内に入力された改行を維持したままHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 8 自己紹介ページURL データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 9 画像 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に出力、エラーがない場合はデータベースに保存する。 10 更新者 データベース 【作成中】帳票共通項目 に従う 11 更新日時 データベース 【作成中】帳票共通項目 に従う 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 URL文字列または隠しフォーム入力から商品番号文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定された商品番号でデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 編集フォーム画面表示処理 該当するレコードが見つかったら、「出力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/703856898#4.3.-%E5%87%BA%E5%8A%9B ） に記載の通り、表示項目と入力可能項目に項目値を反映させて画面を出力し処理を終了する。 4.4.2. 編集処理 該当するレコードが見つかったら、「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/703856898#4.2.-%E5%85%A5%E5%8A%9B ） に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で編集フォーム画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 該当のレコードの保存した情報を閲覧できる 441_【FIX】管理者一覧閲覧機能 へリダイレクトし処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 全体管理者編集画面 を表示した場合に下記フォーマットでログを出力する。 User {操作を実行する全体管理者のユーザー番号} started to update administrator. user_number={ 編集対象の全体管理者の ユーザー番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 編集処理を実行した場合に下記フォーマットでログを出力する 成功 User {操作を実行する全体管理者のユーザー番号} update administrator. user_number={編集対象の全体管理者のユーザー番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗 User {操作を実行する全体管理者のユーザー番号} failed to update administrator. user_number={編集対象の全体管理者のユーザー番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. 制限事項 同時編集に対する明示的な対策は施さない。 同時に編集が実行された際は後勝ちとし、後から保存ボタンを押して実行した時の編集値が適用される。 編集画面において他のユーザーまたは他のウィンドウ・タブが本機能にアクセスしたことをアプリケーションは検知しない。",
  "parentId": "703791312",
  "parentTitle": "440_【FIX】管理者管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/703856898/444_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-08-09T00:43:44.495Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 登録した全体管理者情報を、全体管理画面の https://giginc.atlassian.net/wiki/pages/resumedraft.action?draftId=703856898 で編集するための機能。 3. 要求事項 441_【FIX】管理者一覧閲覧機能 ページの編集する用ボタンを押下すると、 https://giginc.atlassian.net/wi..."
}