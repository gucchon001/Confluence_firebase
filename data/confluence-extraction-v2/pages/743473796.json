{
  "id": "743473796",
  "title": "742_【作成中】自動オファー送信バッチ",
  "content": "1. 概要 自動オファー対象の会員にオファーを送信する。 2. 要求事項 コマンドラインで実行できるものとする。 本バッチは毎日10:00(JST)に自動実行するように設置する。 バッチ処理を開始したらバッチ処理を開始した旨のメッセージと現在日時を含むログを出力する。 有効な契約を持つすべての企業において、以下の処理を行う。 企業番号の下1桁にて、その日の送信対象となる企業を絞り込む。絞り込みロジックは下記の通りとする。 「0-9」の中から、連続した数値を3つ選択する。（数値の選択時、前回の送信対象と被らないように「前回の選択数値の最後の要素 + 1」から開始する） 選択された数値と企業番号の下1桁がマッチする企業が、その日の自動オファー送信の対象となる。 例えば下記の様になる。 1日目 [1, 2, 3] 2日目 [4, 5, 6] 3日目 [7, 8, 9] 4日目 [0, 1, 2] 5日目 [3, 4, 5] 6日目 [6, 7, 8] 7日目 [9, 0, 1] 下記の条件に該当する会員に対する自動オファー（ 【FIX】オファー履歴 および 【作成中】オファー履歴グループ ）を登録する。 該当企業の 【FIX】オファー設定情報（自動オファー） の条件を満たす。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/686686292 の 条件を満たす 。 【レビュー中】会員：設定情報（オファー・メール） にて自動オファーを利用する設定にしている。 【FIX】会員：設定情報（オファー拒否企業） にて該当企業を拒否対象として登録していない。 最終ログイン日時が過去5年以内、または登録日時が過去5年以内の会員のみを対象とする。 自動オファーの登録が完了すると、登録した会員の内、自動オファーの通知を受信する設定している（ 【レビュー中】会員：設定情報（オファー・メール） にて「メール受信フラグ：マッチ通知」を「利用する」にしている）会員に対して、 【FIX】自動オファー受信通知メール（会員宛） を送信する。 【FIX】自動オファー受信通知メール（会員宛） の本文には一回の自動オファー（本バッチ１回実行）あたりの、１会員に対する該当自動オファー企業数が記載されるため、すべての企業のオファー登録処理が完了後に集計してメール送信処理を実施する。 ただし、 無効メールアドレス に該当するならばメール送信処理は行わず https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/851673282/FIX#%E8%AB%8B%E6%B1%82%E6%9B%B8PDF%E9%80%9A%E7%9F%A5%E7%B3%BB%E3%83%90%E3%83%83%E3%83%81-%E3%83%90%E3%82%A6%E3%83%B3%E3%82%B9%E3%83%A1%E3%83%BC%E3%83%AB%E3%81%AB%E3%82%88%E3%82%8B%E9%80%81%E4%BF%A1%E5%A4%B1%E6%95%97%E9%80%9A%E7%9F%A5%E3%83%A1%E3%83%BC%E3%83%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88 に記載のログ記載メールを出力する。 バウンスメールアドレスに該当しない場合、メール送信を実行する。 メール送信成功時にログを出力する。 連続してメール送信する場合は、各メールごとに0.1秒間スリープ処理を行う。 メール送信が失敗した場合はリトライ処理を行わない。 バッチ処理終了時には、バッチ処理が終了した旨のメッセージと終了日時を含んだログを出力する。 必達終了時間15:00(JST)までの5時間以内に最大50,000件の処理を行えるパフォーマンスを確保する。 本機能からメールを送信した際、 【作成中】メール送信履歴 を保存する。 2.1. メールテンプレート 【FIX】自動オファー受信通知メール（会員宛） 2.2. ワークフロー 3. 要件定義 3.1. 入力 3.2. 出力 3.3. 処理 3.4. エラー処理 下記通知先にエラーログ通知を行う。 【FIX】バッチエラー時通知先 3.5. ログ バッチ略称はsend_auto_offer (SAO) とする。 バッジ処理全体が開始した時と終了した時に以下のログを出力する。 開始時 [742_SAO] Started at {処理開始日時}. 終了時 [742_SAO] Finished at {処理終了日時}. オファー登録時 成功時 [742_SAO] Succeeded to create auto offer. offer_number={オファー履歴番号} time={現在時刻}. 失敗時 [742_SAO] Failed to create auto offer. company_number={企業番号} user_number={会員番号} time={現在時刻}. メール送信処理 成功時 [742_SAO] Succeeded to send auto offer notification email. offer_number={オファー履歴番号} time={現在時刻}. 失敗時 [742_SAO] Failed to send auto offer notification email. offer_number={オファー履歴番号} time={現在時刻}. 4. スコープ外・制限事項 - 関連チケット CTJ-4146 0f376871-0459-35fc-b139-2a34c915ec22 System Jira",
  "parentId": "744325328",
  "parentTitle": "740_■オファー関連バッチ",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/743473796/742_",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-07-30T04:48:37.021Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 概要 自動オファー対象の会員にオファーを送信する。 2. 要求事項 コマンドラインで実行できるものとする。 本バッチは毎日10:00(JST)に自動実行するように設置する。 バッチ処理を開始したらバッチ処理を開始した旨のメッセージと現在日時を含むログを出力する。 有効な契約を持つすべての企業において、以下の処理を行う。 企業番号の下1桁にて、その日の送信対象となる企業を絞り込む。絞り込みロジ..."
}