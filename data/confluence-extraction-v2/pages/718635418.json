{
  "id": "718635418",
  "title": "505_【FIX】教室削除 機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】教室：基本情報／所在地 、 【FIX】教室：応募情報転送連絡先／応募後連絡先電話番号 、 【FIX】教室：塾チャート 、 【FIX】教室：ロゴ・スライド画像 のデータを削除するための機能です。 3. 要求事項 クライアント企業管理画面にログインすることができるクライアント企業管理者が、 【FIX】教室：基本情報／所在地 、 【FIX】教室：応募情報転送連絡先／応募後連絡先電話番号 、 【FIX】教室：塾チャート 、 【FIX】教室：ロゴ・スライド画像 を削除することができる。 ただし自身の企業に紐づかない教室は削除することができない。 501_【作成中】教室一覧閲覧機能 にある１レコードの削除ボタンを押下すると、削除の確認を求める確認ダイアログが表示される。確認ダイアログには以下の項目を表示する。 削除するボタン キャンセルボタン キャンセルを押下すると削除はされずモーダルを閉じる。 教室ID 教室名 削除ボタンを押下すると、以下の条件を満たす場合に、対象の教室情報を論理削除し、またその教室に紐づく全ての求人について 514_【レビュー中】教室管理-求人削除機能 を実施する。 対象の教室に紐づく求人に対しての 【FIX】応募情報 が存在しない。または、存在するが、その「採用ステータス（クライアント企業）」の値が「未登録」「保留」のものや、「採用」で、全ての「採用決定日」から1年以内ものが存在しない。 削除が実行される場合は、関連する帳票における削除対象教室に紐づくデータが削除され、システム全体に適用する。 関連して削除する帳票は 164_【FIX】教室削除機能 の同内容と同じとする。 削除後は 501_【作成中】教室一覧閲覧機能 に遷移する。 削除で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、管理者ID、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 クライアント企業管理画面にログインすることができるクライアント企業管理者 3.2. 帳票 概要に挙げた帳票 3.3. メールテンプレート なし 3.4. ワークフロー 【FIX】教室登録・公開・削除フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=60959-22405&amp;mode=design&amp;t=K6l3LyhUSTy2VQLm-0 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=60959-22441&amp;mode=design&amp;t=K6l3LyhUSTy2VQLm-0 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 教室番号 &nbsp; 隠しフォーム 削除する対象の教室の 【FIX】教室：基本情報／所在地 における教室番号 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 出力項目 出力先 説明 1 削除者 データベース 【作成中】帳票共通項目 に従う。 2 削除日時 データベース 【作成中】帳票共通項目 に従う。 3 教室番号 画面 HTMLエスケープ処理をして出力する。 4 教室名 画面 HTMLエスケープ処理をして出力する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合はクライアント企業管理者画面のログイン画面にリダイレクトする。 教室番号を元にデータベースから 【FIX】教室：基本情報／所在地 を取得する。対象の教室番号のデータが存在しない場合、レスポンスステータス404 not foundを出力して処理を終了する。 削除ボタンを押下すると、削除対象の教室が存在し、以下の条件を満たす場合に、対象の教室情報および関連する帳票を削除者・削除時間のみを記録し処理を終了する。 対象の教室に紐づく求人に対しての 【FIX】応募情報 が存在しない。または、存在するが、その「採用ステータス（クライアント企業）」の値が「未登録」「保留」のものや、「採用」で、全ての「採用決定日」から1年以内ものが存在しない。 関連して論理削除する帳票の処理については、 164_【FIX】教室削除機能 の同内容と同じとする。 削除が完了した場合、削除完了を伝えるポップアップを表示し、成功ログを出力し、 501_【作成中】教室一覧閲覧機能 ページに遷移する。 なお削除時の影響範囲については https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/772014210#2.-%E5%89%8A%E9%99%A4%E6%99%82%E3%81%AE%E5%8B%95%E4%BD%9C%E4%B8%80%E8%A6%A7 にてまとめている。 4.5. エラー処理 途中で削除に失敗した場合は、それまでに削除した帳票は元に戻してエラーを表示する。 削除に失敗した理由をエラーとして表示する。 設定ファイルが存在しない、データベースにテーブル・フィールドが存在しない、メールテンプレートファイルが存在しない場合はプログラム上で特別な処理を行わず、Laravelの例外出力に任せる。 4.6. ログ 企業の削除に成功した場合に下記フォーマットでログを出力する User {クライアント企業管理者のユーザー番号} deleted classroom. company_number={ 企業番号 } classroom_number={教室番号} classroom_name={企業名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 企業の削除に失敗した場合に下記フォーマットでログを出力する User {クライアント企業管理者のユーザー番号} failed to delete classroom. company_number={企業番号} classroom_number={教室番号} classroom_name={教室名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 企業番号を出すのは、ある企業管理者が複数の企業に紐づくことがあり、どの企業の企業管理者として操作したかを明確にするため 5. スコープ外・制限事項 なし",
  "parentId": "704184702",
  "parentTitle": "500_■教室管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/718635418/505_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-11-20T03:33:52.700Z",
  "author": "feng_xiaomeng (Unlicensed)",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】教室：基本情報／所在地 、 【FIX】教室：応募情報転送連絡先／応募後連絡先電話番号 、 【FIX】教室：塾チャート 、 【FIX】教室：ロゴ・スライド画像 のデータを削除するための機能です。 3. 要求事項 クライアント企業管理画面にログインすることができるクライアント企業管理者が、 【FIX】教室：基本情報／所在地 、 【FIX】教室：応募情報転送連..."
}