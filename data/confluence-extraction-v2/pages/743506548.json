{
  "id": "743506548",
  "title": "801_【FIX】バウンスメール処理バッチ",
  "content": "1. 概要 SESのフィードバックを Cloud Watch Logsから 取込み、その種類に応じて以下の3種類の処理を行う。どの処理を行うかは バウンスタイプ によって切り替える。 無効メールアドレス の追加更新 【レビュー中】会員：設定情報（オファー・メール） のメール関連のフラグのうち、画面更新可能なフラグをオフ 【作成中】メール送信履歴 をエラーに更新 バウンスタイプと処理の対応表 bounceType 実行する処理 説明 Permanent（以下を含む） ハードバウンス サプレッションリスト 苦情 1, 2, 3 存在しない等のメールアドレス。今後メールを送るべきではない。 Transient（以下を含む） ソフトバウンス 3 一時的なエラーがおきたメールアドレス。今後もメールを送ってよいが、送信履歴はエラーとして扱い保存する。 参考： https://docs.aws.amazon.com/ja_jp/ses/latest/dg/notification-contents.html#bounce-object 本バッチは毎日0:05(JST)に自動実行するように設置する。 2. 要求事項 コマンドラインで実行できるものとする。 バッチ処理を開始したらバッチ処理を開始した旨のメッセージと現在日時を含むログを出力する。 1〜3の処理は以下のような流れとする。 処理1 対象のメールアドレスが 無効メールアドレス のメールアドレスと一致するものがある場合は、バウンス回数を＋1する。 一致するものがない場合は新規レコードとして作成する。その際のバウンス回数は1とする。 処理2 【レビュー中】会員：設定情報（オファー・メール） の「メール受信フラグ：スカウト通知」、「メール受信フラグ：マッチ通知」、「メール受信フラグ：メルマガ購読」、「メール受信フラグ：お知らせ通知」のフラグをオフ(メールを送信しない設定)にして更新する。 処理3 【作成中】メール送信履歴 のステータス をエラーにし、 エラーメッセージ にはバウンスのエラー内容を保存する。 バッチ処理終了時には、バッチ処理が終了した旨のメッセージと終了日時を含んだログを出力する。 必達終了時間は1:05(JST)とし、その時間内に10,000件の処理を行えるパフォーマンスを確保する。 2.1. メールテンプレート 2.2. ワークフロー 3. 要件定義 3.1. 入力 要求にて定義している内容に従う。 3.2. 出力 要求にて定義している内容に従う。 3.3. 処理 3.4. エラー処理 下記通知先にエラーログ通知を行う。 【FIX】バッチエラー時通知先 3.5. ログ バッチ略称はhandle bounce email (HBE) とする。 バッジ処理全体が開始した時と終了した時に以下のログを出力する。 開始時 [801_HBE] Started at {処理開始日時}. 終了時 [801_HBE] Finished at {処理終了日時}. 1の処理 成功時 [801_HBE] Succeeded in saving the invalid email . email_history_number invalid_email_number ={対応する 無効メールアドレス の 番号} time={現在時刻}. 失敗時 [801_HBE] Failed in saving the invalid email. time={現在時刻}. 2の処理 成功時 [801_HBE] Successfully updated mail-related flags. user_number={対象の会員番号} time={現在時刻}. 失敗時 [801_HBE] Failed to update mail-related flags. time={現在時刻}. 3の処理 成功時 [801_HBE] Successfully updated email history. mail_history_number={対象のメール送信履歴番号} email_history_number={対応する 【作成中】メール送信履歴 の メール送信履歴番号} time={現在時刻}. 失敗時 [801_HBE] Failed to update email history. time={現在時刻}. 4. スコープ外・制限事項",
  "parentId": "744718575",
  "parentTitle": "800_■システム内部処理関連バッチ",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/743506548/801_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-04-02T02:29:16.035Z",
  "author": "元ユーザー (Deleted)",
  "excerpt": "1. 概要 SESのフィードバックを Cloud Watch Logsから 取込み、その種類に応じて以下の3種類の処理を行う。どの処理を行うかは バウンスタイプ によって切り替える。 無効メールアドレス の追加更新 【レビュー中】会員：設定情報（オファー・メール） のメール関連のフラグのうち、画面更新可能なフラグをオフ 【作成中】メール送信履歴 をエラーに更新 バウンスタイプと処理の対応表 bou..."
}