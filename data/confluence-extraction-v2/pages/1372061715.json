{
  "id": "1372061715",
  "title": "2025-01-28_障害報告",
  "content": "■ 概要 = 障害内容 サイト全体（アドミン/クライアント/サービスサイト）へのアクセスできない状態にあった。 = 障害時間 発生日時：2025-01-28 10:26頃 復旧日時：2025-01-28 12:03 = 影響範囲 対象時間に下記のサービスにアクセスした全ユーザ https://www.juku.st/ https://www.juku.st/admin &nbsp; https://www.juku.st/client = 対応経緯 2025/01/28 10:26 mysqlに繋がりにくいことを片岡様から連絡いただく 2025/01/28 10:34 サイトに繋がらない旨を池田様から連絡いただく 2025/01/28 10:37 監視ツールからのアラート通知を確認 2025/01/28 10:41 DBの負荷が高まっていることを確認 2025/01/28 11:29 ログが書き込めない状態になっていることが発覚し、権限を修正する 2025/01/28 11:29 メンテナンス画面解除し、復旧確認 = 直接原因 Laravelのアプリケーションログのユーザ権限がrootになっていた。 正規の権限 -rwxrwxrwx 1 nginx nginx 36M 10月 23 13:10 web_application-2024-10-23.log 今回の権限 -rw-r--r-- 1 root root 14K 1月 28 10:49 web_application-2025-01-28.log root権限のログファイルにWebサーバ経由で実行しているユーザでログの書き込み処理が行うことができず、出力できないログ情報がメモリに蓄積した結果、サーバがダウンした。 = 根本原因 デプロイ時に実行されるスクリプトにて、root権限でログファイルを保持する仕様になっていた = 原因に関する補足事項 過去これまで発生しておらず、今回発生した理由としては、直近の本番反映において初期処理でエラーが発生するようになってしまった為に発生した。 つまり、リリース時から発生する可能性があった。 = 暫定対応 [済] アプリケーションログの権限をnginxに変更 = 恒久対応（再発防止策） [済] Laravelのアプリケーションログがrootユーザで作成されないように修正 スクリプトで実行するコマンドでエラーが発生するパターンを想定してデプロイテストを行うこと 関係者の皆様ご迷惑をおかけし申し訳ございませんでした。",
  "parentId": "1371963553",
  "parentTitle": "障害/インシデント/経緯報告",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/1372061715/2025-01-28_",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-12T13:18:06.081Z",
  "author": "和田憲幸",
  "excerpt": "■ 概要 = 障害内容 サイト全体（アドミン/クライアント/サービスサイト）へのアクセスできない状態にあった。 = 障害時間 発生日時：2025-01-28 10:26頃 復旧日時：2025-01-28 12:03 = 影響範囲 対象時間に下記のサービスにアクセスした全ユーザ https://www.juku.st/ https://www.juku.st/admin &nbsp; https:/..."
}