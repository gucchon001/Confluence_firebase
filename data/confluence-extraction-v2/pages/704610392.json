{
  "id": "704610392",
  "title": "162_【FIX】教室新規登録機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】教室：基本情報／所在地 のデータを 新規で登録する ための機能です。 3. 要求事項 全体管理画面にログインすることができる システム管理者 、塾講師ステーション管理者、ゲスト管理者が、 【FIX】教室：基本情報／所在地 を新規登録することができる。 ギフト券担当者、記事管理者、記事担当者は 【FIX】教室：基本情報／所在地 を新規登録することができない。 本機能へは、下記の導線で遷移する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263407 からの遷移 企業は空欄のままページを表示する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/740163745 からの遷移（ 「教室の作成」 ボタンを押下した場合） 閲覧していた企業における下記項目を、URLパラメータへの入力として本機能に遷移する。 閲覧していた企業を、本機能の「企業」に割り当て、変更不可とする。 入力フォームに表示し入力可能とする項目は、下記とする。 本ページの「要件定義」-「入力」欄で入力元が「入力フォーム」と定義されている項目 「キャンセル」ボタン 押下することで入力内容を取り消し、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263407 に遷移する。 「登録する」ボタン 押下すると、入力項目に問題なければ、データベースにレコードを保存し、詳細確認画面に遷移して、保存したことが登録者に分かるメッセージを表示する。 入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるか分かるようにエラーメッセージを表示する。 新規登録した際の公開設定は公開とする。 新規登録で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、管理者ID、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 3.2. 帳票 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 3.3. メールテンプレート なし 3.4. ワークフロー https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 の記載と同様 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 新規登録画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=3309-34310&amp;mode=design&amp;t=D6tjYb6OIwN2gjvm-0 4.1.2. 登録完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=7185-63458&amp;mode=design&amp;t=8BM1pNITuHKtemSH-0 4.2. 入力 変数名、説明、バリデーションは、 【FIX】教室：基本情報／所在地 の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 に記載の共通入力・取得項目は項目自体を省略する。 「制限」に「必須」とある場合に入力がない場合のエラーメッセージは統一して「{項目名}を入力してください」とする。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 企業 （企業番号） company_number 入力フォーム 選択肢の表示形式は「[企業コード]_[企業名]」とする。 URLパラメータで企業が指定されている状態で作成する場合 入力フォームにせずに、隠しフォームに指定された企業番号を入力する。 入力フォームの代わりに、指定された企業を表示する。 URLパラメータで企業が指定されていない状態で作成する場合 教室グループが先に選択されていない場合 初期値はなし。 コンボボックスによる単一選択。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/765886465 を使い、テキストエリアに入力された文字列との中間一致で検索して抽出した企業を選択肢として表示し、表示された選択肢から選択することで「企業番号」が入力される。 教室グループが先に選択された場合 初期値はなし。 選択された教室グループに紐づく企業を選択肢とするコンボボックスに変わり、単一選択。 必須 2 教室グループ （教室グループ番号） brand_number 入力フォーム 選択肢の表示形式は「[教室グループID]_[教室グループ名]」とする。 URLパラメータで教室グループが指定されている状態で作成する場合 入力フォームにせずに、隠しフォームに指定された企業番号を入力する。 入力フォームの代わりに、指定された教室グループを表示する。 URLパラメータで教室グループが指定されていない状態で作成する場合 企業が先に選択されていない場合 初期値はなし。 コンボボックスによる単一選択。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/766083087 を使い、テキストエリアに入力された文字列との中間一致で検索して抽出した教室グループを選択肢として表示し、表示された選択肢から選択することで「教室グループ番号」が入力される。 企業が先に選択された場合 初期値はなし。 選択された企業に紐づく教室グループを選択肢とするコンボボックスに変わり、単一選択。 必須 3 対象サイト 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 企業と教室グループを選択した後に入力可能になる。 指定した企業と教室グループの契約情報から、選択可能な選択肢が表示される。 必須 4 教室名 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 必須 5 教室名カナ 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 必須 6 ホームページ 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 7 勤務地 アクセス 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 8 勤務地補足 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 9 郵便番号 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 数値を記入後「住所を検索」を押下すると下記の項目を自動で更新する。 都道府県 市区町村 その他住所 必須 10 都道府県 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=▼選択してください 必須 11 市区町村 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=▼選択してください 必須 12 その他住所 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 必須 13 緯度経度 【FIX】教室：基本情報／所在地 参照 入力フォーム 住所を記入した上で「地図情報の取得」ボタンを押下する事で地図情報を更新することができる 地図 情報取得後は、 地図上をドラッグ してクリック することで、緯度経度を編集することが可能とする。 14 最寄り駅名：最寄り駅1：駅名 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=▼選択してください 15 最寄り駅名：最寄り駅1：移動手段 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=徒歩 16 最寄り駅名：最寄り駅1：所要時間 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 17 最寄り駅名：最寄り駅2：駅名 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=▼選択してください 18 最寄り駅名：最寄り駅2：移動手段 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=徒歩 19 最寄り駅名：最寄り駅2：所要時間 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 20 最寄り駅名：最寄り駅3：駅名 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=▼選択してください 21 最寄り駅名：最寄り駅3：移動手段 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値=徒歩 22 最寄り駅名：最寄り駅3：所要時間 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 23 最寄り駅候補 初期値なし 「緯度経度」設定後に「駅候補の取得」ボタンを押下する事で、本項目の内容を更新し、周辺にある駅名を表示する。 24 アクセス方法 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 25 管理メモ１ 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 26 管理メモ２ 【FIX】教室：基本情報／所在地 参照 入力フォーム 初期値なし 4.3. 出力 説明は、 【FIX】教室：基本情報／所在地 の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 に記載の共通出力項目は項目自体を省略する。 出力項目 出力先 説明 1 企業名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 2 教室グループ名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 3 教室グループ管理用メモ データベース/ 画面 選択された教室グループに紐づく 【FIX】教室グループ の管理用メモをHTMLエスケープ処理をして出力する。 4 教室プラン データベース レコード新規作成時点で紐づく契約（基本およびオプション）から最新のプラン情報を保存する。 5 プラン優先度 データベース レコード新規作成時点で紐づく契約（基本およびオプション）から最新のプラン情報を保存する。 6 対象サイト データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 7 教室名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 対象サイトがキャリアの場合、文末に【キャリア求人】という文言を追加して登録する。 8 教室名カナ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 9 ホームページ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 10 勤務地 アクセス データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 11 勤務地補足 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 12 郵便番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 13 都道府県 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 14 市区町村 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 15 その他住所 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 16 緯度経度 データベース/画面 地図情報を表示し、「地図情報の取得」ボタンを押下する事で記入した住所情報の周辺地図を表示する。 地図をドラッグして指定した位置の緯度経度情報を出力する。 17 最寄り駅名：最寄り駅1：駅名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 18 最寄り駅名：最寄り駅1：手段 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 19 最寄り駅名：最寄り駅1：時間 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 20 最寄り駅名：最寄り駅2：駅名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 21 最寄り駅名：最寄り駅2：手段 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 22 最寄り駅名：最寄り駅2：時間 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 23 最寄り駅名：最寄り駅3：駅名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 24 最寄り駅名：最寄り駅3：手段 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 25 最寄り駅名：最寄り駅3：時間 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 26 最寄り駅候補 画面 緯度経度情報に応じて絞り込んだ駅のリストを「{駅名} 徒歩 {時間} 分」形式で表示する。 「駅名」：教室の緯度経度から半径3km以内にある駅情報をすべて表示する。 「交通手段」：「徒歩」を固定で表示する。 「時間」：教室の緯度経度と駅の緯度経度情報から、分速80mとして算出した分数を表示する。 27 アクセス方法 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 28 管理メモ１ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 29 管理メモ２ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 4.4.1. 入力画面表示処理 本ページの「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704610392#4.2.-%E5%85%A5%E5%8A%9B ）に記載の全ての項目の入力フォームと登録ボタンを配置した画面を表示する。 4.4.2. 新規登録処理 入力フォームからのデータを受け取り、「入力」の定義にしたがって値の妥当性検査をおこなう。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、作成日時、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を作成者/更新者に設定した上でデータベースに新規レコードとして挿入する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263407 ページへリダイレクトし、新規データ登録が完了したことがわかるメッセージを表示する。 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 新規登録画面を表示した場合に下記フォーマットでログを出力する。 User {全体管理者のユーザー番号} started to create classroom. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 新規登録処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} created classroom. classroom_number={教室番号} company_number={企業番号} brand_number={教室グループ番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 作成したレコード数の数だけログを出力する。 失敗した場合 User {全体管理者のユーザー番号} failed to create classroom. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "704053435",
  "parentTitle": "160_【FIX】教室管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704610392/162_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-05-09T08:50:43.579Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】教室：基本情報／所在地 のデータを 新規で登録する ための機能です。 3. 要求事項 全体管理画面にログインすることができる システム管理者 、塾講師ステーション管理者、ゲスト管理者が、 【FIX】教室：基本情報／所在地 を新規登録することができる。 ギフト券担当者、記事管理者、記事担当者は 【FIX】教室：基本情報／所在地 を新規登録することができない..."
}