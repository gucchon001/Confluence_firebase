{
  "id": "1357185025",
  "title": "求人一覧閲覧の駅（/station）ページ構成不備調査",
  "content": "下記問題の調査状況まとめページ CTJ-4057 0f376871-0459-35fc-b139-2a34c915ec22 System Jira GIG社内用クローン：​ CTJ-4058 0f376871-0459-35fc-b139-2a34c915ec22 System Jira 関連： CTJ-4322 0f376871-0459-35fc-b139-2a34c915ec22 System Jira 内部確認状況 ■対応依頼① 以下のページにて SPのモーダル が正しく表示されませんので、修正願います。 本番 https://www.juku.st/area/osaka/station/1160214 dev https://dev-www.juku.st/area/osaka/station/1160214 恐らく、以下のチケットに記載のページ全てで発生しています。 CTJ-4203 0f376871-0459-35fc-b139-2a34c915ec22 System Jira HT社回答 こちらバグをPCで再現できました。 原因としては、F12でSPシミュレータを行います。 PCとSPの区別は、時々混同されることがあります。 本端末で発生しないと認識しています。 そうしたら、問題ないと思います。 いかがでしょうか？ GIG再質問 https://www.juku.st/area/osaka/station/1160214 上記のURLをPCの開発者ツールでSPモードにして、そのQRから実機で表示すると実機でも表示が崩れますが、なぜでしょうか？ ■質問① 路線が複数通っている場合の駅（/station）ページのURL末尾のidはどのようなロジックで決めていますか？ 例えば、以下のページです。 梅田駅のページのようですが、複数の駅が選択された状態になっております。 https://www.juku.st/area/osaka/station/1160214 以下の新宿駅や東池袋駅なども同様です。 https://www.juku.st/area/tokyo/station/1130208 https://www.juku.st/area/saitama/station/2800610 トモノカイ社としては、複数が選択された状態では無く、一つの駅が選択された状態を望まれています。 HT社回答 複数路線を選択・検索する場合に、設定された教室の最寄り駅がヒットすると出ます。各駅は「OR」条件で検索されています。 よろしくお願いいたします。 GIG再質問 以下のリダイレクトが関連しております。 リダイレクト前：梅田（阪急線） https://www.juku.st/station/6552 &darr; あるべきリダイレクト： https://www.juku.st/area/osaka/station/1160214 上記にてリダイレクト前の梅田（阪急線）をクリックすると404になっており、「あるべきリダイレクト」にリダイレクトしていないようです。 また、「あるべきリダイレクト」に関しても、本来は複数の駅が選択された状態では無く、単一の駅の選択になるのが正しいようです。 こちらの原因はお分かりになりますか？ 江尻見解 リダイレクトは、2024年6月のリリース時に下記の様に定めて対応した。 該当のリダイレクト定義 https://docs.google.com/spreadsheets/d/1NBbn6IefE8-b3KVgVkV6r89LlZ705IAn6Oy5rsIOM44/edit?gid=1902383958#gid=1902383958&amp;range=BR215:BU215 詳細： https://docs.google.com/spreadsheets/d/1NBbn6IefE8-b3KVgVkV6r89LlZ705IAn6Oy5rsIOM44/edit?gid=682118696#gid=682118696&amp;range=C13 上記の対応関係は下記のようにして作成されていた。（ このメッセージ より。チケットはこちらとのこと： CTJ-3601 0f376871-0459-35fc-b139-2a34c915ec22 System Jira ） ①：教室データ移行バッチまたは会員データ移行バッチを実行する ②：ＣＳＶのデータに記載されている旧駅IDから新駅IDに変換する。同時に新駅マスタのold_station_idに旧駅IDを保存される これにより、同じテーブル内に「old_station_id」と「station_id」の組み合わせが出来上がるので、リダイレクト処理を行う際のリダイレクト先がわかる。 また、「ＣＳＶのデータに記載されている旧駅IDから新駅IDに変換する。」の方法は、 こちらのメッセージ （下記）から、駅名＋都道府県でヒットさせていたはず。 こちらはデータ移行の過程でold_station_id=6552が新しいIDに対応しなくなったんでしたよね？ その理由は、駅名＋都道府県で合致するものを新しいIDでは1つだけ選ぶので、 大阪梅田（阪急線） 大阪梅田（阪神線） の2つが古いIDにはあったが、1つだけ選んだのでもう片方が新旧対応から落ちた 駅マスタのマッピング表は こちら でHTさんからいただいた。（2024/5/30時点） これらを踏まえてまとめてみると、下記。 背景 旧システムと新システムで駅のマスタが異なっている。 新システムでは、下記のように駅情報を扱っている。 登録時（教室登録など） 入力：駅名で候補を選択 保存：駅グループコード＋駅名を保存 ※これで実用的な粒度で入力した駅名に該当する駅を一意に特定できる。（参考： https://ekidata.jp/doc/station_g.php ） 検索時（求人検索など） 入力：駅名で候補を選択 抽出：駅グループコード＋駅名でヒットさせ抽出 駅LP表示時 入力：駅グループコードを入力 表示：駅グループコードでヒットさせ抽出 駅の種類や粒度にも細かい差分がある中、駅のリダイレクトは、下記の様に行なっていた 旧マスタの駅名＋都道府県をキーとして、新マスタの駅を特定。 新マスタに該当する旧駅IDも保存し、紐付け可能にした。 起きている状況 新しステムの駅LPは、駅グループコードで該当する駅を呼び出している。（参照： https://docs.google.com/spreadsheets/d/1NBbn6IefE8-b3KVgVkV6r89LlZ705IAn6Oy5rsIOM44/edit?gid=1902383958#gid=1902383958&amp;range=BT215 ） 新マスタでは、１つの駅グループコードに対して複数の駅が紐づいている（ https://ekidata.jp/doc/station_g.php ）ため、複数表示される。 ■質問② 質問①のページにリダイレクトは正しくされていますか？ ■本番環境 リダイレクト前：梅田（阪急線） https://www.juku.st/station/6552 リダイレクト先： https://www.juku.st/area/osaka/station/1160214 上記は本番環境では404エラーになり、正しくリダイレクト出来ていない。 （そもそも、あるべきリダイレクト先が複数駅の掛け合わせになっており、正しくない状態） dev環境では正しくリダイレクトできている様子。 HT社回答 リンクをクリックすれば、404画面のみに遷移されています。 どこ画面からリダイレクトは正しくないと詳しく教えていただけませんか？または、ビデオを提供いただけると助かります。 江尻見解 CTJ-4322 0f376871-0459-35fc-b139-2a34c915ec22 System Jira （2025/1/16時点でDEVのみに修正反映済み）により、解消するはず。 ■質問③ 質問①と質問②はどれくらいの範囲で発生していますか？ 複数路線の駅全てで発生していますか？ HT社回答 質問①と②を理解した後に回答いたします。 問題点 リダイレクトが正しくできていない モーダルのロードが終わらず操作できない 直っていそう タイトルがSEO的に適していない トモノカイ様への回答 1次回答： CTJ-4057 0f376871-0459-35fc-b139-2a34c915ec22 System Jira 以下、トモノカイ様起票の内容 ▼事象 ・求人一覧の駅ページ（/station）の構成（title、駅が複数選択されているなど）がおかしいページが複数ありました。 &rarr;上記の影響で、正しくリダイレクトが出てきていない（自然検索で評価が分散して表示されない）、LPにアクセスして再検索できないなどが発生している。 例） ・梅田駅： https://www.juku.st/area/osaka/station/1160214 ┗複数の駅（大阪、北新地、大阪梅田、梅田、東梅田、西梅田）が選択されている。 &rarr;再検索しようと勤務地を押すとモーダルが開くが、ロードから画面が進まない。SP版 &rarr;現在はSPの実機はOK、PCの開発者ツールだと正しく表示できない ・新宿駅： https://www.juku.st/area/tokyo/station/1130208 ┗複数の駅（JR山手線の新宿、京王線の新線新宿）が選択されている &rarr;再検索はできるが、titleが「新宿、新線新宿駅の塾バイト求人情報なら塾講師ステーション」となっており、SEO上適していない。 ※東池袋駅（ https://www.juku.st/area/saitama/station/2800610 ）でも同様の事象を確認。 &rarr;新宿、新線新宿駅：PCはOK、SPの実機はNG &rarr;東池袋、東池袋四丁目駅：PCはOK、SPの実機はOK &rarr;SEOでの正しいタイトルが分からない ▼調査して分かっていること ・複数の駅路線にまたがる駅で起こっている（一方で、 渋谷駅 では発生していない。） &rarr;駅名を部分一致で検索してLP作成している？ ・複数路線かつ名称が一致していない駅で起きている。 &rarr;梅田駅は規則性がない？ ▼確認していただきたいこと 路線が複数通っている場合の駅（/station）LPのidはどうやって決めているのか グループコードがIDになっているか？ リダイレクトは上記のLPにすべて正しくかかっているのか。 どのくらいの範囲で起こっているのか？ なぜ、 渋谷駅 では発生していないのか？ 再検索しようと勤務地を押すとモーダルが開くが、ロードから画面が進まないエラーの解消",
  "parentId": "1261043793",
  "parentTitle": "メモ",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/1357185025/station",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-01-16T05:11:04.551Z",
  "author": "ejiri_yusuke",
  "excerpt": "下記問題の調査状況まとめページ CTJ-4057 0f376871-0459-35fc-b139-2a34c915ec22 System Jira GIG社内用クローン：​ CTJ-4058 0f376871-0459-35fc-b139-2a34c915ec22 System Jira 関連： CTJ-4322 0f376871-0459-35fc-b139-2a34c915ec22 Syste..."
}