{
  "id": "1392771106",
  "title": "624_【FIX】契約更新辞退機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】契約情報（統合版） の登録済みのデータを1件の更新辞退フラグを更新するための機能です。 3. 要求事項 クライアント管理画面にログインできるクライアント企業管理者が、 【FIX】契約情報（統合版） 1件の「更新辞退フラグ」を更新することができる。 自分の企業に紐づかない契約のフラグは更新できない。 基本契約のみの情報を更新し、紐づく子契約の情報は更新しない。 本機能へは https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705429584 から遷移して利用できる。 画面に表示し入力可能な項目はWF記載の通りとし、特筆すべき項目のみ以下に記載する。 更新しないボタン 押下すると下記の処理を行う。 更新辞退フラグを有効状態としてデータベースに保存する。 フラグ更新完了の旨のポップアップを表示する。 ポップアップには閉じるボタンを表示し、閉じるボタンを押下すると該当の https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705593409 に遷移する。 キャンセルボタン 押下すると、画面（モーダル）を閉じる。 更新に成功または失敗した場合、以下の情報が入ったログを出力する。 日時、クライアント企業管理者ID( 【FIX】クライアント企業管理者 のユーザー番号)、契約番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 要求定義に記載の通り。 3.2. 帳票 概要に記載の通り。 3.3. メールテンプレート なし 3.4. ワークフロー 【FIX】クライアント企業契約・登録・更新・契約終了フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 更新画面（更新辞退画面への遷移元となる画面） https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=106793-7666&amp;mode=design&amp;t=CpCpvwWykw0UdlfN-0 4.1.2. 契約更新辞退確認モーダル https://www.figma.com/design/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?node-id=207395-83935&amp;t=nibVQgZhK6RZcdQs-0 4.1.3. 契約更新辞退完了モーダル https://www.figma.com/design/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?node-id=207396-84023&amp;t=nibVQgZhK6RZcdQs-0 4.2. 入力 変数名、説明、バリデーションは、帳票の記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限 1 契約番号 隠しフォーム 初期値なし 必須 4.3. 出力 説明は帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 出力先 説明 1 契約更新辞退フラグ データベース フラグを有効にする値をデータベースに保存する。 2 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 3 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合はクライアント企業画面のログイン画面にリダイレクトする。 4.4.1. 更新処理 該当するレコードが見つかったら、「入力」 に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっているクライアント企業管理者のユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 該当のレコードの保存した情報を閲覧できる https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705593409 へリダイレクトし、保存が完了したことがわかるようにメッセージを表示する。 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ フラグ更新処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {クライアント企業管理者のユーザー番号} updated contract renewal_declined_flag. contract_number={契約番号} company_number={企業番号} brand_number={教室グループ番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 作成したレコード数の数だけログを出力する。 失敗した場合 User {クライアント企業管理者のユーザー番号} failed to update contract renewal_declined_flag. contract_number={契約番号} company_number={企業番号} brand_number={教室グループ番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "705265775",
  "parentTitle": "620_■契約管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/1392771106/624_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-18T08:36:05.269Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】契約情報（統合版） の登録済みのデータを1件の更新辞退フラグを更新するための機能です。 3. 要求事項 クライアント管理画面にログインできるクライアント企業管理者が、 【FIX】契約情報（統合版） 1件の「更新辞退フラグ」を更新することができる。 自分の企業に紐づかない契約のフラグは更新できない。 基本契約のみの情報を更新し、紐づく子契約の情報は更新しな..."
}