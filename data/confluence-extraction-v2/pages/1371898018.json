{
  "id": "1371898018",
  "title": "2025-01-24_障害報告",
  "content": "■ 概要 = 障害内容 ギフトカード発行処理、メール送信処理等が止まって いた。 = 影響範囲（確認中） 発生日時以降にキューを使用している機能（処理） ギフトカード発行 キャッシュ生成 エラーメール（管理者宛） 自動オファー受信メール（会員） 面接日前日リマインドメール（会員） 急募終了３日前通知メール（企業） その他内部処理（確認中） = 障害時間 発生日時：2025-01-22 10:22（正常なメールが確認できた最後の時間） 復旧日時：2025-01-25 00:23（再起動して溜まっていたjobが全て処理された時間） ■詳細 = 対応経緯 2025/01/24 14:05 adminのメール送信履歴管理でユーザ宛に送られる自動オファー通知メールが1/22（水）以降送られていないことを池田様から ご連絡 いただく 2025/01/24 14:43 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/743473796 のログとオファー/メール履歴に関するDBを見て、メール履歴テーブル（email_histories）に送信対象のメールのレコードが作成されていないことを確認 2025/01/24 18:21 本番環境のキューにjobが溜まっており、キューワーカーが停止していることを確認 2025/01/24 19:59 自動オファーのバッチのメール送信がされない原因をトモノカイ様に報告 2025/01/24 20:43 キューワーカーの再起動についてmeetにて片岡様に説明 2025/01/25 00:23 キューワーカーの再起動を実行し、トモノカイ様に対応完了の報告 = 直接原因 特定の内部処理（CacheTotalJobConditionJob）が実行中のままで完了せず、他処理が終わらない状態となって いた。 = 根本原因 CacheTotalJobConditionJobが制限時間内に実行完了せず、キューに貯まり続けていたため後続のキューが処理されなかった。※キューワーカーの実行ログから確認 = 暫定対応 [済] 面接のリマインドメールのjobを削除した上でキューワーカーの再起動を実行 [済] CacheTotalJobConditionJobの停止（ 2025-01-31 フェーズ5に関するミーティング議事録 にて説明し合意した内容） = 恒久対応（再発防止策） 対策案1：CacheTotalJobConditionJobはそもそもキューに入れない形にしてバッチで処理をする [進行中] CacheTotalJobConditionJobの分割（キューに入れる処理を分割してそれぞれキャッシュを保存する処理に分割） 対応策2：キューワーカーのプロセス数を1から4などに上げる メリット：処理速度が早くなる 課題：サーバリソースを使うため慎重に変更する必要がある 対応策3：早期検知の仕組み構築 キューによって行われる処理（メール送信など）の定時実行を監視するなど。 関係者の皆様ご迷惑をおかけし申し訳ありませんでした。",
  "parentId": "1371963553",
  "parentTitle": "障害/インシデント/経緯報告",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/1371898018/2025-01-24_",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-05T05:58:22.719Z",
  "author": "kotake_jin",
  "excerpt": "■ 概要 = 障害内容 ギフトカード発行処理、メール送信処理等が止まって いた。 = 影響範囲（確認中） 発生日時以降にキューを使用している機能（処理） ギフトカード発行 キャッシュ生成 エラーメール（管理者宛） 自動オファー受信メール（会員） 面接日前日リマインドメール（会員） 急募終了３日前通知メール（企業） その他内部処理（確認中） = 障害時間 発生日時：2025-01-22 10:22（..."
}