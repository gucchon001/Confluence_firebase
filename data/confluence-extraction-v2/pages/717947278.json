{
  "id": "717947278",
  "title": "335_【FIX】記事削除機能",
  "content": "1. 目次 2. 概要 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の登録済みのデータ1件およびそれに紐付くデータ（（ 【FIX】記事カスタムフィールド値 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 【FIX】記事バージョン ））を削除するための機能です。 3. 要求事項 全体管理画面にログインすることができる全体管理者、塾講師ステーション管理者、 ゲスト管理者 、記事管理者のみが、登録されている https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 のデータを削除することができる。 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/713359414 画面、または https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577796 画面から実行できる。 登録されている https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 を削除するためには公開フラグが「非公開」になっている必要がある。 「削除」ボタンを押下すると、記事番号、タイトルおよび「この記事を削除しますか？」と確認ダイアログを表示し、「キャンセル」か「 OK 削除 」を選択できる。 「キャンセル」を押下した場合、対象記事を削除せず、確認ダイアログを閉じる。 「 OK 削除 」を押下した場合、対象記事を論理削除してシステム全体へ適用し、「記事を削除しました。」文言がポップアップで表示される。 本機能で https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 を削除した時、関連して削除する帳票は以下の通りとする。 【FIX】記事カスタムフィールド値 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 【FIX】記事バージョン 削除で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、管理者ID( 【FIX】全体管理者登録情報 のユーザー番号)、記事番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 要求事項の記載と同じ 3.2. 帳票 概要の記載と同じ 3.3. ワークフロー 3.3.1. 本機能 【FIX】記事登録・公開・非公開・削除フロー 3.3.2. 関連 【FIX】ピックアップ記事選定フロー 4. 要件定義 本ページで特に指定した場合を除き、 共通要件 に従うものとする。 4.1. ユーザーインターフェース（画面） 本ページで特に指定した場合を除き、 共通要件 に従うものとする。 4.1.1. 記事削除確認画面 https://www.figma.com/design/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?node-id=185264-26353&amp;node-type=frame&amp;t=cHtfuiuRya4xV6QT-0 4.1.2. 記事削除完了画面 https://www.figma.com/design/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?node-id=185264-26399&amp;node-type=frame&amp;t=cHtfuiuRya4xV6QT-0 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 記事番号 &nbsp; 入力フォーム 隠しフォーム 削除する対象の企業の https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ における記事番号 &nbsp; 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 4.3.1. 記事基本項目 対象帳票： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 出力項目 出力先 説明 1 記事番号 画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ の記事番号を表示する。 2 タイトル 画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ のタイトルを表示する。 3 削除者 データベース 【作成中】帳票共通項目 に従う。 4 削除日時 データベース 【作成中】帳票共通項目 に従う。 4.3.2. 記事_ピックアップ 対象帳票： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 紐づく有効なレコードが存在する場合は、該当レコードを削除（論理削除）する。 4.3.3. 記事カスタムフィールド値 対象帳票： 【FIX】記事カスタムフィールド値 項目の定義は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1248591874/_ を参照する。 出力項目 出力先 説明 1 削除者 データベース 【作成中】帳票共通項目 に従う。 2 削除日時 データベース 【作成中】帳票共通項目 に従う。 4.3.4. 記事バージョン 対象帳票： 【FIX】記事バージョン 紐づくレコードすべてを対象とする。 出力項目 出力先 説明 1 削除者 データベース 【作成中】帳票共通項目 に従う。 2 削除日時 データベース 【作成中】帳票共通項目 に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 隠しフォームから取得した記事番号文字列を取得し、記事番号文字列が自然数に変換できない場合、レスポンスステータス404 not foundを出力して処理を終了する。 記事番号文字列を元にデータベースから https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の登録済みのデータ1件およびそれに紐付くデータ（ 【FIX】記事カスタムフィールド値 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 【FIX】記事バージョン ）を取得する。対象の記事番号の https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 データが存在しない場合、レスポンスステータス404 not foundを出力して処理を終了する。 削除対象の記事が存在する場合、下記の処理を行う。 下記を、関連するレコード一式含めて論理削除し、他の記事のレコードは作成し直す。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 下記を、次の順番で論理削除し、削除者と削除時間のみを記録する。 【FIX】記事バージョン 【FIX】記事カスタムフィールド値 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 削除が完了したポップアップを表示し、成功ログを出力し、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/713359414 ページに遷移する。 なお削除時の影響範囲については https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/772014210#2.-%E5%89%8A%E9%99%A4%E6%99%82%E3%81%AE%E5%8B%95%E4%BD%9C%E4%B8%80%E8%A6%A7 にてまとめている 。 4.5. エラー処理 途中で削除に失敗した場合は、それまでに削除した帳票は元に戻してエラーを表示する。 削除に失敗した理由をエラーとして表示する。 設定ファイルが存在しない、データベースにテーブル・フィールドが存在しない場合はプログラム上で特別な処理を行わず、Laravelの例外出力に任せる。 4.6. ログ 削除に成功した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} deleted article . article _id={記事番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} failed to delete article . article _id={記事番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "703496344",
  "parentTitle": "330_■記事管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/717947278/335_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-01-09T04:51:28.770Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の登録済みのデータ1件およびそれに紐付くデータ（（ 【FIX】記事カスタムフィールド値 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ ..."
}