{
  "id": "833126401",
  "title": "056_【FIX】通知設定機能",
  "content": "1. 目 次 2. 概要 本機能は 【FIX】会員：設定情報（オファー・メール） の登録済みのデータ1件を編集するための機能です。 3. 要 求事項 サービスサイトにログインできる会員のみが本機能を利用することができる。 登録されている 【FIX】会員：設定情報（オファー・メール） 1件の登録済み情報を閲覧し、本ページの 「要件定義」-「入力」 欄で入力元が「入力フォーム」と定義されている項目を編集することができる。 本ページでは通知設定の変更をスムーズ行えるよう、更新ボタンはなく、各変更ボタンを押下するとすぐに、入力内容にエラーがあれば更新はせずにエラーの内容を表示し、エラーがなければそのまま編集した入力フォームの内容をデータベースに保存し、システム全体に適用する、編集完了時にはトーストを表示する。 画面には以下の項目を表示する 本ページの 「要件定義」-「入力」 欄で入力元が「入力フォーム」と定義されている項目 本ページの 「要件定義」-「出力」 欄で出力先が「画面」と定義されている項目 キャンセルボタン 押下することで編集を取り消し、 055_【FIX】各種設定 に遷移する。 更新ボタン 押下すると、エラーがなければそのまま編集した入力フォームの内容をデータベースに保存し、システム全体に適用し、編集完了のポップアップを表示する。ポップアップには閉じるボタンを表示し、押下すると 055_【FIX】各種設定 に遷移する。 各種設定ページに戻るボタン 押下すると編集せずに 055_【FIX】各種設定 に遷移する。 通知機能のON/OFFはスカウト・マッチ利用設定機能とも連動するため、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704675841/053_+FIX?focusedCommentId=1721303047 （要求事項8〜11）を参照。 編集で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、ユーザー番号( 【FIX】会員：アカウント情報 のユーザー番号)、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 要求事項の記載に従う。 3.2. 帳票 概要の記載に従う。 3.3. メールテンプレート なし 3.4. ワークフロー なし 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 設定情報編集画面 以下にて実装済み。 https://stg-www.juku.st/mypage/info/notification-setting 4.1.2. 通知設定更新ポップアップ 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 入力項目 変数名 入力元 説明 制限とエラーメッセージ 1 ユーザー番号 入力フォーム 隠しフォーム 編集する対象の会員 の 【FIX】会員：アカウント情報 におけるユーザー番号 2 メール受信フラグ：スカウト通知 入力フォーム 初期値＝データベースから読み込んだ値 「スカウト利用」の項目が「利用する」の場合のみ表示する 3 メール受信フラグ：マッチ通知 入力フォーム 初期値＝データベースから読み込んだ値 「マッチ利用」の項目が「利用する」の場合のみ表示する 4 メール受信フラグ：メルマガ購読 入力フォーム 初期値＝データベースから読み込んだ値 5 メール受信フラグ：お知らせ通知 入力フォーム 初期値＝データベースから読み込んだ値 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 出力項目 出力先 説明 1 メール受信フラグ：スカウト通知 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 2 メール受信フラグ：マッチ通知 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 3 メール受信フラグ：メルマガ購読 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 4 メール受信フラグ：お知らせ通知 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 5 更新者 データベース 【作成中】帳票共通項目 に従う。 6 更新日時 データベース 【作成中】帳票共通項目 に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合はログイン画面にリダイレクトする。 URL文字列または隠しフォーム入力からユーザー番号文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定されたユーザー番号でデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 編集フォーム画面表示処理 該当するレコードが見つかったら、出力に記載の通り、表示項目と入力可能項目に項目値を反映させて画面を出力し処理を終了する。 4.4.2. 編集処理 該当するレコードが見つかったら、入力に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で編集フォーム画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている管理者のユーザー番号を更新者IDに設定した上でデータベースの該当レコードを更新する。 該当のレコードの保存した情報を閲覧できる 055_【FIX】各種設定 へリダイレクトし処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 編集処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {ユーザー番号} updated notification settings. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {ユーザー番号} failed to update notification settings. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "704577558",
  "parentTitle": "050_■マイページ各種管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/833126401/056_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-09-08T01:39:22.345Z",
  "author": "isamu saito",
  "excerpt": "1. 目 次 2. 概要 本機能は 【FIX】会員：設定情報（オファー・メール） の登録済みのデータ1件を編集するための機能です。 3. 要 求事項 サービスサイトにログインできる会員のみが本機能を利用することができる。 登録されている 【FIX】会員：設定情報（オファー・メール） 1件の登録済み情報を閲覧し、本ページの 「要件定義」-「入力」 欄で入力元が「入力フォーム」と定義されている項目を編..."
}