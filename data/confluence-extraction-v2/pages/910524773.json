{
  "id": "910524773",
  "title": "471_【FIX】請求先マスタ新規作成",
  "content": "1. 目次 1 6 false list false 2. 概要 本機能は 【作成中】企業：請求先・振込先マスタ のデータを1件新規追加するための機能です。 3. 要求事項 全体管理画面にログインすることができるシステム管理者、塾講師ステーション管理者のみが、 【作成中】企業：請求先・振込先マスタ を新規登録することができる。 新規登録にあたって入力フォームに表示し入力可能な項目は以下の通り。 本ページの「要件定義」-「入力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/910524773#4.2.-%E5%85%A5%E5%8A%9B ）で入力元が「入力フォーム」と定義されている項目 登録するボタン 登録するボタンを押下すると、以下のエラーチェックを行う。 その企業に紐づく請求先・振込先マスタがすでに5つある場合は「すでに請求先・振込先マスタが5つあるため、新たにマスタを登録できません。」とエラーメッセージを表示する。 そのほかに入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるかわかるようにエラーメッセージを表示する。 登録するボタンを押下し入力項目に問題なければ、データベースにレコードを保存し、作成したことを示すポップアップを表示する。ポップアップには閉じるボタンを表示し、閉じるボタンを押下すると 472_【FIX】請求先マスタ一覧閲覧機能 に遷移する。 入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるかわかるようにエラーメッセージを表示する。 キャンセルボタンを押下すると 472_【FIX】請求先マスタ一覧閲覧機能 に遷移する。 新規登録で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、管理者ID( 【FIX】全体管理者登録情報 のユーザー番号)、請求先・振込先マスタ番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 要求に記載の通り 3.2. 帳票 概要に記載の通り。 3.3. メールテンプレート なし 3.4. ワークフロー なし 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 請求先・振込先マスタ作成画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=89577-133654&amp;mode=design&amp;t=RtX5Kz78tSMbtcmp-0 4.1.2. 請求先・振込先マスタ 新規作成完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=89577-133864&amp;mode=design&amp;t=RtX5Kz78tSMbtcmp-0 4.2. 入力 変数名、説明、バリデーションは各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限 1 名称 &nbsp; 入力フォーム 初期値なし 必須 2 FM請求集計ID 入力フォーム 初期値なし 必須 3 回収サイクル 入力フォーム 初期値＝▼選択してください 必須 4 入金締日 入力フォーム 初期値なし 必須 5 請求締日 入力フォーム 初期値なし 必須 6 手数料 入力フォーム 初期値なし 必須 7 請求先：郵便番号 入力フォーム 初期値なし 必須 8 請求先：都道府県 入力フォーム 初期値＝▼選択してください 必須 9 請求先：市区町村 入力フォーム 初期値＝▼選択してください 必須 10 請求先：以降の住所 &nbsp; 入力フォーム 初期値なし 必須 11 請求先：企業名 入力フォーム 初期値なし 必須 12 請求先：担当部署 入力フォーム 初期値なし 13 請求先：担当者名 入力フォーム 初期値なし 必須 14 振込先：金融機関番号 入力フォーム 初期値なし 15 振込先：金融機関名 入力フォーム 初期値なし 初期値＝みずほ銀行 必須 編集できない状態にする 16 振込先：支店番号 入力フォーム 初期値なし 17 振込先：支店名 入力フォーム 初期値なし 必須 18 振込先：口座種別 入力フォーム 初期値＝▼選択してください 初期値＝普通口座 必須 編集できない状態にする 19 振込先：口座番号 入力フォーム 初期値なし 必須 4.3. 出力 説明は帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 出力先 説明 1 請求先・振込先マスタ番号 データベース データベースに自動で設定する。 2 名称 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 3 企業番号 データベース 紐づく企業の企業番号を設定する。 4 FM請求集計ID データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 回収サイクル データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 6 入金締日 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 7 請求締日 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 8 手数料 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 9 請求先：郵便番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 10 請求先：都道府県 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 11 請求先：市区町村 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 12 請求先：以降の住所 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 13 請求先：企業名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 14 請求先：担当部署 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 15 請求先：担当者名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 16 振込先：金融機関番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 17 振込先：金融機関名 データベース/ 画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 初期値＝みずほ銀行を出力する。 18 振込先：支店番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 19 振込先：支店名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 20 振込先：口座種別 データベース/ 画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 初期値＝普通口座を表示する。 21 振込先：口座番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 4.4.1. 入力画面表示処理 本ページの「入力」に記載の全ての項目の入力フォームと登録ボタンを配置した画面を表示する。 4.4.2. 新規登録処理 入力フォームからのデータを受け取り、「入力」の定義にしたがって値の妥当性検査をおこなう。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、作成日時、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を作成者/更新者に設定した上でデータベースに新規レコードとして挿入する。 472_【FIX】請求先マスタ一覧閲覧機能 ページへリダイレクトし、新規データ登録が完了したことがわかるようにメッセージを表示する。 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 新規登録画面を表示した場合に下記フォーマットでログを出力する。 User {全体管理者のユーザー番号} started to create company billing account. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 新規登録処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} created company billing account. company_billing_account_number={請求先・振込先マスタ番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {全体管理者のユーザー番号} failed to create company billing account. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "910459114",
  "parentTitle": "470_請求先マスタ管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/910524773/471_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-03-06T08:54:05.887Z",
  "author": "isamu saito",
  "excerpt": "1. 目次 1 6 false list false 2. 概要 本機能は 【作成中】企業：請求先・振込先マスタ のデータを1件新規追加するための機能です。 3. 要求事項 全体管理画面にログインすることができるシステム管理者、塾講師ステーション管理者のみが、 【作成中】企業：請求先・振込先マスタ を新規登録することができる。 新規登録にあたって入力フォームに表示し入力可能な項目は以下の通り。 本..."
}