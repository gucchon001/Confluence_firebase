{
  "id": "717456032",
  "title": "281_【作成中】請求書明細一覧閲覧機能",
  "content": "1. 目次 2. 概要 本機能は1つの 【FIX】請求：基本情報 に紐づく 【FIX】請求：請求明細 の登録済みのデータの一覧を閲覧するための機能です。 3. 要求事項 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみが、概要で挙げた帳票に登録されている情報を一覧で閲覧することができる。 273_【作成中】請求詳細閲覧機能 内に表示するものとする。 登録日時の降順で表示し、並べ替えを行うことはできなくて良い。 レコード一覧の上に次のボタンを表示する 新規作成ボタン 押下すると 282_【作成中】請求書明細新規作成機能 に遷移する。 一覧の各レコードには次の項目を表示する 本ページの「要件定義」-「出力」」-「各レコード情報」欄で出力先として「画面」が定義されている項目 編集ボタン 押下すると 283_【作成中】請求書明細編集機能 へと遷移する。 削除ボタン 押下すると 284_【作成中】請求書明細削除機能 を実行する。 3.1. 権限 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみ 3.2. 帳票 概要の記載と同じ 3.3. メールテンプレート なし 3.4. ワークフロー 270_■請求管理機能 の記載と同じ 4. 要件定義 4.1. ユーザーインターフェース（画面） ※画面全体ではなく、リンク先の「請求明細一覧」の部分のみが本機能に対象です。 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=77634-51840&amp;mode=design&amp;t=uY7ywkRrXazQFETv-4 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 バリデーション 請求番号 URLパラメータ どの請求に紐づく請求書明細一覧を表示するかを指定するための番号。自然数の数字で指定する。 入力がない場合、自然数に変換不可能な文字列が入力された場合、存在しない番号が指定された場合はいずれも404エラーを表示する。 不正な値が入力された場合は404エラーを表示する。 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 4.3.1. ページネーション 出力項目 出力先 説明 件数 画面 表示しているデータの総件数を一覧の上部に表示する。 4.3.2. 各レコード情報 指定されたフィルタリングを適用してデータベースから抽出した商品情報レコードの配列をテーブル組みでページ上に表示する 出力項目 出力先 説明 請求明細番号 画面 データベースから取得した請求書明細情報1レコードの「請求番号」。保存された値が指し示す選択肢のラベルを出力する。 取引日 画面 データベースから取得した請求書明細情報1レコードの「取引日」をYYYY/MM/DDの形式で出力する。 商品名 画面 データベースから取得した請求書明細情報1レコードの「商品番号」をもとに「表示名称」を取得し、適切にHTMLエスケープして表示する。 商品概要 画面 データベースから取得した請求書明細情報1レコードの「商品番号」をもとに「課金形態種別」または「オプション種別」を取得し、設定ファイルから取得した商品種別選択肢のラベルで表示する。なお基本契約の場合は「更新料」と表示する。 単価（税込） 画面 データベースから取得した請求書明細情報1レコードの「単価」を税込で適切にHTMLエスケープして表示する。文頭に&yen;をつけ、3桁ごとにカンマ区切りとする。 件数 画面 データベースから取得した請求書明細情報1レコードの「件数」を適切にHTMLエスケープして表示する。 合計金額 画面 データベースから取得した請求書明細情報1レコードの「金額」を適切にHTMLエスケープして表示する。文頭に&yen;をつけ、3桁ごとにカンマ区切りとする。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 入力された全ての条件をAND結合してデータベースから条件に合致したレコードの総件数を取得する。 レコードの総件数が 100 を超えていた場合、以降は総件数を100件として処理を続行する。 レコードの総件数が0件だった場合、データの抽出を実行しないで0件の請求書明細情報データ配列を生成する。 レコードの総件数が1件以上だった場合、上記の条件をもとにして登録日時の降順に並べて、指定されたページ番号に表示すべき請求書明細情報50件のデータをデータベースから抽出する。 出力の章に記載した出力項目をページ表示できるよう整形し、ページを出力する。 4.5. エラー処理 入力処理でエラーは発生させない。 それ以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 一覧を表示した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} read invoice_billing_item list. invoice_number={請求番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 一覧表示された各レコードの並べ替え機能は提供しない",
  "parentId": "718798916",
  "parentTitle": "280_■請求書明細管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/717456032/281_",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-12-14T02:25:37.131Z",
  "author": "元ユーザー (Deleted)",
  "excerpt": "1. 目次 2. 概要 本機能は1つの 【FIX】請求：基本情報 に紐づく 【FIX】請求：請求明細 の登録済みのデータの一覧を閲覧するための機能です。 3. 要求事項 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみが、概要で挙げた帳票に登録されている情報を一覧で閲覧することができる。 273_【作成中】請求詳細閲覧機能 内に表示するものとする。 登録日時の降順で表示し、並べ..."
}