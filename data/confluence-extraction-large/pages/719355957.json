{
  "id": "719355957",
  "title": "445_【FIX】管理者削除機能",
  "content": "1. 目次 2. 概要 登録した全体管理者情報を、管理画面の管理者一覧ページで削除するための機能。 また、全体管理者削除による影響の概要は 【レビュー中】レコード削除時の動作一覧 に記載している。 3. 要求事項 441_【FIX】管理者一覧閲覧機能 ページの該当レコード内にある削除用ボタンを押下し、削除確認モーダル上で削除実行用のボタンを押下することで、対象の全体管理者情報を論理削除することができる。 削除確認用モーダルには、本ページの「要件定義」-「出力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/719355957#4.3.-%E5%87%BA%E5%8A%9B ）で出力先として「画面」が定義されている項目を表示する。 ただし 、操作している全体管理者自身の情報は削除不可とし、 441_【FIX】管理者一覧閲覧機能 においても削除用ボタンを配置しない。自身の情報を削除したい場合は、他の全体管理者に削除してもらうこととする。 削除に成功すると、削除されたことがわかる表示がされると同時に、 441_【FIX】管理者一覧閲覧機能 ページへ遷移する。削除に失敗した場合はエラーメッセージが表示される。（規制は要件定義で定義する。） 全体管理者情報は削除時に本ページの「要件定義」-「出力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/719355957#4.3.-%E5%87%BA%E5%8A%9B ）で説明欄に匿名化する旨の記載がある項目の 匿名化を行う 。 削除後は 441_【FIX】管理者一覧閲覧機能 ページから非表示となる。 削除に成功した場合、以下の情報が入ったログを出力する。 削除日時、削除操作を実施した全体管理者のユーザー番号、削除された全体管理者のユーザー番号、アクセス元IPアドレス、ユーザーエージェント 3.1. 権限 システム管理者のみが、全体管理者を削除することができる。 3.2. 帳票 【FIX】全体管理者登録情報 3.3. メールテンプレート なし 3.4. ワークフロー 【FIX】全体管理者登録・削除フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 全体管理者削除確認画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1806%3A29443&amp;t=r3IqqflxoqksJqnt-1 4.1.1.1. 全体管理者削除完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1806%3A29425&amp;t=r3IqqflxoqksJqnt-1 4.2. 入力 変数名、説明、バリデーションは、 【FIX】全体管理者登録情報 の記載を前提とし、本ページに固有の特記事項のみ記載する。 440_【FIX】管理者管理機能 に記載の共通入力・取得項目は項目自体を省略する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 ユーザー番号 入力フォーム（隠しフォーム） 削除する対象の 【FIX】全体管理者登録情報 のユーザー番号 4.3. 出力 出力項目 出力先 説明 1 ユーザー番号 画面 HTMLエスケープ処理をして出力する。 2 氏名 画面／データベース HTMLエスケープ処理をして出力する。 データベースへの保存時に匿名化する。 3 氏名（フリガナ） データベース データベースへの保存時に 匿名化する 。 4 メールアドレス 画面／データベース HTMLエスケープ処理をして出力する。 データベースへの保存時に匿名化する。匿名化処理は 共通要件 の記載に従う。 5 画像 データベース 削除する 6 ニックネーム データベース データベースへの保存時に匿名化する。 7 PR データベース データベースへの保存時に匿名化する。 8 自己紹介ページURL データベース データベースへの保存時に匿名化する。 9 削除者 データベース 【作成中】帳票共通項目 に従う。 10 削除日時 データベース 【作成中】帳票共通項目 に従う。 4.4. 処理 ログイン認証トークンを基にログイン済みのユーザー番号を取得する。 ログイン済みでないもしくは存在しないユーザー番号の場合はは管理者ログイン画面にリダイレクトする。 削除ボタンがクリックされると削除を確認するためのポップアップを表示し、削除確認のメッセージ「本当に管理者アカウントを削除しますか？」とユーザー番号、氏名、メールアドレスを表示する。 削除が拒否された場合、以降のステップをスキップし処理を終了する。 削除が同意された場合、URLパラーメタのユーザー番号を取得する。 削除対象の管理者が存在しない場合、以降のステップをスキップし処理を終了。ステータス404を返却しnotfoundページを表示する。 削除対象の管理者が存在する場合、論理削除とし、削除時間のみを記録し処理を終了。削除が完了した旨を表示し、成功ログを出力、 441_【FIX】管理者一覧閲覧機能 ページに遷移する。 4.5. エラー処理 設定ファイルが存在しない、データベースにテーブル・フィールドが存在しない、メールテンプレートファイルが存在しない場合はプログラム上で特別な処理を行わず、Laravelの例外出力に任せる。 4.6. ログ 4.6.1.1. 削除成功ログ 削除処理 を実行した場合に下記フォーマットでログを出力する 成功 User {操作を実行する全体管理者のユーザー番号} deleted administrator. user_number={削除対象の全体管理者のユーザー番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗 User {操作を実行する全体管理者のユーザー番号} failed to delete administrator. user_number={削除対象の全体管理者のユーザー番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "703791312",
  "parentTitle": "440_【FIX】管理者管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/719355957/445_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-12-19T09:23:25.235Z",
  "author": "feng_xiaomeng (Unlicensed)",
  "excerpt": "1. 目次 2. 概要 登録した全体管理者情報を、管理画面の管理者一覧ページで削除するための機能。 また、全体管理者削除による影響の概要は 【レビュー中】レコード削除時の動作一覧 に記載している。 3. 要求事項 441_【FIX】管理者一覧閲覧機能 ページの該当レコード内にある削除用ボタンを押下し、削除確認モーダル上で削除実行用のボタンを押下することで、対象の全体管理者情報を論理削除することがで..."
}