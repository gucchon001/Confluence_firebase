{
  "id": "704676226",
  "title": "452_【FIX】アカウント設定編集機能",
  "content": "1. 目次 2. 概要 全体管理者が全体管理画面にて自身のアカウント情報を編集するための機能。 3. 要求事項 画面には以下の項目を表示する。 本ページ の 「要件定義」-「入力」 で入力元が「入力フォーム」と定義されているもの 本ページの 「要件定義」-「出力」 欄で 出力先 が「画面」と定義されているもの 453_【作成中】パスワード再設定機能 への導線 更新するボタン押下すると、エラーがなければそのまま編集した入力フォームの内容をデータベースに保存し、 システム全体に適用し、編集完了のポップアップを表示する。ポップアップには閉じるボタンを表示し、押下するとポップアップを閉じる。 キャンセルボタンを押下すると入力項目を保存せずに 【作成中】461_全体管理トップ に遷移する。 アカウント情報編集で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、 管理者ID( 【FIX】全体管理者登録情報 のユーザー番号) 、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 全体管理画面にログインできる全体管理者のみ 3.2. 帳票 【FIX】全体管理者登録情報 3.3. メールテンプレート なし 3.4. ワークフロー 450_■アカウント管理機能 に従う。 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. アカウント設定編集画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=35001-18148&amp;mode=design&amp;t=K0CYYpGWUYsgUvKP-0 4.1.2. アカウント設定編集完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=35001-18966&amp;mode=design&amp;t=xFKwcBvaqZCXyfmo-0 4.2. 入力 変数名、説明、バリデーションは、 【FIX】全体管理者登録情報 の 記載を前提とし、本ページに固有の特記事項のみ記載する。 440_【FIX】管理者管理機能 に記載の共通入力・取得項目は項目自体を省略する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 ユーザー番号 Cookie セッションIDからログインしているユーザーを割り出す 2 管理者種別 &hellip; 入力フォーム 初期値＝データベースから読み込んだ値 必須 権限 においてシステム管理者に該当するもののみ編集可能である。それ以外のものがアクセスした場合は編集ができない。 3 IPアドレス制限 入力フォーム 初期値＝データベースから読み込んだ値 必須 権限 においてシステム管理者に該当するもののみ編集可能である。それ以外のものがアクセスした場合は編集ができない。 4 氏名 入力フォーム 初期値＝データベースから読み込んだ値 必須 5 氏名（フリガナ） 入力フォーム 初期値＝データベースから読み込んだ値 必須 6 画像 入力フォーム 初期値＝データベースから読み込んだファイルを表示する ファイル形式での入力を受け付ける そのほかの要件は 共通要件 に従う。 7 ニックネーム 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー「20文字以内で入力」 8 PR 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー「1000文字以内で入力」 9 自己紹介ページURL 入力フォーム 初期値＝データベースから読み込んだ値 プレースホルダー「255文字以内で入力」 4.3. 出力 説明は、 【FIX】全体管理者登録情報 の記載を前提とし、本ページに固有の特記事項のみ記載する。 440_【FIX】管理者管理機能 に記載の共通出力項目は項目自体を省略する。 出力項目 出力先 説明 1 メールアドレス 画面 HTMLエスケープ処理をして出力する。 454_【FIX】メールアドレス変更機能 への導線を表示する。 2 管理者種別 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 3 IPアドレス制限 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 4 氏名 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 氏名（フリガナ） データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 6 画像 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に表示、エラーがない場合はデータベースに保存する。 7 ニックネーム データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 8 PR データベース/画面 画面の対象フォーム内に入力された改行を維持したままHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 9 自己紹介ページURL データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 10 更新者 データベース 【作成中】帳票共通項目 に従う 11 更新日時 データベース 【作成中】帳票共通項目 に従う 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトする。 セッションIDからユーザー番号の文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定されたユーザー番号でデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 画面表示処理 該当するレコードが見つかったら 、「出力」 （ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676226/452+FIX#4.3.-%E5%87%BA%E5%8A%9B ） に記載の通り、表示項目と入力可能項目に項目値を反映させて画面を出力し処理を終了する。 4.4.2. 編集処理 該当するレコードが見つかったら、「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676226/452+FIX#4.2.-%E5%85%A5%E5%8A%9B ） に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で編集フォーム画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 更新したことを示すポップアップを表示し処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 編集画面に遷移した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} started to update its profile. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 編集処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} updated its profile. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to update its profile. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 同時編集に対する明示的な対策は施さない。 同時に編集が実行された際は後勝ちとし、後から保存ボタンを押して実行した時の編集値が適用される。 編集画面において他のウィンドウ・タブが本機能にアクセスしたことをアプリケーションは検知しない。",
  "parentId": "721027302",
  "parentTitle": "450_■アカウント管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704676226/452_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-10-30T05:38:47.441Z",
  "author": "元ユーザー (Deleted)",
  "excerpt": "1. 目次 2. 概要 全体管理者が全体管理画面にて自身のアカウント情報を編集するための機能。 3. 要求事項 画面には以下の項目を表示する。 本ページ の 「要件定義」-「入力」 で入力元が「入力フォーム」と定義されているもの 本ページの 「要件定義」-「出力」 欄で 出力先 が「画面」と定義されているもの 453_【作成中】パスワード再設定機能 への導線 更新するボタン押下すると、エラーがなけ..."
}