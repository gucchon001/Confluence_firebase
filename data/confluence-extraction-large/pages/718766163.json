{
  "id": "718766163",
  "title": "276_【FIX】請求一括発行機能・請求一括承認機能",
  "content": "1. 目次 2. 概要 本機能は 選択された請求書に対する請求書PDFの一括発行 その全てのPDFおよび紐づく親請求の一括承認 を行うための機能です。 3. 要求事項 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみが本機能を利用することができる。 【FIX】請求：請求書PDF を1つ以上作成するとともに、 【FIX】請求：請求書PDF およびそれに対応する登録済みの 【修正中】請求：基本情報 1件の登録済み情報を編集することができる。 一括発行ボタン 押下すると確認モーダルを表示する。確認モーダルには以下の項目を表示する。 キャンセルボタン 一括発行を行うボタン 一括承認ボタン 押下すると確認モーダルを表示する。確認モーダルには以下の項目を表示する。 キャンセルボタン 一括承認を行うボタン キャンセルボタンを押下すると編集を取り消しモーダルを閉じる。 一括発行 ＆承認を行う ボタンを押下すると 、入力内容にエラーがあれば更新はせずにエラーの内容を表示する。エラーがなければ、 271_【FIX】請求一覧閲覧・検索機能 にてボタン押下時点で絞り込まれている、 請求明細を持つ 全ての請求について以下の処理を行う。処理を開始すると処理開始通知ポップアップを表示する。 各請求について、 303_【FIX】請求書PDF発行機能 を実行する。 発行された請求書PDFファイルに対しては、 303_【FIX】請求書PDF発行機能 の通り 順次署名処理を行う。 処理開始通知ポップアップには閉じるボタンを配置し、押下するとポップアップを閉じる。 一括承認ボタンを押下すると、 271_【FIX】請求一覧閲覧・検索機能 にてボタン押下時点で絞り込まれている、 請求書PDFを持つ 全ての請求について以下の処理を行う。 それぞれのPDFファイルについて、 【FIX】請求：請求書PDF のステータスを「承認」に更新し、 【修正中】請求：基本情報 の「承認時間」に現在時間を設定する。 承認された請求書PDFファイルに対して順次署名処理を行う。 処理開始通知ポップアップには閉じるボタンを配置し、押下するとポップアップを閉じる。 3.1. 権限 要求に記載の通り。 3.2. 帳票 【修正中】請求：基本情報 【FIX】請求：請求書PDF 3.3. メールテンプレート なし 3.4. ワークフロー 270_■請求管理機能 に同じ。 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 確認モーダル https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=96357-28952&amp;mode=design&amp;t=QBsSKlavow4JGkgE-4 4.1.2. 処理開始通知ポップアップ https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=96357-28969&amp;mode=design&amp;t=QBsSKlavow4JGkgE-4 4.2. 入力 変数名、説明、バリデーションは、各帳票の記載を前提とし、本ページに固有の特記事項のみ記載する また 303_【FIX】請求書PDF発行機能 の処理で必要な入力項目は該当機能の記載に従う。 項目名 変数名 入力元 説明 バリデーション 請求番号 URL PDFを発行し承認する対象の請求の請求番号を複数指定する。 入力がない、または、自然数ではない、または指定IDのレコードがデータベースに存在しない場合 エラーメッセージは出力せずレスポンスステータスを404 not foundとする 4.3. 出力 変数名、説明、バリデーションは、各帳票の記載を前提とし、本ページに固有の特記事項のみ記載する。 また 303_【FIX】請求書PDF発行機能 の処理で必要な出力項目は該当機能の記載に従う。 項目名 出力先 説明 1 ステータス データベース 【FIX】請求：請求書PDF のステータスを、「承認」とする。 2 承認日時 データベース 【修正中】請求：基本情報 の制限に従う。 3 更新者 データベース 【FIX】請求：請求書PDF と 【修正中】請求：基本情報 のそれぞれで、処理を行った 全体管理者のユーザー番号 を設定する。 4 更新時間 データベース 【FIX】請求：請求書PDF と 【修正中】請求：基本情報 のそれぞれで、更新した時刻を設定する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合、または管理者権限でログインしていない場合は全体管理者画面のログイン画面にリダイレクトする。 URL文字列または隠しフォーム入力からID文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定されたIDでデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 一括発行処理 該当するレコードが見つかったら、要求に記載の通り 303_【FIX】請求書PDF発行機能 を実行する。 4.4.2. 一括承認 編集 処理 「出力」で定義した項目値と、更新日時を操作している現在時刻とし、操作を行なっている管理者のIDを更新者IDに設定した上でデータベースの該当レコードを更新する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 一括発行処理を 開始した 際に以下のログを表示する。 User {管理者のユーザー番号} started to publish invoice. invoice_numbers={処理対象の請求の請求番号をカンマ区切りで出力する} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 一括承認処理を 開始した 際に以下のログを表示する。 User {管理者のユーザー番号} started to approve invoice. invoice_numbers={処理対象の請求の請求番号をカンマ区切りで出力する} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 一括発行処理を 終了した 際に以下のログを表示する。 User {管理者のユーザー番号} finished to publish invoice. invoice_numbers={処理対象の請求の請求番号をカンマ区切りで出力する} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 一括承認処理を 終了した 際に以下のログを表示する。 User {管理者のユーザー番号} finished to approve invoice. invoice_numbers={処理対象の請求の請求番号をカンマ区切りで出力する} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} エラーがあった場合は、エラーがあった処理に応じて次のログを表示する。 PDF生成にエラーがあった場合 303_【FIX】請求書PDF発行機能 で定義している。 署名処理にエラーがあった場合 303_【FIX】請求書PDF発行機能 で定義している。 承認処理にエラーがあった場合 303_【FIX】請求書PDF発行機能 で定義している。 5. 制限事項 なし",
  "parentId": "704414005",
  "parentTitle": "270_■請求管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/718766163/276_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-05-31T02:16:12.116Z",
  "author": "元ユーザー (Deleted)",
  "excerpt": "1. 目次 2. 概要 本機能は 選択された請求書に対する請求書PDFの一括発行 その全てのPDFおよび紐づく親請求の一括承認 を行うための機能です。 3. 要求事項 管理画面にログインできるシステム管理者、塾講師ステーション管理者のみが本機能を利用することができる。 【FIX】請求：請求書PDF を1つ以上作成するとともに、 【FIX】請求：請求書PDF およびそれに対応する登録済みの 【修正中..."
}