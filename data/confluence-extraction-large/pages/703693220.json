{
  "id": "703693220",
  "title": "154_【FIX】教室グループ編集機能",
  "content": "1. 目次 2. 概要 本機能は登録済みの 【FIX】教室グループ 、 【FIX】教室グループ-企業紐付け データの編集のための機能です。 3. 要求事項 全体管理画面にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者が利用することができる。 記事担当者、ギフト券担当者は本機能を利用することはできない。 教室グループ自体の情報を編集する「編集」、および、企業との紐付けを編集する「企業割り当て」機能について以下の通りとする。 企業割り当て 151_【FIX】教室グループ一覧閲覧機能 の教室グループの表に記載されている教室グループIDテキストリンクを押下すると、本機能を行う 153_【FIX】教室グループ詳細閲覧機能 ページに遷移する。 教室グループの詳細情報（ 153_【FIX】教室グループ詳細閲覧機能 にて定義）の下部に下記を表示する。 本ページの「要件定義」-「入力」- 「企業割り当て」欄で入力元が「入力フォーム」と定義されている項目の入力フォーム 設定するボタン 押下すると、入力された企業の紐付けデータを保存する。 表示可能なレコードの 総数 紐付けされている企業の一覧 表形式で表示する。 出力項目は本ページの「要件定義」-「出力」- 「企業割り当て」欄で出力先として「画面」が定義されている項目の内、企業情報レコードとして定義されている項目を表示する。 ページネーションは行わない。 表示上限は1,000件とする。 企業割り当て解除ボタン 押下すると、企業割り当て一覧で選択した企業の割り当てを解除する。 編集 151_【FIX】教室グループ一覧閲覧機能 または 153_【FIX】教室グループ詳細閲覧機能 の「編集」ボタンを押下すると編集画面に遷移する。 登録されている 【FIX】教室グループ 1件の登録済み情報を閲覧し、本ページの「要件定義」-「入力」 - 「編集」欄で入力元が「入力フォーム」と定義されている項目を編集することができる。 画面上には以下の項目を表示する 本ページの「要件定義」-「入力」- 「編集」欄で入力元が「入力フォーム」と定義されている項目の、保存された項目値が反映された入力フォーム 本ページの「要件定義」-「出力」- 「編集」欄で出力先として「画面」が定義されている項目の名称と保存された項目値 「キャンセル」ボタン 押下することで編集を取り消し、 153_【FIX】教室グループ詳細閲覧機能 に遷移する。 「更新する」ボタン 押下することで、編集した入力フォームの内容をデータベースに保存し、システム全体に適用する。 3.1. 権限 150_【FIX】教室グループ管理機能 3.2. 帳票 150_【FIX】教室グループ管理機能 3.3. メールテンプレート 本機能で扱うメールテンプレートページへのリンクです 3.4. ワークフロー 3.4.1. 本機能 本機能の利用シーンを示しているワークフローへのリンクです 3.4.2. 関連 【FIX】教室登録・公開・削除フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 企業割り当て https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=2078-31962&amp;mode=design&amp;t=NjxhWWuTHzNsiC94-0 4.1.2. 編集 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=2117-35277&amp;mode=design&amp;t=UcPKicOqscjBXGK7-4 4.1.3. 教室グループ更新完了 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=2489-34690&amp;mode=design&amp;t=NjxhWWuTHzNsiC94-0 4.1.4. 企業割り当て完了 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=2489-34691&amp;mode=design&amp;t=NjxhWWuTHzNsiC94-0 4.1.5. 企業割り当て解除完了 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=10558-63994&amp;mode=design&amp;t=NjxhWWuTHzNsiC94-0 4.2. 入力 変数名、説明、バリデーションは、 【FIX】教室グループ 、 【FIX】教室グループ-企業紐付け の記載を前提とし、本ページに固有の特記事項のみ記載する。 150_【FIX】教室グループ管理機能 に記載の共通入力・取得項目は項目自体を省略する。 4.2.1. 企業割り当て 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 企業（企業番号） 入力フォーム 企業割り当て用 コンボボックスによる複数選択。 選択肢の表示形式は「[企業コード]_[企業名]」とする。 初期値はなし。 121-2_【FIX】企業検索API を使い、テキストエリアに入力された文字列との中間一致で検索して抽出した企業を選択肢として表示し、表示された選択肢から選択することで「企業番号」が入力される。 2 企業（企業番号） 入力フォーム 企業割り当て解除用 チェックボックスによる複数選択。 4.2.2. 編集 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 教室グループ名 入力フォーム 初期状態 データベースから読み込んだ値 必須 2 教室グループ名カナ 入力フォーム 初期状態 データベースから読み込んだ値 必須 3 紹介文 仕事内容 入力フォーム 初期状態 データベースから読み込んだ 【FIX】教室グループ の「紹介文」の 値 4 画像 入力フォーム 初期値なし 「ファイルを選択」ボタンを押下すると、画像管理のモーダルが表示され、画像の選択が可能。 選択された画像は選択後に表内でに表示される。 画像が選択された状態で「更新」ボタンを押下すると、選択画像の変更ができる。 画像が選択されている場合「ファイルを削除」ボタンが表示され、押下すると画像の選択を解除することができる。 画像が選択されていない状態で「更新」ボタンを押下すると、確認ダイアログは表示せずに、登録されている画像を削除する。 5 管理用メモ 入力フォーム 初期状態 データベースから読み込んだ値 6 SEO title：ステーション 入力フォーム 初期状態 データベースから読み込んだ値 7 SEO description：ステーション 入力フォーム 初期状態 データベースから読み込んだ値 8 SEO keywords：ステーション 入力フォーム 初期状態 データベースから読み込んだ値 9 SEO h1：ステーション 入力フォーム 初期状態 データベースから読み込んだ値 10 SEO title：キャリア 入力フォーム 初期状態 データベースから読み込んだ値 11 SEO description：キャリア 入力フォーム 初期状態 データベースから読み込んだ値 12 SEO keywords：キャリア 入力フォーム 初期状態 データベースから読み込んだ値 13 SEO h1：キャリア 入力フォーム 初期状態 データベースから読み込んだ値 14 質問1 入力フォーム 初期状態 データベースから読み込んだ値 15 回答1 入力フォーム 初期状態 データベースから読み込んだ値 テキストエリアとする。 16 質問2 入力フォーム 初期状態 データベースから読み込んだ値 17 回答2 入力フォーム 初期状態 データベースから読み込んだ値 テキストエリアとする。 18 質問3 入力フォーム 初期状態 データベースから読み込んだ値 19 回答3 入力フォーム 初期状態 データベースから読み込んだ値 テキストエリアとする。 20 質問4 入力フォーム 初期状態 データベースから読み込んだ値 21 回答4 入力フォーム 初期状態 データベースから読み込んだ値 テキストエリアとする。 22 質問5 入力フォーム 初期状態 データベースから読み込んだ値 23 回答5 入力フォーム 初期状態 データベースから読み込んだ値 テキストエリアとする。 4.3. 出力 4.3.1. 企業割り当て 出力項目 出力先 説明 1 件数 画面 表示可能なデータの総件数を表の上部に表示する。 2 企業情報配列 画面 指定されたフィルタリングを適用してデータベースから抽出した企業情報レコードの配列をテーブル組みでページ上に表示する。各レコードの表示データは以下「企業情報：」プレフィックスで始まる出力項目として説明する。 3 企業情報：企業名 画面 データベースから取得した企業情報1レコードの「企業名」を適切にHTMLエスケープして表示する。 4 企業情報：企業コード 画面 データベースから取得した企業情報1レコードの「企業コード」を表示する。 5 企業情報：管理メモ１ 画面 データベースから取得した企業情報1レコードの「管理メモ１」を適切にHTMLエスケープして表示する。 6 企業情報：管理メモ2 画面 データベースから取得した企業情報1レコードの「管理メモ2」を適切にHTMLエスケープして表示する。 7 作成日時 画面 YYYY-mm-dd H:i:s形式の文字列で出力する。 初めて企業割り当てをおこなった時のみ出力する。 8 作成者 画面 保存された管理者IDが示すユーザーの名前を表示する。 初めて企業割り当てをおこなった時のみ出力する。 9 更新日時 画面 YYYY-mm-dd H:i:s形式の文字列で出力する。 10 更新者 画面 保存された管理者IDが示すユーザーの名前を表示する。 4.3.2. 編集 出力項目 出力先 説明 1 教室グループID 画面 HTMLエスケープ処理をして出力する。 2 教室グループ番号 画面 HTMLエスケープ処理をして出力する。 3 教室グループ名 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 4 教室グループ名カナ データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 紹介文 仕事内容 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をして 【FIX】教室グループ の「紹介文」として データベースに保存する。 6 画像 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 7 管理用メモ データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 8 SEO title：ステーション データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 9 SEO description：ステーション データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 10 SEO keywords：ステーション データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 11 SEO h1：ステーション データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 12 SEO title：キャリア データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 13 SEO description：キャリア データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 14 SEO keywords：キャリア データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 15 SEO h1：キャリア データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 16 質問1 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 17 回答1 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 18 質問2 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 19 回答2 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 20 質問3 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 21 回答3 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 22 質問4 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 23 回答4 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 24 質問5 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 25 回答5 データベース/画面 画面の対象フォーム内にHTMLエスケープ処理をして出力、入力エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 26 更新日時 画面 YYYY-mm-dd H:i:s形式の文字列で出力する。 27 更新者 画面 保存された管理者IDが示すユーザーの名前を表示する。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 URL文字列または隠しフォーム入力から教室グループ番号文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定された教室グループ番号でデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 編集フォーム画面表示処理 該当するレコードが見つかったら、「出力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/703693220#4.3.-%E5%87%BA%E5%8A%9B ） に記載の通り、表示項目と入力可能項目に項目値を反映させて画面を出力し処理を終了する。 4.4.2. 編集処理・企業割り当て処理・企業割り当て解除処理 該当するレコードが見つかったら、「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/703693220#4.2.-%E5%85%A5%E5%8A%9B ） に記載の入力項目値の妥当性検査を行う。 紐付けされている企業の一覧における絞り込み機能は、UIフレームワークの標準機能（ https://demo.pixelcave.com/codebase/be_tables_datatables.html ）を用いる。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で編集フォーム画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 該当のレコードの保存した情報を閲覧できる 153_【FIX】教室グループ詳細閲覧機能 へリダイレクトし処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 編集画面に遷移した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} started to update brand . brand _number={教室グループ番号} brand _id={教室グループID} brand _name={教室グループ名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 編集処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} updated brand . brand _number={教室グループ番号} brand _id={教室グループID} brand _name={教室グループ名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to update brand . brand _number={教室グループ番号} brand _id={教室グループID} brand _name={教室グループ名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 企業割り当て処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} created the relation between brand and company. brand _number={教室グループ番号} company_number={企業番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to create the relation between brand and company. brand _number={教室グループ番号} company_number={企業番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 企業割り当て解除処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} deleted the relation between brand and company. brand _number={教室グループ番号} company_number={企業番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to delete the relation between brand and company. brand _number={教室グループ番号} company_number={企業番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 同時編集に対する明示的な対策は施さない。 同時に編集が実行された際は後勝ちとし、後から保存ボタンを押して実行した時の編集値が適用される。 編集画面において他のユーザーまたは他のウィンドウ・タブが本機能にアクセスしたことをアプリケーションは検知しない。",
  "parentId": "704413785",
  "parentTitle": "150_【FIX】教室グループ管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/703693220/154_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-10-10T09:01:17.324Z",
  "author": "元ユーザー (Deleted)",
  "excerpt": "1. 目次 2. 概要 本機能は登録済みの 【FIX】教室グループ 、 【FIX】教室グループ-企業紐付け データの編集のための機能です。 3. 要求事項 全体管理画面にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者が利用することができる。 記事担当者、ギフト券担当者は本機能を利用することはできない。 教室グループ自体の情報を編集する「編集」、および、企業との紐付け..."
}