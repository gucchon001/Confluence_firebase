{
  "id": "960495761",
  "title": "922_【FIX】契約データ移行バッチ",
  "content": "1. 概要 本バッチプログラムは、トモノカイ社から提供されるCSVファイルとインポート済みのデータから、新システムにおける下記データを作成してデータベースに保存する処理をおこなう。 【FIX】契約情報（統合版） ※旧システムで有効な契約は有効に動作する契約として取り込む必要がある。 【FIX】急募オプション申込付帯情報 本バッチ処理の実行は、事前に旧システムから下記データが移行されてインポートされていることを前提とする。 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：請求先・振込先マスタ 【FIX】企業：設定情報（クライアント企業向け） 【FIX】教室グループ 【FIX】教室グループ-企業紐付け 【FIX】商品マスタ（統合版） 2. 要求事項 コマンドラインで実行することができる。 コマンドを実行する際にのコマンドラインオプションで、インポート用CSVファイルのファイルパスを指定することができる。 同時に最大1万件まで処理できるものとし4時間以内に1万件が処理できるパフォーマンスを確保する。 処理の開始時と終了時に開始・終了した旨のメッセージとバッチ処理名称、現在日時を含むログを出力する。 【FIX】商品マスタ（統合版） から全ての商品情報を読み込む。 CSVファイル を読み込み、１行ずつ読み込みながらインポート済みの情報を収集し、新システムにおける適切な 【FIX】契約情報（統合版） の必要なレコード（以下、「契約レコード」という）を生成して保存する。CSVの各行に対する処理は下記の通りとする。 CSVファイルの１行に対して契約レコードは「基本契約」「成果報酬商品契約1」「成果報酬商品契約2」「 成果報酬商品契約4 」 「 成果報酬商品契約5 」の6 レコードは必ずセットで作成・更新する必要がある。 CSVファイルの１行に対して、基本契約に紐づく「オファー商品契約」 「オプション商品」 は;（セミコロン）区切りで入力されたオファー商品IDの数の分だけ契約レコードを作成する必要がある。 CSVファイルの１行に対して、 急募契約 に紐づく「急募オプション申込付帯情報」は;（セミコロン）区切りで入力された急募対象求人IDの数の分だけレコードを作成する必要がある。 CSVファイルの１行に対してトランザクション処理を行うものとし、トランザクション中にエラーが発生した場合は対象の行の処理をロールバックしてスキップしコマンド実行中のコンソールとログの両方に失敗した行番号とid列の値と失敗理由（CSVのどの列の値がどういう理由で失敗したか分かるように）を出力しする。 CSVのid列に値が入っていない場合は新規作成、 値が入っていてデータベースにすでにレコードが存在する場合は既存のレコードを更新 、値が入っていてデータベースにレコードが存在しない場合は新規作成する。 契約レコードの作成の規則は https://docs.google.com/spreadsheets/d/1hGhCzYGJ4jV80iKHy-67408pza9CaFHUPDz0EEnZd_c/edit#gid=1118624703 を参照して各フィールドの値を取得・生成して契約レコード情報を作成し新規挿入または更新をおこなう。 CSVの各行のトランザクションが成功したら行単位で処理が成功した旨を行番号とid列の値を含めてログに出力する。 2.1. インポートCSVファイルフォーマット https://docs.google.com/spreadsheets/d/1hGhCzYGJ4jV80iKHy-67408pza9CaFHUPDz0EEnZd_c/edit#gid=2067574915 2.2. 新旧データ対応表 https://docs.google.com/spreadsheets/d/1hGhCzYGJ4jV80iKHy-67408pza9CaFHUPDz0EEnZd_c/edit#gid=1118624703 2.3. 旧システムサンプルデータ https://drive.google.com/drive/u/0/folders/1BUmsRFhroM0gUeCQOP1-8qaKvm7e-YlQ 3. 要件定義 3.1. 入力 3.2. 出力 3.3. 処理 3.4. エラー処理 3.5. ログ バッチ略称はimport initial contracts (IIC) とする。 バッジ処理全体が開始した時と終了した時に以下のログを出力する。 開始時 [922_IIC] started at {処理開始日時}. 終了時 [922_IIC] finished at {処理終了日時}. 各行のレコード追加・更新時に以下のログを出力する。 成功時 [922_IIC] [created / updated] contract. file_name={インポートファイル名} row_number={CSV行番号} contract_number={契約番号} urgent_option_number={急募オプション付帯情報番号} ※急募オプションがある場合のみ [項目名]=[変更前],[変更後] ※更新時のみ [項目名]=[変更前],[変更後] ※更新時のみ ・・・ time={現在時刻} . 失敗時 [922_IIC] failed to [create / update] contract. file_name={インポートファイル名} row_number={CSV行番号} field_name={失敗したCSVの列名} reason={失敗理由} time={現在時刻} . 失敗理由については妥当性検査にてエラーになった理由を文章にして出力する。 3.6. 制限事項（スコープ外）",
  "parentId": "1014432099",
  "parentTitle": "920_■商品・契約",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/960495761/922_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-04-18T02:41:53.715Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 概要 本バッチプログラムは、トモノカイ社から提供されるCSVファイルとインポート済みのデータから、新システムにおける下記データを作成してデータベースに保存する処理をおこなう。 【FIX】契約情報（統合版） ※旧システムで有効な契約は有効に動作する契約として取り込む必要がある。 【FIX】急募オプション申込付帯情報 本バッチ処理の実行は、事前に旧システムから下記データが移行されてインポートされ..."
}