{
  "id": "704381384",
  "title": "102_【FIX】商品新規追加機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】商品マスタ（統合版） の新規データを1件を新規登録するための機能です。 3. 要求事項 全体管理画面にログインすることができるシステム管理者、塾ステーション管理者のみが、 【FIX】商品マスタ（統合版） のデータを新規登録することができる。 新規登録にあたって入力フォームに 表示し入力可能とする 項目は下記とする。 本ページの「要件定義」-「入力」欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381384#4.2.-%E5%85%A5%E5%8A%9B ）で入力元が「入力フォーム」と定義されている項目 「登録する」ボタン 「登録する」ボタンを押下すると、入力項目に問題なければ、データベースにレコードを保存し、「 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/713752732 」ページへ遷移して、保存したことが利用者にわかるメッセージを表示する。 入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるかわかるようにエラーメッセージを表示する。 購 入可フラグが「可」と保存された商品は、下記の機能から新規に選択可能とし、「不可」と保存された商品は、選択不可とする。 全体管理画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/714637353 クライアント企業向け管理画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705527850 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705396812 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705265775 公開フラグが「公開」と保存された商品は、下記の機能で選択肢として表示され、「非公開」と保存された商品は、非表示とする。 クライアント企業向け管理画面 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705527850 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705396812 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/705265775 新規登録で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、新規登録を実行した全体 管理者のユーザー番号 、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 システム管理者、塾ステーション管理者のみ 3.2. 帳票 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 の記載と同じ 3.3. メールテンプレート なし 3.4. ワークフロー https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 の記載と同じ 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 商品新規作成画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1834%3A29886&amp;t=D8l394sON9r4knNS-1 4.1.2. 商品新規作成完了画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=1203%3A24093&amp;t=D8l394sON9r4knNS-1 4.2. 入力 変数名、説明、バリデーションは、 【FIX】商品マスタ（統合版） の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 に記載の共通入力・取得項目は項目自体を省略する。 「制限」に「必須」とある場合に入力がない場合のエラーメッセージは統一して「{項目名}を入力してください」とする。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 商品ID 入力フォーム 初期値 なし 必須 2 表示名称 入力フォーム 初期値なし 必須 3 単価 入力フォーム 初期値なし 必須 4 税区分 入力フォーム 初期値=外税 必須 5 税率 入力フォーム 初期値=10 必須 6 単位 入力フォーム 初期値= 式 必須 7 商品種別 入力フォーム 初期値=基本 必須 8 課金形態種別 入力フォーム 初期値なし 「商品種別」が「課金形態」の場合のみ入力可能 必須 9 オプション種別 入力フォーム 初期値なし 「商品種別」が「オプション」の場合のみ入力可能 必須 10 採用課金：雇用形態 入力フォーム 初期値なし 「 課金形態種別」が「採用課金」の場合のみ入力可能 必須 11 採用課金：確定時期 入力フォーム 初期値なし 「 課金形態種別」が「採用課金」の場合のみ入力可能 必須 12 請求タイミング 入力フォーム 初期値なし 以下のいずれかの場合のみ入力可能 課金形態種別が「掲載課金」の場合 オプション種別が「プラン」「新オプション」の場合 必須 13 有効期間：有無フラグ 入力フォーム 入力可能な場合の 初期値=「なし」 「商品種別」によって下記とする。 「基本」の場合：「あり」固定で非活性とする。 「課金形態」の場合：「なし」固定で非活性とする。 「オプション」の場合：入力可能とする。 必須 14 有効期間：月数 入力フォーム 初期値=1 「有効期間：有無フラグ」が「あり」の場合のみ入力可能 必須 15 契約可能月 入力フォーム 初期状態=すべてにチェックあり 必須 「商品種別」が「課金形態」の場合はすべての月が選択された状態で非活性とする。 16 対象サイト 入力フォーム 初期値=ステーション 必須 17 付与 プラン 入力フォーム 初期値なし 18 急募追加数 入力フォーム 初期値=0 必須 19 パーソナルオファー追加数 入力フォーム 初期値=0 必須 20 購入可フラグ 入力フォーム 初期値=可 必須 21 公開フラグ 入力フォーム 初期値=非公開 必須 22 商品詳細1 入力フォーム 初期値なし 23 商品詳細2 入力フォーム 初期値なし 24 商品詳細3 入力フォーム 初期値なし 25 商品詳細4 入力フォーム 初期値なし 26 後継商品番号 入力フォーム 初期値なし コンボボックスによる単一選択。 登録済の商品レコードの中で、下記で絞り込んだ商品を選択肢として表示する。 商品種別が 「基本」 「商品種別」欄で選んだ内容と同じ 選択肢の表示形式は「商品ID_対象サイト_商品種別_単価」とする。 画面の表示項目名は「後継商品」とする。 27 メモ 入力フォーム 初期値なし 4.3. 出力 説明は、 【FIX】商品マスタ（統合版） の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704676285 に記載の共通出力項目は項目自体を省略する。 出力項目 出力先 説明 1 商品ID データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 2 表示名称 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 3 単価 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 4 税区分 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 5 税率 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 6 課税後単価 画面 単価、税区分、税率に応じて画面上で自動計算して文頭に「&yen;」をつけた上で、3桁カンマ区切りにして出力する。例） &yen;1,000,000 7 単位 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 8 商品種別 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 9 課金形態種別 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 10 オプション種別 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 11 採用課金：雇用形態 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 12 採用課金：確定時期 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 13 有効期間：有無フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 14 有効期間：月数 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 15 契約可能月 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 商品種別が「課金形態」の場合は、すべての月が選択された状態として保存する。 16 対象サイト データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 17 付与 プラン データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 18 急募追加数 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 19 パーソナルオファー追加数 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 20 購入可フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 21 公開フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 22 商品詳細1 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 23 商品詳細2 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 24 商品詳細3 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 25 商品詳細4 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 26 後継商品番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 27 メモ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に 入力された改行を維持したまま HTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 28 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 29 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 30 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 31 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 4.4.1. 入力画面表示処理 本ページの「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704381384#4.2.-%E5%85%A5%E5%8A%9B ）に記載の全ての項目の入力フォームと登録ボタンを配置した画面を表示する。 4.4.2. 新規登録処理 入力フォームからのデータを受け取り、「入力」の定義にしたがって値の妥当性検査をおこなう。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、作成日時、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を作成者/更新者に設定した上でデータベースに新規レコードとして挿入する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/717455936 ページへリダイレクトし、新規データ登録が完了したことがわかるように以下のメッセージを表示する。 {商品番号} {表示名称}の商品を新規登録しました。 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.5.1. ログ 新規登録画面を表示した場合に下記フォーマットでログを出力する。 User {全体管理者のユーザー番号} started to create service. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 新規登録処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} created service. service_number={商品番号} service_id={商品ID} service_name={表示名称} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {全体管理者のユーザー番号} failed to create service. service_number={商品番号} service_id={商品ID} service_name={表示名称} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. 制限事項 なし",
  "parentId": "704676285",
  "parentTitle": "100_【FIX】商品管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704381384/102_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-10-15T10:03:42.480Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】商品マスタ（統合版） の新規データを1件を新規登録するための機能です。 3. 要求事項 全体管理画面にログインすることができるシステム管理者、塾ステーション管理者のみが、 【FIX】商品マスタ（統合版） のデータを新規登録することができる。 新規登録にあたって入力フォームに 表示し入力可能とする 項目は下記とする。 本ページの「要件定義」-「入力」欄（ ..."
}