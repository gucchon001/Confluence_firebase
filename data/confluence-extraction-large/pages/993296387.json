{
  "id": "993296387",
  "title": "961_【FIX】請求データ移行バッチ",
  "content": "1. 概要 本バッチプログラムは、トモノカイ社から提供されるCSVファイルとインポート済みのデータから、新システムにおける下記データを作成してデータベースに保存する処理をおこなう。 【修正中】請求：基本情報 【FIX】請求：請求明細 本バッチ処理の実行は、事前に旧システムから下記データが移行されてインポートされていることを前提とする。 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：請求先・振込先マスタ 【FIX】企業：設定情報（クライアント企業向け） 【FIX】教室グループ 【FIX】教室グループ-企業紐付け 【FIX】商品マスタ（統合版） 【FIX】契約情報（統合版） 2. 要求事項 複数のバッチに分けても良いものとする。 コマンドラインで実行することができる。 実行時のパラメータで、CSVファイル名を受け取って実行できるものとする。 コマンドを実行する際のコマンドラインオプションで、CSVファイルを格納しておくフォルダパスを指定することができる。 バッチ処理を開始したら、開始した旨のメッセージと現在日時を含むログを出力する。 CSVファイルの存在チェック、構文チェックを行い、結果のログを出力する。 CSVファイルを読み込み、１行ずつ読み込みながら、必要となるインポート済みの情報を収集し、本システムにおける適切なレコードを生成して保存する。 既に該当するレコードが存在する場合は、既存のレコードの値を更新する。 レコード生成処理を実行したら以下の情報が入ったログを出力する。 実行日時、 請求番号、請求明細番号 、レコードの生成方法（新規作成、更新）、アクション（成功or失敗）、（更新の場合は）変更前後の値 移行データの項目の対応関係、および項目ごとの移行時の変換処理等の内容は後述の新旧データ対応表に従う。 バッチ処理を終了したら、終了した旨のメッセージと終了日時を含むログを出力する。 処理に失敗した場合、成功した部分はロールバックしない。 上記仕様で問題なく処理を実行できる目安となる処理件数は 200,000件 とし、 2時間 以内に最大 200,000件 の処理を行えるパフォーマンスを確保する。 2.1. 新旧データ対応表 https://docs.google.com/spreadsheets/d/1hGhCzYGJ4jV80iKHy-67408pza9CaFHUPDz0EEnZd_c/edit#gid=643548957 2.2. 旧システムサンプルデータ https://drive.google.com/drive/u/0/folders/12NNNk3lbZ5p-A4iN-zdR0_G8ZcWDiHbQ 3. 要件定義 3.1. 入力 3.2. 出力 3.3. 処理 3.4. エラー処理 3.5. ログ バッチ略称はimport invoice (II) とする。 バッジ処理全体が開始した時と終了した時に以下のログを出力する。 開始時 [961_II] started at {処理開始日時}. 終了時 [961_II] finished at {処理終了日時}. 各行のレコード追加・更新時に以下のログを出力する。 成功時 [961_II] [created / updated] [invoice / invoice_billing_item]. file_name={インポートファイル名} row_number={CSV行番号} invoice_number={請求番号} invoice_billing_item_number={請求書明細番号} [項目名]=[変更前],[変更後] ※更新時のみ [項目名]=[変更前],[変更後] ※更新時のみ ・・・ time={現在時刻} . 失敗時 [961_II] failed to [create / update ] [invoice / invoice_billing_item]. file_name={インポートファイル名} row_number={CSV行番号} field_name={失敗したCSVの列名} invoice_number={請求番号} invoice_billing_item_number={請求書明細番号} reason={失敗理由} time={現在時刻} . 失敗理由については妥当性検査にてエラーになった理由を文章にして出力する。 3.6. 制限事項（スコープ外）",
  "parentId": "1015808009",
  "parentTitle": "960_■請求",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/993296387/961_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-04-25T05:30:58.187Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 概要 本バッチプログラムは、トモノカイ社から提供されるCSVファイルとインポート済みのデータから、新システムにおける下記データを作成してデータベースに保存する処理をおこなう。 【修正中】請求：基本情報 【FIX】請求：請求明細 本バッチ処理の実行は、事前に旧システムから下記データが移行されてインポートされていることを前提とする。 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者..."
}