{
  "id": "704610650",
  "title": "334_【FIX】記事編集機能",
  "content": "1. 目次 2. 概要 本機能は記事（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 【FIX】記事カスタムフィールド値 【FIX】記事画像 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 【FIX】記事バージョン ）の登録済みのデータ1件を編集するための機能です。 3. 要求事項 全体管理画面にログインすることができる全体管理者、塾講師ステーション管理者、 ゲスト管理者 、記事管理者、 記事担当者 が本機能を利用することができる。 編集画面に表示する内容はWFの通りとし、特筆すべき内容のみ下記に記載する。 キャンセルボタン 押下することで編集を取り消し、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577796 に遷移する。 「更新する」ボタン 更新するボタンを押下すると、入力内容にエラーがあれば更新はせずにエラーの内容を表示する。エラーがなければそのまま編集した入力フォームの内容をデータベースに保存し、システム全体に適用し、「記事を更新しました」と編集完了のポップアップを表示する。 下記帳票は、変更があった帳票のみ更新される。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 【FIX】記事カスタムフィールド値 【FIX】記事画像 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 下記帳票は、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 に変更があった場合に新たなレコードが作成される。また、「タイトル」「抜粋（要約）」「本文」のいずれかに変更があった場合は、それらに変更があったことを識別するフラグ情報も併せて保存する。 【FIX】記事バージョン 公開日時 Google Chromeの拡張異能「Optimize Next」（バージョン1.3.0）が有効な状態でも、公開日時を選択できるものとする。 ピックアップ表示順フィールド https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704545028 と同様とする。 本文フィールド https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704545028 と同様とする。 本機能へ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1276739586 の「復元」ボタン押下によって遷移した場合は、下記の通りとする。 「タイトル」「抜粋（要約）」「本文」は、復元ボタン押下時に選択した 【FIX】記事バージョン の値がフォームに入力・選択された状態とし、それ以外の項目は通常の編集画面の表示と同様とする。 編集完了のポップアップには閉じるボタン を配置し、押下すると https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577796 に遷移する。 更新に成功または失敗した場合、以下の情報が入ったログを出力する。 日時、全体管理者のユーザー番号、記事番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 要求事項の記載と同じ 3.2. 帳票 概要の記載と同じ 3.3. ワークフロー 3.3.1. 本機能 【FIX】記事登録・公開・非公開・削除フロー 3.3.2. 関連 【FIX】ピックアップ記事選定フロー 4. 要件定義 本ページで特に指定した場合を除き、 共通要件 に従うものとする。 4.1. ユーザーインターフェース（画面） 記事管理パッケージに備わっている入出力項目の内、今回の機能で利用する項目以外は非表示とする。 https://www.figma.com/design/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?node-id=185702-36366&amp;node-type=frame&amp;t=281Rcf110lO58tbL-0 4.2. 入力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 対応帳票 1 バージョン番号 version URLパラメータ（クエリストリング） 初期値として入力させたい「タイトル」「抜粋（要約）」「本文」バージョンを指定する情報。本項目を設定した時に、どの項目を初期値として入力させておくかは、定義ファイルにて定義するものとする。 2 タイトル &nbsp; 入力フォーム 初期値：URLパラメータで「バージョン番号」が指定されている場合は、指定されたバージョンに番号の 【FIX】記事バージョン に保存された値とし、指定されていない場合は、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ から読み込んだ値とする。 必須 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ または 【FIX】記事バージョン 3 タイトル画像 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 必須 任意 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ および 【FIX】記事画像 4 タイトル画像： 代替 altテキスト &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 5 抜粋（要約） &nbsp; 入力フォーム 初期値：URLパラメータで「バージョン番号」が指定されている場合は、指定されたバージョンに番号の 【FIX】記事バージョン に保存された値とし、指定されていない場合は、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ から読み込んだ値とする。 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ または 【FIX】記事バージョン 6 カテゴリ &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 7 公開日時 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 必須 Google Chromeの拡張異能「Optimize Next」（バージョン1.3.0）が有効な状態でも、公開日時を選択できるものとする。 8 閲覧可能ユーザー &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 必須 9 会員限定記事の本文表示領域 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 10 検索対象可否 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 11 ピックアップ種別 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 「ピックアップ表示順」が選択された場合のみ必須 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 12 ピックアップ表示順 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 「ピックアップ種別」が選択された場合のみ必須 1〜3から選択可能 13 テンプレート &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 必須 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 14 執筆者種別 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 必須 【FIX】記事カスタムフィールド値 （定義は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1248591874/_ ） 15 執筆者 &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 「執筆者種別」で「個人」を選択した時のみ表示する。 「執筆者種別」で「個人」を選択した時のみ必須とする。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 16 管理用メモ &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 17 パンくず1（テキスト） &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 【FIX】記事カスタムフィールド値 （定義は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1248591874/_ ） 18 パンくず1（URLパス） &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp;&nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 19 パンくず2（テキスト） &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 20 パンくず2（URLパス） &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 21 パンくず3（テキスト） &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 22 パンくず3（URLパス） &nbsp; 入力フォーム 初期値＝データベースから読み込んだ値 &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 23 本文 &nbsp; 入力フォーム 初期値：URLパラメータで「バージョン番号」が指定されている場合は、指定されたバージョンに番号の 【FIX】記事バージョン に保存された値とし、指定されていない場合は、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ から読み込んだ値とする。 &nbsp; https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ または 【FIX】記事バージョン 24 バージョン管理メモ &nbsp; 入力フォーム 初期値なし &nbsp; 文字を入力するフィールドの右下にリアルタイムの文字数カウント表示（入力した文字数/上限の文字数）する。 文字を入力していき、上限の文字数になったら場合に 入力した文字数 の色が変わる 【FIX】記事バージョン 4.3. 出力 説明は、帳票の各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 4.3.1. 記事基本項目 対象帳票： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 項目名 出力先 説明 1 記事番号 データベース 保存されている値をそのまま出力する。 2 タイトル データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 3 タイトル画像 データベース 変更があった場合、同時に作成される 【FIX】記事画像 の番号を保存する。 4 タイトル画像： 代替 altテキスト データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 カテゴリ データベース/画面 画面の対象フォーム内に、保存された値に対応するラベルを出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 6 抜粋（要約） データベース/画面 画面の対象フォーム内に、保存された値をHTMLエスケープ処理をして出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 7 本文 データベース/画面 画面の対象フォーム内に、保存された値をそのまま（HTMLエスケープ処理をせずに）出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内にそのまま（HTMLエスケープ処理をせずに）出力、エラーがない場合はSQLインジェクション対策およびクロスサイトスクリプティング対策をしてデータベースに保存する。 エディタ内で指定したCSSは、「本文」エリアのみに適用される様に実装・保存する。 8 バージョン データベース 保存されていた値＋1の値を保存する。 9 管理用メモ データベース/画面 画面の対象フォーム内に、保存された値をHTMLエスケープ処理をして出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 10 公開日時 データベース/画面 画面の対象フォーム内に、保存された値に対応するラベルを出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 11 閲覧可能ユーザー データベース/画面 画面の対象フォーム内に、保存された値に対応するラベルを出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 12 会員限定記事の本文表示領域 データベース/画面 画面の対象フォーム内に、保存された値をHTMLエスケープ処理をして出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 13 検索対象可否 データベース/画面 画面の対象フォーム内に、保存された値に対応するラベルを出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 14 テンプレート データベース/画面 画面の対象フォーム内に、保存された値に対応するラベルを出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 15 執筆者 データベース/画面 画面の対象フォーム内に、保存された値に対応するラベルを出力する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 16 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 17 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.3.2. 記事画像 対象帳票： 【FIX】記事画像 画像ファイルについては下記の通りとする。 webp以外の形式の場合、webp変換して保存する。 変換前の画像もサーバー上には保存しておく。 元からwebpの場合は変換処理はしない。 画像ファイルの種類や格納構造は 記事画像ファイルの種類と構造 の定義通りとする。 4.3.2.1. タイトル画像 「タイトル画像」欄でアップロードする画像については下記の通りとする。 項目名 出力先 説明 1 画像番号 データベース レコード作成時に自動で連番を発行してデータベースに保存する。 2 画像格納先パス データベース レコード作成時に該当する値をデータベースに保存する。 3 画像タイプ データベース レコード作成時に該当する値をデータベースに保存する。 4 画像フォーマット データベース レコード作成時に該当する値をデータベースに保存する。 5 ファイルサイズ データベース レコード作成時に該当する値をデータベースに保存する。 6 画像サイズ：縦 データベース レコード作成時に該当する値をデータベースに保存する。 7 画像サイズ：横 データベース レコード作成時に該当する値をデータベースに保存する。 8 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 9 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 10 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 11 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.3.2.2. 本文中の画像 本文のエディタ内でアップロードする画像については下記の通りとする。 項目名 出力先 説明 1 画像番号 データベース レコード作成時に自動で連番を発行してデータベースに保存する。 2 画像格納先パス データベース レコード作成時に該当する値をデータベースに保存する。 3 画像フォーマット データベース レコード作成時に該当する値をデータベースに保存する。 4 ファイルサイズ データベース レコード作成時に該当する値をデータベースに保存する。 5 画像サイズ：縦 データベース レコード作成時に該当する値をデータベースに保存する。 6 画像サイズ：横 データベース レコード作成時に該当する値をデータベースに保存する。 7 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 8 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 9 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 10 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.3.3. 記事_ピックアップ 対象帳票： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 元のピックアップ選択状態、および、更新時の選択状態によって、下記の通り処理する。 「ピックアップ種別」および「ピックアップ表示順」が元々選択されていない場合 新たに選択せずに更新する場合 何も行わない 新たに選択して更新する場合 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704545028 と同様とする。 選択したピックアップ種別と同じピックアップ種別を持つ、既存の有効なレコードをすべて削除（論理削除）し、新たに新しい順番のレコードを作成し直す。 「ピックアップ種別」および「ピックアップ表示順」が元々選択されていた場合 何も選択せずに更新する場合（ピックアップを外す場合） 外す1レコードのみを削除（論理削除）する。 新たに選択して更新する場合 外す1レコードは削除（論理削除）する。 新たに選択するものは https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704545028 と同様とする。 選択したピックアップ種別と同じピックアップ種別を持つ、既存の有効なレコードをすべて削除（論理削除）し、新たに新しい順番のレコードを作成し直す。 新たに作成し直す、新しい順番のレコードの作成ルールは下記の通りとする。 本レコードの保存によって、「ピックアップ表示順」が重複するレコード以降の表示順を、重複する限り1ずつプラスしてずらしていき、設定可能な最大値を超えるレコードについては作成しないものとする。 例1：記事1-5がある状態で、記事6を表示順3で作成する場合（表示順の設定可能な最大数5を超えるレコードがある場合） 記事No.：表示順（旧レコード）&rarr;表示順（新レコード） 記事1：1&rarr;1 ※表示順1のレコードを論理削除して表示順1のレコードを新規作成する 記事2：2&rarr;2 ※表示順2のレコードを論理削除して表示順2のレコードを新規作成する 記事6：- &rarr;3 ※表示順3のレコードを新規作成する 記事3：3&rarr;4 ※表示順3のレコードを論理削除して表示順4のレコードを新規作成する 記事4：4&rarr;5 ※表示順4のレコードを論理削除して表示順5のレコードを新規作成する 記事5：5&rarr;- ※表示順5のレコードを論理削除する 例2：記事1-4がある状態で、記事6を表示順3で作成する場合（表示順の設定可能な最大数5を超えるレコードがない場合） 記事No.：表示順（旧レコード）&rarr;表示順（新レコード） 記事1：1&rarr;1 ※表示順1のレコードを論理削除して表示順1のレコードを新規作成する 記事2：2&rarr;2 ※表示順2のレコードを論理削除して表示順2のレコードを新規作成する 記事6：- &rarr;3 ※表示順3のレコードを新規作成する 記事3：3&rarr;4 ※表示順3のレコードを論理削除して表示順4のレコードを新規作成する 記事4：5&rarr;5 ※表示順5のレコードを論理削除して表示順5のレコードを新規作成する 項目名 出力先 説明 1 番号 データベース 新規作成時のみ、レコード作成時に自動で連番を発行してデータベースに保存する。 2 記事番号 データベース 同時に保存される https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ の記事番号を保存する。 3 ピックアップ種別 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 4 ピックアップ表示順 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 5 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 6 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 7 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 8 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.3.4. 記事カスタムフィールド値 対象帳票： 【FIX】記事カスタムフィールド値 項目の定義は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1248591874/_ を参照する。 フィールドの数だけレコードを生成する。 項目名 出力先 説明 1 番号 データベース レコード作成時に自動で連番を発行してデータベースに保存する。 2 記事番号 データベース 同時に保存される https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ の記事番号を保存する。 3 項目 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1248591874 の変数名を保存する。 4 値_テキスト データベース/画面 該当項目がテキスト形式の場合、入力値を本項目に保存する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す値をHTMLエスケープ処理をして出力、または値が示す選択肢が選択された状態で表示する。エラーがない場合は入力された値をSQLインジェクション対策をしてデータベースに保存する。 5 値_数値 データベース/画面 該当項目が数値形式の場合、入力値を本項目に保存する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す値をHTMLエスケープ処理をして出力、または値が示す選択肢が選択された状態で表示する。エラーがない場合は入力された値をSQLインジェクション対策をしてデータベースに保存する。 6 値_日時 データベース/画面 該当項目が日時形式の場合、入力値を本項目に保存する。 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す値をHTMLエスケープ処理をして出力、または値が示す選択肢が選択された状態で表示する。エラーがない場合は入力された値をSQLインジェクション対策をしてデータベースに保存する。 7 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 8 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 9 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 10 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.3.5. 記事バージョン 対象帳票： 【FIX】記事バージョン 項目名 出力先 説明 1 番号 データベース レコード作成時に自動で連番を発行してデータベースに保存する。 2 記事番号 データベース 同時に保存される https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ の記事番号を保存する。 3 バージョン データベース 同じ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に紐づく既存の 【FIX】記事バージョン の「バージョン」の最大値＋1をデータベースに保存する。 4 バージョン管理メモ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 5 タイトル更新フラグ データベース 最新の 【FIX】記事バージョン の「タイトル」に対して、変更があった場合「true」（更新あり）を、変更がなかった場合「false」（更新なし）を、データベースに保存する。 6 要約更新フラグ データベース 最新の 【FIX】記事バージョン の「抜粋（要約）」に対して、変更があった場合「true」（更新あり）を、変更がなかった場合「false」（更新なし）を、データベースに保存する。 7 本文更新フラグ データベース 最新の 【FIX】記事バージョン の「本文」に対して、変更があった場合「true」（更新あり）を、変更がなかった場合「false」（更新なし）を、データベースに保存する。 8 タイトル データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 9 タイトル画像 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 10 タイトル画像： 代替 altテキスト データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 11 カテゴリ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 12 抜粋（要約） データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 13 本文 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 14 管理用メモ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 15 公開フラグ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 16 公開日時 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 17 閲覧可能ユーザー データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 18 会員限定記事の本文表示領域 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 19 検索対象可否 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 20 テンプレート データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 21 執筆者 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 22 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 23 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 24 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 25 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合、または管理者権限でログインしていない場合は全体管理者画面のログイン画面にリダイレクトする。 URL文字列または隠しフォーム入力からID文字列を取得し、入力がない場合/自然数ではない場合はレスポンスステータス404 not foundを出力して処理を終了する。 指定されたIDでデータベースから該当するレコードを抽出する。 該当するレコードがデータベース上に存在しない場合はレスポンスステータス404 not foundを出力して処理を終了する。 4.4.1. 編集フォーム画面表示処理 該当するレコードが見つかったら、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704610650/334_+FIX#4.3.-%E5%87%BA%E5%8A%9B に記載の通り、表示項目と入力可能項目に項目値を反映させて画面を出力し処理を終了する。 4.4.2. 編集処理 該当するレコードが見つかったら、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704610650/334_+FIX#4.2.-%E5%85%A5%E5%8A%9B に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で編集フォーム画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている管理者のIDを更新者IDに設定した上でデータベースの該当レコードを更新する。 該当のレコードの保存した情報を閲覧できる https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577796 へリダイレクトし処理を終了する。 4.5. エラー処理 4.6. ログ 編集画面を表示した場合に下記フォーマットでログを出力する User {全体管理者のユーザー番号} started to update article . article _id={記事番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 編集処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} updated article . article _id={記事番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {全体管理者のユーザー番号} failed to update article . article _id={記事番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 同時編集に対する明示的な対策は施さない。 同時に編集が実行された際は後勝ちとし、後から保存ボタンを押して実行した時の編集値が適用される。 編集画面において他のユーザーまたは他のウィンドウ・タブが本機能にアクセスしたことをアプリケーションは検知しない。",
  "parentId": "703496344",
  "parentTitle": "330_■記事管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704610650/334_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-01-31T01:33:47.557Z",
  "author": "kotake_jin",
  "excerpt": "1. 目次 2. 概要 本機能は記事（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 【FIX】記事カスタムフィールド値 【FIX】記事画像 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/1245544451/_ 【FIX】記事バージョン ..."
}