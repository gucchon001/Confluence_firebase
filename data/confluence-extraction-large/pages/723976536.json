{
  "id": "723976536",
  "title": "336_【FIX】記事公開フラグ切り替え機能",
  "content": "1. 目次 2. 概要 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の登録済みのデータの公開・非公開を切り替えるための機能です。 （また、切り替え結果の履歴として 【FIX】記事バージョン を保存します ） 3. 要求事項 全体管理画面にログインすることができる全体管理者、塾講師ステーション管理者、ゲスト管理者、記事管理者が本機能を利用することができる。 記事担当者、ギフト券担当者は本機能を利用することはできない。 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577796 の画面上から利用できる。 登録されている https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 1件の登録済み情報を対象とし、本ページの「要件定義」-「入力」欄で入力元が「入力フォーム」と定義されている項目を設定することができる。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の更新に伴い、切り替え結果の履歴として 【FIX】記事バージョン も保存する。 「公開フラグ切り替えボタン」ボタンを押下すると、入力項目に問題なければ、データベースにレコードを保存し、保存内容をシステム全体に適用し、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577796 画面を更新する。 更新に成功すると公開状態変更完了モーダルを表示する。 公開状態に切り替えた場合は「記事を公開しました」、非公開状態に切り替えた場合は「記事を非公開にしました」と表示する。 モーダル内には閉じるボタンを配置し、押下するとモーダルを閉じる。 入力内容に問題がある場合はエラーメッセージを表示する。 更新に成功または失敗した場合、以下の情報が入ったログを出力する。 日時、全体管理者のユーザー番号、記事番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 要求事項欄に記載の通り。 3.2. 帳票 概要欄に記載の通り。 3.3. メールテンプレート なし 3.4. ワークフロー 3.4.1. 本機能 【FIX】記事登録・公開・非公開・削除フロー 3.4.2. 関連 【FIX】ピックアップ記事選定フロー 4. 要件定義 本ページで特に指定した場合を除き、 共通要件 に従うものとする。 4.1. ユーザーインターフェース（画面） https://www.figma.com/design/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?node-id=185174-35836&amp;node-type=frame&amp;t=hKjqesnoBoEi9Hu4-0 4.2. 入力 変数名、説明、バリデーションは、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 記事番号 入力フォーム （隠しフォーム） 編集する対象の記事の記事番号を一つのみ入力することができる。 入力がない、または、要素が自然数ではない、または指定番号の記事レコードがデータベースに存在しない場合 エラーメッセージは出力せず、正しい番号に対してのみ処理を実行する。 2 公開フラグ 入力フォーム 指定された記事データをTrueなら公開し、Falseなら非公開にする。指定された記事データの元々の状態は確認しなくて良い。 True/False以外が指定された場合はFalseとして扱い、エラーは発生させない。 4.3. 出力 説明は、帳票の記載を前提とし、本ページに固有の特記事項のみ記載する。 4.3.1. 記事基本項目 対象帳票： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ 出力項目 出力先 説明 1 公開フラグ データベース/画面 入力で指定された公開フラグを処理した値をJSONエスケープして出力する。 2 更新者 データベース 【作成中】帳票共通項目 に従う。 3 更新日時 データベース 【作成中】帳票共通項目 に従う。 4.3.2. 記事バージョン 対象帳票： 【FIX】記事バージョン 項目名 出力先 説明 1 番号 データベース レコード作成時に自動で連番を発行してデータベースに保存する。 2 記事番号 データベース 同時に保存される https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ の記事番号を保存する。 3 バージョン データベース 同じ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に紐づく既存の 【FIX】記事バージョン の「バージョン」の最大値＋1をデータベースに保存する。 4 タイトル更新フラグ データベース 固定で「false」（更新なし）を、データベースに保存する。 5 要約更新フラグ データベース 固定で「false」（更新なし）を、データベースに保存する。 6 本文更新フラグ データベース 固定で「false」（更新なし）を、データベースに保存する。 7 タイトル データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 8 タイトル画像 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 9 タイトル画像：代替テキスト データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 10 カテゴリ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 11 抜粋（要約） データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 12 本文 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 13 管理用メモ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 14 公開フラグ データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存した値と同じ値を保存する。 15 公開日時 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 16 閲覧可能ユーザー データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 17 会員限定記事の本文表示領域 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 18 検索対象可否 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 19 テンプレート データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 20 執筆者 データベース https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639/_ に保存されている値と同じ値を保存する。 21 作成者 データベース 【作成中】帳票共通項目 の定義に従う。 22 作成日時 データベース 【作成中】帳票共通項目 の定義に従う。 23 更新者 データベース 【作成中】帳票共通項目 の定義に従う。 24 更新日時 データベース 【作成中】帳票共通項目 の定義に従う。 4.4. 処理 本機能を実行する際にシステム内で行う処理です。複数処理がある場合は配下の階層に分けて記載します。 4.5. エラー処理 処理を実施した際に行うエラー処理です 4.6. ログ 編集処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} updated article public flag. article _id={記事番号} public_flag={公開フラグ} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to update article public flag. article _id={記事番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 本機能でスコープ外、または制限事項とする内容です",
  "parentId": "703496344",
  "parentTitle": "330_■記事管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/723976536/336_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-12-16T08:59:55.739Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/682557639 の登録済みのデータの公開・非公開を切り替えるための機能です。 （また、切り替え結果の履歴として 【FIX】記事バージョン を保存します ） 3. 要求事項 全体管理画面にログインすることができる全体管理者、塾講師ステーション管理者..."
}