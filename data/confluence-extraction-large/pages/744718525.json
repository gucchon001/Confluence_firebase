{
  "id": "744718525",
  "title": "761_【FIX】採用確認月次バッチ",
  "content": "1. 1. 概要 本バッチ処理は以下の3種の処理を、以下の順番で行う。 A-1：企業別採用確認の月初時カウンタ集計処理（ 【FIX】応募情報 更新前処理） B： 【FIX】応募情報 の更新処理 A-2：企業別採用確認の月初時カウンタ集計処理（ 【FIX】応募情報 更新後処理） 本バッチは毎月1日の00:45(JST)に自動実行するように設置する。必達終了時間は01:45(JST)とする。処理開始日時から処理終了日時まで1時間以内に 10000件の処理 を完了するようにパフォーマンスを確保する。 2. 2. 要求事項 コマンドラインで実行できるものとする。 バッチ処理を開始したらバッチ処理を開始した旨のメッセージと現在日時を含むログを出力する。 2.1. 企業別採用確認の月初時カウンタ集計処理（応募データ更新前処理） それぞれの企業の 【作成中】企業：集計情報 に対して、 【FIX】応募情報 更新前に以下をカウントし登録する。 【 前月提出期限超過者数 】 以下の条件をすべて満たす 【FIX】応募情報 の総数。 ①「提出ステータス」が『未提出 or 差戻し』 ②「提出期限」が処理時点の前月である。 【 前月保留者数 】 以下の条件をすべて満たす 【FIX】応募情報 の総数。 ①「採用ステータス」が『保留』 ②「提出ステータス」が『提出中』 【 提出期限超過月数 】 「前月提出期限超過者数」が1以上だった場合に、+1 とする 2.2. 応募データの更新処理 各処理の対象は 【FIX】応募情報 とする。 {TIME} には、バッチ処理時の時刻が入る。 以下の条件をすべて満たす 【FIX】応募情報 が、処理の対象となる。 以下のいずれの条件も満たさない 「提出ステータス」が『提出中』 かつ 「採用ステータス」が『不採用』『連絡取れず』『辞退』『欠席』である 「提出ステータス」が『提出中』 かつ 「採用ステータス」が『採用』で在籍確認が空ではない 「提出ステータス」が『提出中』 かつ 「採用ステータス」が『不採用』『連絡取れず』『辞退』『欠席』以外（=「未登録」、「採用」、「不合格」、「応募重複」、「対象外」、「保留」）である 「提出ステータス」が『提出中』 かつ 「採用ステータス」が『採用』で在籍確認の値が入っている 【提出期限超過月数】 ■条件 「提出ステータス」が『未提出 or 差戻し』 かつ提出期限を過ぎている ■処理 「提出期限超過月数」を +1 とする 【保留月数】 ■条件 「採用ステータス」が『保留』 かつ 「提出ステータス」が『提出中』で、 確認完了が『完了』である。 ■処理 「保留月数」を +1 とする 【提出期限】 ■条件 提出期限を過ぎている ■処理 「提出期限」を『処理時点の月の末日』に変更 【採用ステータス】 ■条件 「採用ステータス」が『保留』 かつ 「提出ステータス」が『提出中』 ■処理 ①「採用ステータス」を『未登録』に変更 ②「提出ステータス」を『未提出』に変更 【採用ステータス】 （admin） ■条件 採用ステータスが「保留」かつ「確認完了」にチェックが入っている 「提出ステータス」が『提出中』 ■処理 「確認完了」のチェックを外す 採用ステータスを「未登録」とする 提出ステータスを「未提出」に変更 【提出ステータス】 ■条件 「提出ステータス」が『提出中』 課金形態が採用課金で期間が「1ヶ月」の場合は、処理時点の月が研修初日の翌月である。 課金形態が採用課金で期間が「3ヶ月」の場合は、処理時点の月が研修初日の3ヶ月後である。 ■処理 ①「 提出ステータス 」を『未提出』に変更 【提出ステータス】 ■条件 「提出ステータス」が『提出中』 採用ステータス「保留」、または採用ステータスが「採用」で 研修初日「未定NULL」 、 研修初日回答済みフラグ「True」 ■処理 ①「 提出ステータス 」を『未提出』に変更 ②「研修初日」を『空欄』に変更の『未定』テキストを削除 ③「研修初日回答済みフラグ」を『Null』に変更 ■条件 「提出ステータス」が『提出中』かつ採用ステータスが「採用」で研修初日「NULL」で研修初日回答済みフラグ「True」 ■処理 ①「提出ステータス」を『未提出』に変更 ②「研修初日回答済みフラグ」を『 Null FALSE 』に変更 【提出ステータス 】 ■条件 採用ステータス「保留」である ■処理 ①「 提出ステータス 」を『未提出』に変更 【 提出ステータス 】 ■条件 提出ステータスが「提出中」 在籍確認がNULL 採用ステータスが「採用」 で研修初日が「未定」 研修初日が「 未定 NULL」 or「研修初日が確認対象月でない日付」 研修初日回答済みフラグ「True」 確認完了が「完了」 ■処理 ①「確認完了」を『未完了』に変更し、確認完了のチェックを外す ②「 提出ステータス 」を『未提出』に変更 ③「研修初日」の『未定』テキストを削除 ④「研修初日回答済みフラグ」を『 Null FALSE 』に変更 【提出ステータス】 ■条件 提出ステータスが「提出中」 在籍確認がNULL 採用ステータスが「採用」 研修初日が 「研修初日が確認対象月でない日付」「在籍確認月」 「確認対象月に該当する日付」 確認完了が「完了」 ■処理 ① 提出期限月の場合のみ、確認完了のチェックを外し、「提出ステータス」を『未提出』に変更 ①「確認完了」を『未完了』に変更し、確認完了のチェックを外す ②「提出ステータス」を『未提出』に変更 【提出ステータス】 ■条件 在籍確認がNULL 採用ステータスが「採用」 研修初日が「確認対象月に該当する日付」 確認完了が「未完了」 ■処理 ①「提出ステータス」を『未提出』に変更 【提出ステータス】 ■条件 提出ステータスが「提出中」 在籍確認がNULL 採用ステータスが「採用」 研修初日が「研修初日が確認対象月でない日付」「在籍確認月」「確認対象月に該当する日付」 確認完了が「未完了」 ■処理 ①提出期限月の場合のみ、確認完了のチェックを外し、「提出ステータス」を『未提出』に変更 ②「提出ステータス」を『未提出』に変更 【 トモノカイ確認フラグ 】 ■条件 「 確認完了 」が『完了』である 課金形態が採用課金で期間が「1ヶ月」の場合は、処理時点の月が研修初日の翌月である。 課金形態が採用課金で期間が「3ヶ月」の場合は、処理時点の月が研修初日の3ヶ月後である。 ■処理 ① 「確認完了」を『未確認』に変更 【 トモノカイ確認フラグ 】 ■条件 採用ステータスが「採用」 研修初日が「未定」or 研修初日が確認対象月でない日付 提出ステータスが「提出中」 確認完了が「完了」 ■処理 ①「確認完了」を『未確認未完了』に変更 ②「提出ステータス」を『未提出』に変更 【トモノカイ確認フラグ】 ■条件 採用ステータスが「採用」 研修初日「NULL」 研修初日回答済みフラグ「 Null FALSE 」 「 確認完了 」が『完了』 ■処理 ① 「確認完了」を『未確認』に変更し、確認完了のチェックを外す ②「提出ステータス」を『完了』から『未提出』に変更 2.3. 企業別採用確認の月初時カウンタ集計処理 （応募データ更新後処理） 各 【FIX】応募情報 更新後に以下をカウントする。なお共通の条件は以下である。 「提出ステータス」が『未提出 or 差戻し』 「提出期限」が処理時点の月の範囲内である 【 未登録者数 】 以下の条件をすべて満たす 【FIX】応募情報 の総数。 ① 採用ステータス（企業）が未登録のもの 【 研修未定者数 】 以下の条件をすべて満たす 【FIX】応募情報 の総数。 ① 採用ステータス（企業）が採用だが研修初日が未登録のもの 【 在籍確認待ち数 】 以下の条件をすべて満たす 【FIX】応募情報 の総数。 ① 研修初日が登録されているが在籍確認が未登録のもの 2.4. 共通 バッチ処理終了時には、バッチ処理が終了した旨のメッセージと終了日時を含んだログを出力する。 2.5. 2.1. メールテンプレート 要求定義に記載のテンプレート。 2.6. 2.2. ワークフロー 【FIX】採用お祝い/口コミ確認・公開フロー 3. 3. 要件定義 3.1. 3.1. 入力 要求にて定義している内容に従う。 3.2. 3.2. 出力 要求にて定義している内容に従う。 3.3. 3.3. 処理 3.4. 3.4. エラー処理 下記通知先にエラーログ通知を行う。 【FIX】バッチエラー時通知先 3.5. 3.5. ログ バッチ略称はupdate monthly hiring check status (UMHCS) とする。 バッジ処理全体が開始した時と終了した時に以下のログを出力する。 開始時 [761_UMHCS] Started at {処理開始日時}. 終了時 [761_UMHCS] Finished at {処理終了日時}. A-1の処理 成功時 [761_UMHCS] Succeeded to update monthly company hiring check status first half. company_numbers={企業番号} application_numbers={処理対象の応募番号} time={現在時刻}. 失敗時 [761_UMHCS] Failed to update monthly company hiring check status first half. company_numbers={企業番号} time={現在時刻}. Bの処理 成功時 [761_UMHCS] Succeeded to update monthly hiring check status. application_numbers={処理対象の応募番号} time={現在時刻}. 失敗時 [761_UMHCS] Failed to update monthly hiring check status. application_numbers={処理対象の応募番号} time={現在時刻}. A-2の処理 成功時 [761_UMHCS] Succeeded to update monthly company hiring check status second half. company_numbers={企業番号} application_numbers={処理対象の応募番号} time={現在時刻}. 失敗時 [761_UMHCS] Failed to update monthly company hiring check status second half. company_numbers={企業番号} time={現在時刻}. 4. 4. スコープ外・制限事項",
  "parentId": "744325304",
  "parentTitle": "760_■採用・採用お祝い関連バッチ",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/744718525/761_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-07T02:54:54.656Z",
  "author": "isamu saito",
  "excerpt": "1. 1. 概要 本バッチ処理は以下の3種の処理を、以下の順番で行う。 A-1：企業別採用確認の月初時カウンタ集計処理（ 【FIX】応募情報 更新前処理） B： 【FIX】応募情報 の更新処理 A-2：企業別採用確認の月初時カウンタ集計処理（ 【FIX】応募情報 更新後処理） 本バッチは毎月1日の00:45(JST)に自動実行するように設置する。必達終了時間は01:45(JST)とする。処理開始日..."
}