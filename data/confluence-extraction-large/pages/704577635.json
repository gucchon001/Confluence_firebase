{
  "id": "704577635",
  "title": "122_【修正中】企業新規登録機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：設定情報（クライアント企業向け） の登録済みのデータを1件新規追加するための機能です。 3. 要求事項 管理画面にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者のみが、 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：設定情報（クライアント企業向け） データを新規登録することができる。 新規登録にあたって入力フォームに表示し入力可能な項目は以下の通り。 本ページの 要件定義ー「入力」 欄で入力元が「入力フォーム」と定義されている項目 登録するボタン キャンセル ボタン 登録するボタンを押下すると入力項目に問題なければ、 システムで自動発行される企業コード とともに、レコードをデータベースに保存し、作成したことを示すポップアップを表示する。ポップアップには閉じるボタンを表示し、閉じるボタンを押下すると 125_【FIX】企業詳細閲覧機能 に遷移する。 入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるかわかるようにエラーメッセージを表示する。 キャンセル ボタンを押下すると 121_【FIX】企業一覧閲覧機能 に遷移する。 新規登録で成功または失敗した場合、以下の情報が入った ログ を出力する。 日時、 管理者ID( 【FIX】全体管理者登録情報 のユーザー番号 ) 、企業番号( 【FIX】企業：基本情報 の企業番号)、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 管理画面にログインできるシステム管理者、塾講師ステーション管理者、ゲスト管理者のみ 3.2. 帳票 120_【FIX】企業管理機能 の記載と同じ 3.3. メールテンプレート なし 3.4. ワークフロー 120_【FIX】企業管理機能 の記載と同じ 3.4.1. 本機能 3.4.2. 関連 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 新規作成画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=2109-34395&amp;t=nGyEaqDZcand6mWG-4 4.1.2. 作成完了を知らせる画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=2109-34374&amp;t=3ThwcrRSp39yfCLi-4 4.2. 入力 変数名、説明、バリデーションは、 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：設定情報（クライアント企業向け） 各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 変数名 入力元 説明 制限 1 企業名 入力フォーム 初期値なし 必須 2 企業名カナ 入力フォーム 初期値なし 必須 3 電話番号 入力フォーム 初期値なし 4 メールアドレス 入力フォーム 初期値なし 必須 5 郵便番号 入力フォーム 初期値なし 数値を記入後「検索」を押下すると下記の項目を自動で更新する。 都道府県 市区町村 以降の住所 必須 6 都道府県 入力フォーム 初期値＝▼選択してください 必須 7 市区町村 入力フォーム 初期値＝▼選択してください 必須 8 以降の住所 入力フォーム 初期値なし 必須 9 管理メモ１ 入力フォーム 初期値なし 10 管理メモ２ 入力フォーム 初期値なし 11 パーソナルオファー利用可フラグ 入力フォーム 初期値＝利用不可 必須 12 広告CSV出力フラグ 入力フォーム 初期値＝出力する 必須 13 採用確認CSV利用可フラグ 入力フォーム 初期値＝利用不可 必須 14 群：キャリア 入力フォーム 初期値＝▼選択してください 必須 15 群：ステーション 入力フォーム 初期値＝▼選択してください 必須 16 教室情報表示フラグ 入力フォーム 初期値＝表示しない 必須 17 FM請求集計ID（請求書PDF発行あり） 入力フォーム 初期値＝表示しない 18 FM請求集計ID（請求書PDF発行なし） 入力フォーム 初期値＝表示しない 19 Station口コミ表示 入力フォーム 初期値＝はい 必須 20 採用確認タイプ 入力フォーム 初期値＝メール 必須 21 一発応募 入力フォーム 初期値＝チェックなし 22 オシゴトQ&amp;A機能表示フラグ 入力フォーム 初期値＝表示する 必須 23 オシゴトQ&amp;Aメール通知フラグ 入力フォーム 初期値＝通知する 必須 24 非掲載教室の表示可フラグ 入力フォーム 初期値＝表示する 必須 4.3. 出力 説明は、 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：設定情報（クライアント企業向け） 各ページの記載を前提とし、本ページに固有の特記事項のみ記載する。 項目名 出力先 説明 1 企業コード データベース レコード登録時に自動発行して保存する。 2 企業名 データベース/ 画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 3 企業名カナ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 4 電話番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に HTMLエスケープ処理をして出力 、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 5 メールアドレス データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 6 郵便番号 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に HTMLエスケープ処理をして出力 、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 7 都道府県 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 8 市区町村 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 9 以降の住所 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内にHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 10 管理メモ１ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に入力された改行を維持したままHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 11 管理メモ２ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に入力された改行を維持したままHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 12 パーソナルオファー利用可フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 13 広告CSV出力フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 14 採用確認CSV利用可フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 15 群：キャリア データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 16 群：ステーション データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 17 教室情報表示フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 18 FM請求集計ID（請求書PDF発行あり） データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に入力された改行を維持したままHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 19 FM請求集計ID（請求書PDF発行なし） データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に入力された改行を維持したままHTMLエスケープ処理をして出力、エラーがない場合はSQLインジェクション対策をしてデータベースに保存する。 20 Station口コミ表示 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 21 採用確認タイプ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 22 一発応募 データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 23 オシゴトQ&amp;A機能表示フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 24 オシゴトQ&amp;Aメール通知フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 25 非掲載教室の表示可フラグ データベース/画面 入力妥当性検査によるエラー発生時は画面の対象フォーム内に、入力された値が指し示す選択肢が選択された状態で表示する。エラーがない場合は入力された値にSQLインジェクション対策をしてデータベースに保存する。 26 作成者 データベース 【作成中】帳票共通項目 に従う。 27 作成日時 データベース 【作成中】帳票共通項目 に従う。 28 更新者 データベース 【作成中】帳票共通項目 に従う。 29 更新日時 データベース 【作成中】帳票共通項目 に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合は全体管理者画面のログイン画面にリダイレクトし、ログイン認証されているが権限の章に記載した権限を持っていない場合は全体管理者画面のTOP画面にリダイレクトする。 4.4.1. 入力画面表示処理 本ページの「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704577635#4.2.-%E5%85%A5%E5%8A%9B ）に記載の全ての項目の入力フォームと登録ボタンを配置した画面を表示する。 4.4.2. 新規登録処理 入力フォームからのデータを受け取り、「入力」の定義にしたがって値の妥当性検査をおこなう。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーメッセージを表示し、入力された値を入力フォーム内に表示・選択された状態で画面を出力して処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、作成日時、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を作成者/更新者に設定した上でデータベースに新規レコードとして挿入する。 125_【FIX】企業詳細閲覧機能 ページへリダイレクトし、新規データ登録が完了したことがわかるように以下のメッセージを表示する。 企業を新規登録しました。{企業コード} {企業名} 4.5. エラー処理 上記以外で発生した例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 新規登録画面を表示した場合に下記フォーマットでログを出力する。 User {全体管理者のユーザー番号} started to create company. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 新規登録処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} created company. company_number={企業番号} company_code={企業コード} company_name={企業名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {全体管理者のユーザー番号} failed to create company. company_number={企業番号} company_code={企業コード} company_name={企業名} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "704675888",
  "parentTitle": "120_【FIX】企業管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704577635/122_",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2023-12-20T00:44:24.665Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX】企業：設定情報（クライアント企業向け） の登録済みのデータを1件新規追加するための機能です。 3. 要求事項 管理画面にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者のみが、 【FIX】企業：基本情報 【修正中】企業：設定情報（全体管理者向け） 【FIX..."
}