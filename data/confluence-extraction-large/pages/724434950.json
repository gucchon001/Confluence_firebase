{
  "id": "724434950",
  "title": "169-2_【FIX】教室公開フラグ切り替え機能",
  "content": "1. 目次 2. 概要 本機能は 【FIX】教室：基本情報／所在地 のサービスサイトにおける 公開／非公開を切り替える ための機能。 3. 要求事項 全体管理画面にログインできるシステム管理者、塾講師ステーション管理者、ゲスト管理者が 【FIX】教室：基本情報／所在地 の公開フラグを変更することができる。 本機能は https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263407 画面上に表示されている項目とする。 登録されている 【FIX】教室：基本情報／所在地 1件の登録済み情報を対象とし、本ページの「要件定義」-「入力」欄で入力元が「入力フォーム」と定義されている項目を設定することができる。 「公開フラグ切り替えボタン」ボタンを押下すると、入力項目に問題なければ、データベースにレコードを保存し、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263407 画面を更新する。 保存が完了したら エリア平均給与算出共通処理 を実行する。 該当の教室に紐づく基本有効な契約が存在しない場合は「公開」へ変更できず、変更しようとボタン押下した場合は「有効な契約が存在しません」という通知モーダルを表示する。 更新に成功すると公開状態変更完了モーダル を表示する。公開状態に切り替えた場合は「教室を公開しました。」、非公開状態に切り替えた場合は「教室を非公開にしました。」と表示する。モーダル内には閉じるボタンを配置し、押下するとモーダルを閉じる。 入力内容に問題がある場合は 、問題となるフォームを値を表示した状態で、どの入力項目に問題があるか分かるように エラーメッセージを表示する。 3.1. 権限 全体管理画面にログインできるシステム管理者、塾講師ステーション管理者、ゲスト管理者 3.2. 帳票 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 の記載と同じ 3.3. メールテンプレート なし 3.4. ワークフロー https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 の記載と同じ 3.4.1. 本機能 3.4.2. 関連 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. 教室一覧画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=3960-35025&amp;mode=design&amp;t=zCOMHIuHMDoQFXCR-4 4.1.2. 公開状態変更完了モーダル https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=53941-23580&amp;mode=design&amp;t=PRYSskljaJYjgryx-4 4.2. 入力 変数名、説明、バリデーションは、 【FIX】教室：基本情報／所在地 の記載を前提とし、本ページに固有の特記事項のみ記載する。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704053435 に記載の共通入力・取得項目は項目自体を省略する。 項目名 変数名 入力元 説明 制限とエラーメッセージ 1 教室番号 &nbsp; 入力フォーム 編集する対象の教室の教室番号 入力がない、または、要素が自然数ではない、または指定番号の教室レコードがデータベースに存在しない場合 エラーメッセージは出力せず、正しい番号に対してのみ処理を実行する。 2 公開フラグ &nbsp; 入力フォーム Trueなら指定された教室データを 公開し、Falseなら非公開 にする。 指定された教室データの元々の状態は確認しなくて良い。 True/False以外が指定された場合はFalseとして扱い、エラーは発生させない。 「非公開にする」ボタンを押下するためには以下の内容を設定する必要がある。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704643213 の「応募情報転送先／応募後連絡先」項目内の「応募後連絡先メールアドレス１」と「応募後連絡先電話番号」 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263414 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704184402 に 記載の「タイトル１」と「PR1」 4.3. 出力 出力項目 出力先 説明 1 公開フラグ データベース/画面 入力で指定された公開フラグを処理した値をJSONエスケープして出力する。 2 更新者 データベース 【作成中】帳票共通項目 に従う。 3 更新日時 データベース 【作成中】帳票共通項目 に従う。 4.4. 処理 ログイン状態を確認し、ログイン認証されていない場合はログイン認証エラーとし、ログイン認証されているが権限の章に記載した権限を持っていない場合は権限エラーとする。 入力欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/724598798#4.2.-%E5%85%A5%E5%8A%9B ）に記載の項目の入力処理をおこなう。 出力欄（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/724598798#4.3.-%E5%87%BA%E5%8A%9B ）に記載した出力項目を出力する。 4.4.1. フラグ切り替え処理 該当する教室レコードが見つかったら、「入力」（ https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/724598798#4.2.-%E5%85%A5%E5%8A%9B ）に記載の入力項目値の妥当性検査を行う。 入力項目値の妥当性に問題があった場合は、どの項目にどのような問題が発生したかわかるようにエラーを返し処理を終了する。 入力項目値の妥当性に問題がない場合は、入力された項目値と、更新日時を操作している現在時刻とし、操作を行なっている全体管理者のユーザー番号を更新者に設定した上でデータベースの該当レコードを更新する。 編集が完了したことが分かるポップアップを https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709296160 の画面上で表示して処理を終了する。 4.5. エラー処理 上記以外で発生したエラー/例外に関してはフレームワークの例外処理に任せる。 4.6. ログ 編集処理を実行した場合に下記フォーマットでログを出力する 成功の場合 User {全体管理者のユーザー番号} updated classroom public flag. classroom_number={教室番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗の場合 User {全体管理者のユーザー番号} failed to update classroom public flag. classroom_number={教室番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "704053435",
  "parentTitle": "160_【FIX】教室管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/724434950/169-2_+FIX",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-03-04T07:52:07.981Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能は 【FIX】教室：基本情報／所在地 のサービスサイトにおける 公開／非公開を切り替える ための機能。 3. 要求事項 全体管理画面にログインできるシステム管理者、塾講師ステーション管理者、ゲスト管理者が 【FIX】教室：基本情報／所在地 の公開フラグを変更することができる。 本機能は https://giginc.atlassian.net/wiki/spaces/..."
}