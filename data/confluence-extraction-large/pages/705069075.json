{
  "id": "705069075",
  "title": "533_【FIX】パーソナルオファー - オファー数追加申込機能",
  "content": "1. 目次 2. 概要 本機能はオファー数追加オプションの契約（ 【FIX】契約情報（統合版） ）を1件新規追加するための機能です。 3. 要求事項 クライアント企業向け管理画面にログインできるクライアント企業管理者が、概要で挙げた帳票に登録されている情報を追加することができる。 本機能は 531_【FIX】パーソナルオファー - 一覧閲覧機能 より遷移し実行される。 新規登録にあたって入力フォームに表示し入力可能な項目はWFの通りとし、特筆すべき内容のみここで記載する。 送信可能数の表示 532_【作成中】パーソナルオファー - 登録機能 の定義と同様とする。 対象サイト選択 有効な基本契約が存在する対象サイトを 選択肢として 表示する。 左メニューおよび画面上のボタンでの遷移時に、指定した対象サイトに絞った内容のみ表示する。 追加数・追加期間 購入可能な商品の内、選択した対象サイトに一致する商品の追加数、有効期間を表示し、選択可能とする。 購入可能な商品は下記を満たすものとする。 「公開フラグ」が「公開」である 「購入可フラグ」が「可」である 現在の月が、「契約可能月」に含まれる 「対象サイトが」本ページで入力した「対象サイト」で選択した対象サイトと一致する。 「オプション種別」が「オファー通数UP」または「プレミアムオファー」である。 同じ「パーソナルオファー追加数」「有効期間」で購入可能な商品が複数あった場合、表示する商品は、商品番号の最も小さい商品とする。 請求金額 選択された 【FIX】商品マスタ（統合版） の税込金額および税額を表示する。 キャンセルボタン 押下すると追加処理を行わずモーダルを閉じて 531_【FIX】パーソナルオファー - 一覧閲覧機能 に戻る。 購入するボタン 押下すると、入力内容に問題がある場合は、同入力フォームページのフォームに入力された値を表示した状態で、どの入力項目に問題があるかわかるようにエラーメッセージを表示する。 選択した期間における基本契約が存在しない場合のエラーメッセージは「対象期間の契約が存在しないか、契約期間を超えています。先に契約を作成してください。」とする。 エラーチェックで問題がなければ最終確認用のモーダルを表示する。 モーダル上の実行ボタンを押すと、下記のレコードをデータベースに保存し、作成したことを示すモーダルを表示する。モーダルには閉じるボタンを配置し、押下すると 531_【FIX】パーソナルオファー - 一覧閲覧機能 に遷移する。 【FIX】契約情報（統合版） 商品：選択した商品の 【FIX】商品マスタ（統合版） が設定される。 有効期間開始日時：申込完了日時 親基本契約： 操作時点で有効な基本契約の内、「対象サイト」での入力値と一致し、最も残りの有効期間が長い基本契約 数量：「1」 その他の値は 112_【FIX】契約新規追加機能 の定義と同様とする。 モーダル上のキャンセルボタンを押すと、レコードは作成せずにモーダルを閉じる。 【FIX】契約情報（統合版） の新規登録に成功した場合、 112_【FIX】契約新規追加機能 の「3.要求 - 5」に記載の請求データ作成処理を併せて行う。 新規登録で成功または失敗した場合、以下の情報が入ったログを出力する。 日時、クライアント企業管理者ID、契約番号、アクセス元IPアドレス、ユーザーエージェント、アクション（成功or失敗） 3.1. 権限 概要と同じ 3.2. 帳票 概要と同じ 3.3. メールテンプレート なし 3.4. ワークフロー 【FIX】オプション申込・登録・解除フロー 4. 要件定義 4.1. ユーザーインターフェース（画面） 4.1.1. オファー数追加申込画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=129290-97351&amp;mode=design&amp;t=7fuPEnYS8Vv2fiW4-0 4.1.2. 最終確認画面 https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=131090-102610&amp;mode=design&amp;t=7fuPEnYS8Vv2fiW4-0 4.2. 入力 4.3. 出力 4.4. 処理 4.5. エラー処理 4.6. ログ 新規登録画面を表示した場合に下記フォーマットでログを出力する。 User {クライアント企業管理者のユーザー番号} started to create offer_option. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 新規登録処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {クライアント企業管理者のユーザー番号} created offer_option. company_number={企業番号} contract_number={契約番号} {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {クライアント企業管理者のユーザー番号} failed to create offer_option. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 5. スコープ外・制限事項 なし",
  "parentId": "720929148",
  "parentTitle": "530_■パーソナルオファー管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/705069075/533_+FIX+-",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2024-03-25T10:25:19.013Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能はオファー数追加オプションの契約（ 【FIX】契約情報（統合版） ）を1件新規追加するための機能です。 3. 要求事項 クライアント企業向け管理画面にログインできるクライアント企業管理者が、概要で挙げた帳票に登録されている情報を追加することができる。 本機能は 531_【FIX】パーソナルオファー - 一覧閲覧機能 より遷移し実行される。 新規登録にあたって入力フォー..."
}