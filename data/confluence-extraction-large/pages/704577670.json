{
  "id": "704577670",
  "title": "165_【FIX】教室-CSVアップロード機能",
  "content": "1. 目次 2. 概要 本機能はCSVをアップロードすることで 【FIX】教室：基本情報／所在地 および配下の帳票（ 【FIX】教室：応募情報転送連絡先／応募後連絡先電話番号 【FIX】教室：塾チャート 【FIX】教室：ロゴ・スライド画像 ）を登録および更新するための機能です。 3. 要求事項 全体管理画面 にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者、のみが本機能を利用できる。 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/709263407 で「CSVアップロードで登録」ボタン を押下することで、アップロード用のモーダルが表示され、アップロードするCSVファイルを選択することができる。 モーダルには、 アップロードファイルのフォーマットをダウンロードするためのリンクが表示され、フォーマットをダウンロードすることができる。 ファイル選択後、「CSVアップロード」ボタンを押下した際に、「CSVをアップロードしますか？」というモーダルを表示する。OKが選択された場合はファイル形式のチェックを行う。キャンセルが選択された場合は処理を終了する。 ファイル形式をチェックし 、CSVファイル以外の場合は、「CSV形式のファイルをアップロードしてください」とエラーメッセージを表示し、処理は行わない。 ファイル形式に問題ない場合は、以下の規則に従いデータベースにデータを保存する。 ファイル自体はS3に保存し、自動的に1ヶ月後削除する。 CSV ファイルフォーマット は以下の通りとし、 項目 は https://docs.google.com/spreadsheets/d/1xmz5U78lyOEV5hRqm9RkQrpygvFm6HJULtLbPvxIykQ/edit#gid=1688638128 の通りとする。 1行目はヘッダ行とし項目名とし、2行目は説明行とする。 3行目から 教室データ を記入する。 存在しないデータはNULLとしてデータベースに登録する。 CSVの文字コードはUTF-8とする。 CSVファイルの各項目 は、セル内に改行を入れられるようにするために、ダブルクォーテーションで囲み、中の文字列はダブルクォーテーションエスケープを行うものとする。 新規登録、更新可能な項目はそれぞれ下記とする。 ただし、 画像ファイル自体の新規登録・更新は対象外とする。 新規登録： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704610392 および https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704643213 で定義されている項目 更新： https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704643213 で定義されている項目 CSVファイルの最大レコード件数は10,000件とする。 入力内容に問題がある場合 は、問題があるCSVの行の値を表示した状態で、 どの入力項目に問題があるかわかるようにエラーメッセージを画面上に表示する。 エラーなくデータを読み込んだ場合、 「CSVファイルのデータを読み込みました。データの登録を開始します。この処理には数分以上かかる場合があります。」 とポップアップを表示する。 エラーなくデータを読み込んだ場合、CSVファイルの各行について、その行に教室番号がなければ新規登録、教室番号がありその番号の教室がDBにすでに存在すれば該当教室の更新を行う。 更新が完了した教室においてはそれぞれ エリア平均給与算出共通処理 を実行する。 エラーがあった場合は、全ての処理が終わった段階で、エラーがあった教室番号、ない場合は教室名を表示しつつ、「 教室の登録に失敗しました。 」とポップアップを表示する。 4. 要件定義 4.1. ユーザーインターフェース（画面） https://www.figma.com/file/8zITZViFoU0WYNnwig5AKc/%E3%80%90%E5%85%B1%E6%9C%89%E3%80%91%E3%83%88%E3%83%A2%E3%83%8E%E3%82%AB%E3%82%A4%E6%A7%98_%E5%A1%BE?type=design&amp;node-id=3960-35025&amp;mode=design&amp;t=9RjkQozy6xCEgdjy-4 4.2. エラー処理 4.3. ログ アップロード処理を実行した場合に下記フォーマットでログを出力する。 成功した場合 User {全体管理者のユーザー番号} uploaded classroom csv file . {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 失敗した場合 User {全体管理者のユーザー番号} failed to uploaded classroom csv file. {アクセスURI} {日時} {アクセス元IPアドレス} {ユーザーエージェント} 各行の新規登録または更新処理を行った場合 は、 https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704610392 および https://giginc.atlassian.net/wiki/spaces/CLIENTTOMO/pages/704643213 のログを出力する。",
  "parentId": "704053435",
  "parentTitle": "160_【FIX】教室管理機能",
  "labels": [],
  "url": "/spaces/CLIENTTOMO/pages/704577670/165_+FIX+-CSV",
  "spaceKey": "CLIENTTOMO",
  "lastModified": "2025-02-17T02:24:42.278Z",
  "author": "ejiri_yusuke",
  "excerpt": "1. 目次 2. 概要 本機能はCSVをアップロードすることで 【FIX】教室：基本情報／所在地 および配下の帳票（ 【FIX】教室：応募情報転送連絡先／応募後連絡先電話番号 【FIX】教室：塾チャート 【FIX】教室：ロゴ・スライド画像 ）を登録および更新するための機能です。 3. 要求事項 全体管理画面 にログインすることができるシステム管理者、塾講師ステーション管理者、ゲスト管理者、のみが本..."
}