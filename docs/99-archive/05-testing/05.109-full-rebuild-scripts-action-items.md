# 完全再構築スクリプトの動作確認結果と対応事項

## 実施日
2025-01-28

## 確認結果サマリー

### ✅ 修正完了

1. **インポートパスの修正**
   - `scripts/sync-jira-full-rebuild.ts`のインポートパスを相対パスに変更
   - `@/lib/jira-sync-service` → `../src/lib/jira-sync-service`
   - `@/lib/lunr-initializer` → `../src/lib/lunr-initializer`

### ⚠️ 確認が必要な項目

1. **`rebuild-lunr-msgpack.ts`ファイルが存在しない**
   - `package.json`には`rebuild:lunr`コマンドが定義されている
   - しかし、`scripts/rebuild-lunr-msgpack.ts`ファイルが見つからない
   - Confluence完全再構築スクリプトのStep 3でエラーが発生する可能性がある

---

## 対応事項

### 1. `rebuild-lunr-msgpack.ts`ファイルの確認

#### 確認方法

```bash
# ファイルの存在確認
Test-Path scripts\rebuild-lunr-msgpack.ts

# package.jsonのコマンド定義確認
grep rebuild:lunr package.json
```

#### 対応案

**オプションA: ファイルが存在する場合**
- ファイルが見つからない場合は、別の場所にある可能性があります
- ファイルのパスを確認してください

**オプションB: ファイルが存在しない場合**
- `rebuild:lunr`コマンドを削除するか、代替手段を実装する必要があります
- または、このコマンドが不要な場合は、Confluence完全再構築スクリプトから削除してください

**オプションC: 代替実装を使用**
- Lunrインデックスの再構築は、アプリケーション起動時に自動的に実行される場合があります
- この場合、`rebuild:lunr`コマンドは不要かもしれません

---

## 動作確認手順

### 1. 型チェック

```bash
# Confluence完全再構築スクリプト
npx tsc --noEmit scripts/sync-confluence-full-rebuild.ts

# Jira完全再構築スクリプト（修正後）
npx tsc --noEmit scripts/sync-jira-full-rebuild.ts
```

### 2. ドライラン（実際には実行しない）

#### Confluence完全再構築スクリプト

```bash
# GCSアップロードをスキップして実行
SKIP_GCS_UPLOAD=true npm run sync:confluence:rebuild
```

**注意**: `rebuild-lunr-msgpack.ts`が存在しない場合、Step 3でエラーが発生します。

#### Jira完全再構築スクリプト

```bash
# GCSアップロードをスキップして実行（最大10件でテスト）
JIRA_MAX_ISSUES=10 SKIP_GCS_UPLOAD=true npm run sync:jira:rebuild
```

---

## 修正内容の詳細

### scripts/sync-jira-full-rebuild.ts

#### 変更前

```typescript
import { JiraSyncService } from '@/lib/jira-sync-service';
import { lunrInitializer } from '@/lib/lunr-initializer';
```

#### 変更後

```typescript
import { JiraSyncService } from '../src/lib/jira-sync-service';
import { lunrInitializer } from '../src/lib/lunr-initializer';
```

**理由**: TypeScriptコンパイラでパスエイリアス（`@/`）が正しく解決されないため、相対パスに変更しました。実行時（`tsx`）では問題ありませんが、型チェック時にエラーが発生するため、相対パスに統一しました。

---

## 次のステップ

### 優先度: 高

1. **`rebuild-lunr-msgpack.ts`ファイルの確認**
   - ファイルが存在するか確認
   - 存在しない場合は、代替手段を検討

### 優先度: 中

2. **型チェックの実行**
   - 修正後のスクリプトが型チェックを通過することを確認

### 優先度: 低

3. **ドライランの実行**
   - 実際の実行前に、ドライランで動作確認

---

## 結論

### ✅ 修正完了

- インポートパスの修正が完了しました
- Jira完全再構築スクリプトは型チェックを通過するはずです

### ⚠️ 要確認

- `rebuild-lunr-msgpack.ts`ファイルの存在確認が必要です
- このファイルが存在しない場合、Confluence完全再構築スクリプトのStep 3でエラーが発生します

**次のアクション**: `rebuild-lunr-msgpack.ts`ファイルの存在を確認してください。

