# 開発サーバー側ログの場所と確認方法 (2025-11-22)

**作成日**: 2025年11月22日  
**目的**: 開発サーバー側のログを確認する方法

---

## 📍 ログの出力先

### 1. **ターミナルの標準出力** 🔴 **最重要**

開発サーバー（`npm run dev`）を起動している**ターミナルウィンドウ**に、すべてのログがリアルタイムで表示されます。

**確認方法**:
1. `npm run dev`を実行しているターミナルウィンドウを開く
2. クエリ3を実行した時刻（例: `2025-11-22T08:57:20.656Z`）の前後のログを確認
3. 以下のログを探す：
   - `[PERF] 🔍 検索処理開始`
   - `[PERF] 📥 retrieveRelevantDocs呼び出し開始`
   - `[PERF] 📥 retrieveRelevantDocs完了`
   - `[PERF] 🔍 実際の検索処理開始`
   - `[PERF] ⏱️ Phase 5 parallel search completed`
   - `[PERF] 🔍 Vector search completed`
   - `[BM25 Search] ✅ BM25 search completed`
   - `[BM25 Search] ✅ Lunr ready for <table> after <time>ms`
   - `[PERF] 🔍 検索処理完了`

---

### 2. **ログファイル** 🟡 **一部のログのみ**

一部のログは`logs/`ディレクトリにファイルとして保存されます。

**ログファイルの場所**:
```
プロジェクトルート/
  └── logs/
      ├── screen-test-<timestamp>.json      # ScreenTestLoggerによるログ
      ├── search-<date>.jsonl               # SearchLoggerによるログ
      └── retrieve-docs-<date>.jsonl        # retrieveRelevantDocsのログ
```

**注意**: 
- `[PERF]`や`[BM25 Search]`などのログは`console.log`で直接出力されているため、**ターミナルにのみ表示**されます
- ログファイルには保存されません

---

## 🔍 ログの確認方法

### 方法1: ターミナルで直接確認（推奨）

1. **開発サーバーを起動しているターミナルを開く**
   ```bash
   # 開発サーバーが起動しているターミナル
   npm run dev
   ```

2. **クエリ3を実行した時刻を確認**
   - クライアント側のログ: `2025-11-22T08:57:20.656Z`
   - この時刻の前後のサーバー側ログを確認

3. **重要なログを探す**
   - `[PERF]`で始まるログ
   - `[BM25 Search]`で始まるログ

---

### 方法2: ログファイルを確認

```bash
# プロジェクトルートで実行
cd c:\dev\CODE\Confluence_firebase

# ログディレクトリを確認
dir logs

# 最新のログファイルを確認
# PowerShellの場合
Get-Content logs\retrieve-docs-*.jsonl -Tail 50
Get-Content logs\search-*.jsonl -Tail 50
```

**注意**: ログファイルには一部のログのみが保存されます。`[PERF]`や`[BM25 Search]`のログは含まれません。

---

### 方法3: ターミナルの出力をファイルにリダイレクト

開発サーバーを起動する際に、出力をファイルにリダイレクトできます：

```bash
# PowerShellの場合
npm run dev 2>&1 | Tee-Object -FilePath logs\dev-server.log

# または、バックグラウンドで実行してログファイルに出力
npm run dev > logs\dev-server.log 2>&1
```

---

## 📋 確認すべきログ

### クエリ3実行時のログ（時刻: `2025-11-22T08:57:20.656Z`前後）

1. **検索処理の開始**
   ```
   [PERF] 🔍 検索処理開始（ユーザー認識時間）: 2025-11-22T08:57:20.XXX
   ```

2. **retrieveRelevantDocsの呼び出し**
   ```
   [PERF] 📥 retrieveRelevantDocs呼び出し開始: Xms (リクエスト受信からの経過時間)
   [PERF] 📥 retrieveRelevantDocs完了: Xms (累計: Xms)
   ```

3. **実際の検索処理開始**
   ```
   [PERF] 🔍 実際の検索処理開始: Xms (初期化時間を除外)
   ```

4. **並列検索の完了**
   ```
   [PERF] ⏱️ Phase 5 parallel search completed in Xms (X.XXs)
   ```

5. **ベクトル検索の完了**
   ```
   [PERF] 🔍 Vector search completed in Xms
   ```

6. **BM25検索の完了**
   ```
   [BM25 Search] ✅ BM25 search completed in Xms
   ```

7. **BM25初期化待機時間**
   ```
   [BM25 Search] ✅ Lunr ready for <table> after Xms total wait time
   ```

8. **検索処理の完了**
   ```
   [PERF] 🔍 検索処理完了（ユーザー認識時間）: 総時間 Xms (リクエスト受信から検索完了まで)
   ```

9. **検索パフォーマンスの内訳**
   ```
   [PERF] 🔍 Search performance breakdown: {
     searchLanceDB: 'Xms',
     enrichWithAllChunks: 'Xms',
     filterInvalidPages: 'Xms',
     total: 'Xms',
     query: '会員登録機能について'
   }
   ```

---

## 💡 ヒント

### ログが見つからない場合

1. **開発サーバーが起動しているか確認**
   ```bash
   # 別のターミナルで確認
   netstat -ano | findstr :9004
   ```

2. **ログが多すぎる場合**
   - ターミナルで`Ctrl+F`で検索
   - 検索キーワード: `[PERF]`、`[BM25 Search]`、`会員登録機能について`

3. **ログをファイルに保存**
   - 開発サーバーを起動する際に、出力をファイルにリダイレクト
   - 後でファイルを確認

---

## 🔗 関連ドキュメント

- [サーバー側ログ分析ガイド](./05.41-server-log-analysis-guide-2025-11-22.md)
- [クエリ3 ステップバイステップ分析](./05.43-query3-step-by-step-analysis-2025-11-22.md)

