# Firestoreラベル統合 - ローカルテストチェックリスト

**テスト日**: 2025年11月2日  
**テスト環境**: ローカル開発環境  
**テスト対象**: Firestoreラベル統合機能

## 📋 テスト項目

### ✅ 1. 開発サーバー起動確認

- [ ] 開発サーバーが正常に起動している
- [ ] エラーログがない
- [ ] ポートが正常にバインドされている（`http://localhost:9004`）

### ✅ 2. 検索機能のテスト

#### 2.1 「教室削除機能」の検索テスト

**テストクエリ**: `教室削除ができないのは何が原因ですか`

**期待結果**:
- `164__【FIX】教室削除機能` が検索結果の上位に表示される
- StructuredLabel（`structured_feature: 教室削除機能`）が正しくスコアリングに影響している

**確認項目**:
- [ ] 検索結果に「教室削除機能」が含まれている
- [ ] 「教室削除機能」が検索結果の上位（1-3位）に表示されている
- [ ] 他の関連する削除機能（教室グループ削除機能など）よりも優先順位が高い

#### 2.2 StructuredLabelフィールドの確認

**確認項目**:
- [ ] 検索結果にStructuredLabelフィールドが含まれている
- [ ] `structured_feature` が正しく設定されている
- [ ] `structured_domain` が正しく設定されている
- [ ] `structured_category` が正しく設定されている

### ✅ 3. 同期処理のテスト

#### 3.1 Firestoreラベル統合の確認

**テスト手順**:
1. 新しいページまたは既存ページを同期
2. LanceDBにStructuredLabelが正しく統合されているか確認

**確認項目**:
- [ ] 同期処理が正常に完了する
- [ ] FirestoreからStructuredLabelが取得されている
- [ ] LanceDBにStructuredLabelが正しく保存されている
- [ ] すべてのStructuredLabelフィールドが正しく統合されている

#### 3.2 既存ページの更新テスト

**テスト手順**:
1. 既存のページ（例: `pageId: 718373062`）を同期
2. StructuredLabelが更新されているか確認

**確認項目**:
- [ ] 既存ページのStructuredLabelが正しく更新されている
- [ ] 更新処理が正常に完了する
- [ ] データの整合性が保たれている

### ✅ 4. パフォーマンステスト

**確認項目**:
- [ ] 検索処理が3秒以内に完了する
- [ ] 同期処理が正常な速度で実行される
- [ ] メモリ使用量が適切な範囲内にある

### ✅ 5. エラーハンドリングテスト

**確認項目**:
- [ ] FirestoreからStructuredLabelが取得できない場合でも、エラーが発生しない
- [ ] エラーログが適切に記録されている
- [ ] アプリケーションが正常に動作し続ける

## 📊 テスト結果

### テスト実行ログ

```
✅ 開発サーバー起動: [実行時刻]
✅ 検索機能テスト: [実行時刻]
✅ 同期処理テスト: [実行時刻]
✅ パフォーマンステスト: [実行時刻]
✅ エラーハンドリングテスト: [実行時刻]
```

### 検索品質の改善確認

**テストクエリ**: `教室削除ができないのは何が原因ですか`

**改善前**:
- 「教室削除機能」が検索結果の上位に表示されない
- 関連性の低い結果が上位に表示される

**改善後**:
- 「教室削除機能」が検索結果の上位（1-3位）に表示される
- StructuredLabelがスコアリングに正しく影響している

## 🔍 トラブルシューティング

### 問題1: 検索結果に「教室削除機能」が表示されない

**原因候補**:
- StructuredLabelがLanceDBに正しく統合されていない
- スコアリングロジックがStructuredLabelを考慮していない

**対処方法**:
1. LanceDBのデータを確認（`npm run test:firestore-labels-integration`）
2. スコアリングロジックを確認

### 問題2: 同期処理がエラーになる

**原因候補**:
- Firestoreへの接続エラー
- LanceDBへの書き込みエラー

**対処方法**:
1. エラーログを確認
2. FirestoreとLanceDBの接続を確認

## 📝 メモ

- テスト実行時の環境変数を確認
- ログレベルの設定を確認（本番環境では詳細ログを抑制）
- データベースの状態を確認

## ✅ 完了条件

すべてのテスト項目が ✅ になったら、ローカルテストは完了です。

## 🔗 関連ドキュメント

- [Firestoreラベル統合実装サマリー](./firestore-labels-integration-implementation-summary.md)
- [Firestoreラベル統合テスト結果](./firestore-labels-integration-test-results.md)
- [Firestoreラベル統合改善サマリー](./firestore-labels-integration-improvements-summary.md)

