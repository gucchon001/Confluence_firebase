# 古いスクリプト・コマンド整理サマリー

**作成日**: 2025-01-28  
**目的**: 完全再構築スクリプトと競合する可能性のある古いスクリプト・コマンドの整理

## 確認結果

### ❌ 削除済みコマンド（完全再構築スクリプトと競合）

以下のコマンドは、完全再構築スクリプトと競合する可能性があるため、**`package.json`から削除しました**。

#### 1. `sync:and:upload`
```json
"sync:and:upload": "npm run sync:confluence:differential && npm run upload:production-data"
```

**問題点**:
- インデックス作成をスキップしている
- StructuredLabel同期をスキップしている
- 処理順序が保証されない

**推奨代替**:
```bash
npm run sync:confluence:rebuild
```

#### 2. `sync:full:and:upload`
```json
"sync:full:and:upload": "npm run sync:confluence:batch && npm run upload:production-data"
```

**問題点**:
- インデックス作成をスキップしている
- StructuredLabel同期をスキップしている
- 処理順序が保証されない

**推奨代替**:
```bash
npm run sync:confluence:rebuild
```

#### 3. `deploy:data`
```json
"deploy:data": "tsx scripts/generate-structured-labels.ts 5000 && tsx scripts/sync-firestore-labels-to-lancedb.ts && tsx scripts/create-lancedb-indexes.ts && tsx scripts/upload-production-data.ts && tsx scripts/test-data-integrity.ts --env production"
```

**問題点**:
- データ同期が含まれていない
- ConfluenceとJiraの分離が考慮されていない
- 古いデプロイフロー

**推奨代替**:
```bash
# Confluence完全再構築
npm run sync:confluence:rebuild

# Jira完全再構築
npm run sync:jira:rebuild
```

### ❌ 存在しないファイルを参照しているコマンド

#### 4. `rebuild:lunr`
```json
"rebuild:lunr": "tsx scripts/rebuild-lunr-msgpack.ts"
```

**問題点**:
- `scripts/rebuild-lunr-msgpack.ts`ファイルが存在しない
- 完全再構築スクリプトでは直接`lunrInitializer.initializeAsync()`を呼び出している

**対応**: `package.json`から削除を推奨

### ✅ 使用可能だが非推奨（完全再構築スクリプトの一部として使用）

以下のスクリプトは、完全再構築スクリプトから呼び出されているため、**直接使用するのは非推奨**です。

#### 5. `batch-sync-confluence.ts`
- **用途**: Confluenceデータ同期
- **直接使用**: 非推奨
- **推奨**: `npm run sync:confluence:rebuild`を使用

#### 6. `sync-jira.ts`
- **用途**: Jiraデータ同期
- **直接使用**: 非推奨
- **推奨**: `npm run sync:jira:rebuild`を使用

**注意**: これらは完全再構築スクリプトの一部として使用されているため、削除すべきではありません。

## 実施したアクション

### ✅ 完了

1. **`package.json`から削除**:
   - ✅ `rebuild:lunr`（ファイルが存在しない）
   - ✅ `sync:and:upload`（非推奨）
   - ✅ `sync:full:and:upload`（非推奨）
   - ✅ `deploy:data`（非推奨）

### 優先度: 中 🟡

3. **ドキュメント更新**:
   - 非推奨コマンドの使用を避ける旨を明記
   - 完全再構築スクリプトの使用を推奨

## スクリプトの関係性

| スクリプト/コマンド | 用途 | 推奨度 | 備考 |
|-------------------|------|--------|------|
| `sync:confluence:rebuild` | Confluence完全再構築 | ⭐⭐⭐ 推奨 | データ同期→インデックス→アップロード |
| `sync:jira:rebuild` | Jira完全再構築 | ⭐⭐⭐ 推奨 | データ同期→インデックス→アップロード |
| `sync:and:upload` | 差分同期+アップロード | ❌ 削除済み | インデックス作成をスキップ |
| `sync:full:and:upload` | 完全同期+アップロード | ❌ 削除済み | インデックス作成をスキップ |
| `deploy:data` | 古いデプロイフロー | ❌ 削除済み | データ同期が含まれていない |
| `rebuild:lunr` | Lunrインデックス再構築 | ❌ 削除済み | ファイルが存在しない |
| `batch-sync-confluence.ts` | Confluence同期 | ⚠️ 非推奨（直接使用） | 完全再構築スクリプトの一部 |
| `sync-jira.ts` | Jira同期 | ⚠️ 非推奨（直接使用） | 完全再構築スクリプトの一部 |

## 関連ドキュメント

- [完全再構築スクリプト運用ガイド](./04.19-full-rebuild-scripts-guide.md) - **推奨運用方法**
- [データ同期戦略](./04.03-data-synchronization-strategy.md)
- [スクリプト利用ガイド](./04.06-scripts-guide.md)

## 変更履歴

| 日付 | 変更内容 |
|-----|---------|
| 2025-01-28 | 初版作成 - 古いスクリプト・コマンドの整理サマリー |
| 2025-01-28 | 非推奨コマンドを`package.json`から削除（`sync:and:upload`、`sync:full:and:upload`、`deploy:data`） |

