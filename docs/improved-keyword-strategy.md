# キーワード抽出戦略

## 問題の分析

### 現在の問題
1. **一般語による過度なヒット**
   - `詳細`、`仕様`、`機能`、`一覧`、`閲覧`、`登録`、`編集` など
   - 教室管理以外の多くのページにも含まれる
   - 検索精度の低下を引き起こす

2. **キーワードの過度な短縮**
   - 最終的に `['教室管理の詳細は']` のみ
   - 分割された有用なキーワードが失われる

## 改善されたキーワード戦略

### 1. 教室管理特化キーワードの優先抽出

#### 1.1 エンティティキーワード（最高優先度）
```typescript
const entityKeywords = [
  '教室管理',      // メインエンティティ
  '教室',          // 基本エンティティ
  '求人管理',      // 関連エンティティ
  '教室コピー',    // 具体的な機能名
  '教室一覧',      // 具体的な機能名
  '教室登録',      // 具体的な機能名
  '教室編集',      // 具体的な機能名
  '教室削除'       // 具体的な機能名
];
```

#### 1.2 機能特化キーワード（高優先度）
```typescript
const functionKeywords = [
  'コピー機能',    // 教室コピー機能
  '一覧閲覧',      // 教室一覧閲覧機能
  '新規登録',      // 教室新規登録機能
  '情報編集',      // 教室情報編集機能
  '削除機能',      // 教室削除機能
  '掲載フラグ',    // 教室掲載フラグ切り替え機能
  '公開フラグ'     // 教室公開フラグ切り替え機能
];
```

#### 1.3 文脈キーワード（中優先度）
```typescript
const contextKeywords = [
  '管理システム',  // 教室管理システム
  '基本情報',      // 教室基本情報
  '所在地',        // 教室所在地
  '連絡先',        // 応募情報転送連絡先
  '塾チャート',    // 教室塾チャート
  'ロゴ画像'       // 教室ロゴ・スライド画像
];
```

### 2. 一般語の適切な処理

#### 2.1 一般語の重み付け調整
```typescript
const genericTermWeights = {
  '詳細': 0.1,     // 重みを大幅に下げる
  '仕様': 0.1,     // 重みを大幅に下げる
  '機能': 0.3,     // 中程度の重み
  '一覧': 0.2,     // 低い重み
  '閲覧': 0.2,     // 低い重み
  '登録': 0.2,     // 低い重み
  '編集': 0.2,     // 低い重み
  '削除': 0.2,     // 低い重み
  '設定': 0.2,     // 低い重み
  '更新': 0.2      // 低い重み
};
```

#### 2.2 一般語の条件付き使用
```typescript
// 一般語は、教室管理に関連する場合のみ使用
const conditionalGenericTerms = {
  '詳細': ['教室管理の詳細', '教室詳細情報'],
  '仕様': ['教室管理仕様', '教室仕様書'],
  '機能': ['教室管理機能', '教室機能一覧'],
  '一覧': ['教室一覧', '教室管理一覧'],
  '閲覧': ['教室一覧閲覧', '教室情報閲覧'],
  '登録': ['教室新規登録', '教室登録機能'],
  '編集': ['教室情報編集', '教室編集機能'],
  '削除': ['教室削除機能', '教室削除処理']
};
```

### 3. キーワード抽出ロジックの改善

#### 3.1 優先度ベースのキーワード選択
```typescript
function selectKeywordsByPriority(splitKeywords: string[]): string[] {
  const selected: string[] = [];
  
  // 1. エンティティキーワードを最優先
  for (const keyword of splitKeywords) {
    if (entityKeywords.some(entity => keyword.includes(entity))) {
      selected.push(keyword);
    }
  }
  
  // 2. 機能特化キーワードを追加
  for (const keyword of splitKeywords) {
    if (functionKeywords.some(func => keyword.includes(func))) {
      selected.push(keyword);
    }
  }
  
  // 3. 文脈キーワードを追加（必要に応じて）
  for (const keyword of splitKeywords) {
    if (contextKeywords.some(ctx => keyword.includes(ctx))) {
      selected.push(keyword);
    }
  }
  
  // 4. 一般語は条件付きで追加
  for (const keyword of splitKeywords) {
    if (isConditionalGenericTerm(keyword)) {
      selected.push(keyword);
    }
  }
  
  return uniquePreserveOrder(selected).slice(0, 8);
}
```

#### 3.2 条件付き一般語の判定
```typescript
function isConditionalGenericTerm(keyword: string): boolean {
  // 教室管理に関連する一般語のみを許可
  const allowedPatterns = [
    /教室.*詳細/,
    /教室.*仕様/,
    /教室.*機能/,
    /教室.*一覧/,
    /教室.*閲覧/,
    /教室.*登録/,
    /教室.*編集/,
    /教室.*削除/,
    /教室.*設定/,
    /教室.*更新/
  ];
  
  return allowedPatterns.some(pattern => pattern.test(keyword));
}
```

### 4. 期待される改善されたキーワード抽出結果

#### 入力: `教室管理の詳細は`

#### 期待される出力:
```json
{
  "keywords": [
    "教室管理",
    "教室",
    "教室一覧",
    "教室登録", 
    "教室編集",
    "教室削除",
    "教室コピー",
    "教室管理の詳細"
  ],
  "highPriority": ["教室管理", "教室"],
  "lowPriority": ["教室一覧", "教室登録", "教室編集", "教室削除", "教室コピー", "教室管理の詳細"]
}
```

### 5. 品質向上の期待効果

#### 5.1 検索精度の向上
- 教室管理に特化したキーワードにより、関連性の高いページを優先
- 一般語による過度なヒットを抑制

#### 5.2 検索再現率の向上
- 教室管理の具体的な機能名により、理想のページを見つけやすく
- エンティティキーワードにより、関連ページを網羅

#### 5.3 スコアリングの改善
- 特化キーワードの重み付けにより、適切なスコア計算
- 一般語の重み調整により、ノイズの除去

## 実装計画

1. **キーワード選択ロジックの修正**
2. **一般語の重み付け調整**
3. **条件付き一般語の実装**
4. **品質テストでの検証**

この戦略により、教室管理に特化した高精度な検索を実現し、過度なページヒットを抑制できます。
