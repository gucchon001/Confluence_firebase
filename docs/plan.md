# 開発計画書: Confluence仕様書要約チャットボット

## 1. 概要

本ドキュメントは、「Confluence仕様書要約チャットボット」の開発プロジェクトに関する計画を定義する。
プロジェクトの目的は、`spec.md`で定義された機能要件を満たすアプリケーションを、Firebase Studioを活用して迅速に開発することである。

## 2. 開発体制 (想定)

| 役割                               | 担当 |
| :--------------------------------- | :--- |
| プロダクトマネージャー             | 1名  |
| テックリード / バックエンドエンジニア | 1名  |
| フロントエンドエンジニア           | 1名  |

## 3. 開発フェーズとスケジュール（実装状況の詳細は `implementation-status.md` を参照）

プロジェクト全体を以下のフェーズに分割して進める。総期間は約5週間を想定する。

### **フェーズ0: 技術検証・疎通テスト (期間: 1週間)** ✅ **完了**

*目的: 主要な外部APIやサービスとの基本的な接続性を確認し、技術的なリスクを早期に排除する。*

* **タスク0-1: Atlassian API 疎通テスト** ✅
* **タスク0-2: Vertex AI API (Gemini & Embedding) 疎通テスト** ✅
* **タスク0-3: Vertex AI Vector Search 疎通テスト** ✅
* **タスク0-4: Firestore 連携テスト** ✅
* **タスク0-5: Firebase Authentication 連携テスト** ✅

### **フェーズ1: 基本機能開発 (MVP) (期間: 2週間)** ✅ **完了**

*目的: ユーザーが仕様検索と要約を体験できる、最低限の価値を持つプロダクトを完成させる。*

* **タスク1-1: 環境構築と認証機能 (USR-001)** ✅
    * Firebaseプロジェクトのセットアップ。
    * フロントエンドでのGoogleアカウント認証機能の実装。
* **タスク1-2: データ同期バッチの実装 (SYS-001, SYS-002)** ✅
    * Confluenceからデータを取得し、ベクトル化してVector Searchに保存するスクリプト (`batch-sync-confluence.ts`) を作成。
    * **差分更新機能**と**削除ページ処理機能**を実装済み。
* **タスク1-3: RAG Flowの実装 (USR-003, USR-004)** ✅
    * ユーザーの質問を受け取り、RAG処理を実行して回答を生成する **Genkit** を使用した関数を作成する（会話履歴は考慮しない）。
    * ✅ Vector Search検索実装を完了（実データ連携）。
* **タスク1-4: 基本チャットUIの実装 (USR-002)** ✅
    * 質問の入力と回答の表示ができる基本的なUIを作成する (`next dev`で動作確認済み)。
* **タスク1-5: ユニットテストと結合テスト** ✅
    * `test-search-fixed.js` など、主要機能のテストスクリプトを作成・実施済み。

### **フェーズ2: 機能拡張と改善 (期間: 2週間)** 進行中

*目的: MVPからのフィードバックを基に、より実用的な機能を追加し、完成度を高める。*

* **タスク2-1: 会話履歴機能の実装 (USR-005, USR-006)** ⚠️
    * Firestoreへの会話履歴の保存・読込機能。
    * ✅ Firestoreのスキーマ設計とAPI設計は完了 (`api-design.md`参照)。
    * ⚠️ セキュリティルールの設定が不十分。
* **タスク2-2: データ同期の自動化** ✅
    * Cloud Schedulerを使い、データ同期バッチを1日1回、定期実行するように設定する（スクリプトは`npm run sync:confluence:differential`などで実行可能であり、自動化の準備は完了）。
* **タスク2-3: UI/UXの改善とE2Eテスト** ✅
    * 会話履歴の表示UIを実装し、全体的なUI/UXを改善。
    * 主要なユーザーフローのE2Eテストを作成・実施する。
* **タスク2-4: 検証/監査機能の補強（任意・後工程）** 📝 新規
    * `readIndexDatapoints` の安定ルート（REST v1 / SDK v1）の再検証とドキュメント整備。
    * 通常の検証は `findNeighbors` を既定とし、監査用に `readIndexDatapoints` を補助導入。
    * 反映箇所: `docs/vector-search-guide.md` に仕様追記済み。

## 4. リスク管理と対応状況（2025-09-11更新）

| リスク                 | 影響度 | 発生可能性 | 対応状況                                                                        |
| :----------------------- | :----- | :--------- | :------------------------------------------------------------------------------- |
| Confluence APIの仕様や制限 | 中     | **低**     | ✅ 安定稼働を確認済み。APIのレート制限にも問題なし。                 |
| AIの回答精度が低い       | 高     | 中         | ✅ プロンプトとRAGの基本フローは完成。継続的なチューニングが必要。 |
| Vector Search APIのエラー   | 高     | **低**     | ✅ **[解決済み]** インデックス設定、データ形式、API仕様の全ての課題を特定し、`vector-search-guide.md`に集約。安定接続を確立。 |
| 外部APIの障害            | 中     | 低         | ✅ スクリプト内のエラーハンドリングを強化済み。リトライ機能も実装。             |
| Firestoreのセキュリティ       | 高     | 高         | ⚠️ **[対応中]** セキュリティルールの設定が不十分。データ保護の強化が必要。             |