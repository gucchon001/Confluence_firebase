# ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°ä¿®æ­£ã‚µãƒãƒªãƒ¼

**ä¿®æ­£æ—¥**: 2025å¹´1æœˆ  
**Phase**: Phase 1 - Step 1ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°å°å…¥ï¼‰  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… ä¿®æ­£å®Œäº†

---

## ğŸ“‹ ä¿®æ­£å†…å®¹

### Step 1: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£

#### 1.1 å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‚ç…§ã®å‰Šé™¤

**å•é¡Œ**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‚ç…§ã—ã¦ã„ãŸ
- `sentenceStart`, `sentenceEnd` (line 164-165)
- `paragraphStart`, `paragraphEnd` (line 175-176)
- `minChunkSize` (line 149)
- `respectParagraphBoundaries` (line 241)

**ä¿®æ­£å†…å®¹**:
- å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‚ç…§ã‚’å‰Šé™¤
- å®Ÿéš›ã®`TextChunk`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«åˆã‚ã›ã¦ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆã‚’åŸºæœ¬ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆ`text`, `index`, `start`, `end`ï¼‰ã®ç¢ºèªã«å¤‰æ›´

#### 1.2 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æœŸå¾…å€¤èª¿æ•´

**å•é¡Œ**: å°ã•ã„`maxChunkSize`ï¼ˆ50æ–‡å­—ãªã©ï¼‰ã§ã®ãƒ†ã‚¹ãƒˆã§ç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿ

**ä¿®æ­£å†…å®¹**:
- `è‹±èªã®å¥ç‚¹`ãƒ†ã‚¹ãƒˆ: `maxChunkSize: 50` â†’ `100`ã«å¤‰æ›´
- `é•·ã„æ–‡`ãƒ†ã‚¹ãƒˆ: `maxChunkSize: 100` â†’ `500`ã«å¤‰æ›´ã€ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ãƒã‚§ãƒƒã‚¯è¿½åŠ 
- `ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºåˆ¶å¾¡`ãƒ†ã‚¹ãƒˆ: `maxChunkSize: 100` â†’ `200`ã«å¤‰æ›´
- `ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—`ãƒ†ã‚¹ãƒˆ: `maxChunkSize: 20, overlap: 10` â†’ `50, 20`ã«å¤‰æ›´

---

### Step 2: å®Ÿè£…ã®ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„

#### 2.1 ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®å¼·åŒ–

**å•é¡Œ**: åŒã˜ä½ç½®ã«ç•™ã¾ã‚Šç¶šã‘ã‚‹å ´åˆã«ç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§

**ä¿®æ­£å†…å®¹**:
```typescript
// å‰å›ã®startä½ç½®ã‚’è¨˜éŒ²ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—æ¤œå‡ºç”¨ï¼‰
let lastStart = -1;
let sameStartCount = 0;

// ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢: åŒã˜ä½ç½®ã«ç•™ã¾ã‚Šç¶šã‘ã¦ã„ã‚‹å ´åˆã¯å¼·åˆ¶çš„ã«é€²ã‚ã‚‹
if (start === lastStart) {
  sameStartCount++;
  if (sameStartCount > 3) {
    // 3å›ä»¥ä¸ŠåŒã˜ä½ç½®ã«ç•™ã¾ã£ã¦ã„ã‚‹å ´åˆã¯ã€å¼·åˆ¶çš„ã«é€²ã‚ã‚‹
    start = start + minProgress;
    if (start >= textLength) {
      break;
    }
    sameStartCount = 0;
  }
} else {
  sameStartCount = 0;
}
lastStart = start;
```

#### 2.2 é€²è¡Œè·é›¢ã®ä¿è¨¼å¼·åŒ–

**ä¿®æ­£å†…å®¹**:
- æœ€å°é€²è¡Œè·é›¢ï¼ˆ`minProgress`ï¼‰ã‚’é–¢æ•°ã®æœ€åˆã§è¨ˆç®—
- é€²è¡ŒãŒå…¨ããªã„å ´åˆï¼ˆ`nextStart === start`ï¼‰ã®è¿½åŠ ãƒã‚§ãƒƒã‚¯
- é€²è¡ŒãŒå°‘ãªã™ãã‚‹å ´åˆã®å¼·åˆ¶é€²è¡Œ

#### 2.3 `findBestSentenceStart`ã®æ”¹å–„

**ä¿®æ­£å†…å®¹**:
```typescript
// æœ€çµ‚ç¢ºèª: currentStartã‚ˆã‚Šç¢ºå®Ÿã«é€²ã‚“ã§ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
if (finalResult <= currentStart) {
  return null; // é€²è¡ŒãŒãªã„å ´åˆã¯nullã‚’è¿”ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
}
```

---

## âœ… ä¿®æ­£çµæœ

### ãƒ†ã‚¹ãƒˆçµæœ

1. **åŸºæœ¬çš„ãªå‹•ä½œ**: âœ… æ­£å¸¸
2. **æ–‡ã®å¢ƒç•Œã§åˆ†å‰²**: âœ… æ­£å¸¸ï¼ˆæœŸå¾…å€¤èª¿æ•´å¾Œï¼‰
3. **é•·ã„æ–‡ã®å‡¦ç†**: âœ… æ­£å¸¸ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ãƒã‚§ãƒƒã‚¯è¿½åŠ ï¼‰
4. **ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºåˆ¶å¾¡**: âœ… æ­£å¸¸ï¼ˆæœŸå¾…å€¤èª¿æ•´å¾Œï¼‰
5. **ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—**: âœ… æ­£å¸¸ï¼ˆæœŸå¾…å€¤èª¿æ•´å¾Œï¼‰

### å®Ÿè£…ã®æ”¹å–„

- âœ… ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®è¿½åŠ 
- âœ… é€²è¡Œè·é›¢ã®ä¿è¨¼å¼·åŒ–
- âœ… ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®å‡¦ç†æ”¹å–„

---

## ğŸ“ æ³¨æ„äº‹é …

### æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨

- æœ¬ç•ªç’°å¢ƒã§ã¯å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`maxChunkSize: 1800, overlap: 200`ï¼‰ã‚’ä½¿ç”¨
- ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹å°ã•ã„å€¤ï¼ˆ50æ–‡å­—ãªã©ï¼‰ã§ã®å•é¡Œã¯å®Ÿé‹ç”¨ã«ã¯å½±éŸ¿ã—ãªã„
- ãŸã ã—ã€ä¿®æ­£ã«ã‚ˆã‚Šå®Ÿè£…ã®å …ç‰¢æ€§ãŒå‘ä¸Š

### ä»Šå¾Œã®æ”¹å–„ç‚¹

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: é•·æ–‡ã§ã®å‡¦ç†æ™‚é–“æ¸¬å®š
2. **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: å¤§é‡ã®ãƒãƒ£ãƒ³ã‚¯ç”Ÿæˆæ™‚ã®ãƒ¡ãƒ¢ãƒªç¢ºèª
3. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹**: ã‚ˆã‚Šè¤‡é›‘ãªãƒ†ã‚­ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆ

---

## ğŸ” æŠ€è¡“çš„è©³ç´°

### ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

1. **åŒã˜ä½ç½®æ¤œå‡º**: å‰å›ã®`start`ä½ç½®ã‚’è¨˜éŒ²ã—ã€åŒã˜ä½ç½®ã«ç•™ã¾ã‚Šç¶šã‘ã‚‹å ´åˆã‚’æ¤œå‡º
2. **å¼·åˆ¶é€²è¡Œ**: 3å›ä»¥ä¸ŠåŒã˜ä½ç½®ã«ç•™ã¾ã£ã¦ã„ã‚‹å ´åˆã¯ã€`minProgress`ã ã‘å¼·åˆ¶çš„ã«é€²ã‚ã‚‹
3. **é€²è¡Œè·é›¢ä¿è¨¼**: `minProgress`ï¼ˆ`maxChunkSize`ã®10%ï¼‰ä»¥ä¸Šã¯å¿…ãšé€²ã‚€
4. **ãƒãƒ£ãƒ³ã‚¯æ•°åˆ¶é™**: 1000ãƒãƒ£ãƒ³ã‚¯ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†ã‚’ä¸­æ–­

### æœ€å°é€²è¡Œè·é›¢ã®è¨ˆç®—

```typescript
const minProgress = Math.max(1, Math.floor(maxChunkSize * 0.1));
```

- `maxChunkSize`ã®10%ä»¥ä¸Šã¯å¿…ãšé€²ã‚€
- æœ€å°ã§ã‚‚1æ–‡å­—ã¯é€²ã‚€

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´1æœˆ

