# 🤖 Cursor AI 協働マニュアル
**Cursor AIの機能を最大限に活用するためのコミュニケーション技法集**

**最終更新**: 2025年10月14日  
**対象読者**: Cursor AIを使用する開発者・チームメンバー

---

## 📋 目次

1. [はじめに](#はじめに)
2. [基本原則](#基本原則)
3. [コミュニケーション技法](#コミュニケーション技法)
4. [問題解決アプローチ](#問題解決アプローチ)
5. [デバッグ戦略](#デバッグ戦略)
6. [アンチパターン（避けるべき行動）](#アンチパターン避けるべき行動)
7. [実践例](#実践例)
8. [チェックリスト](#チェックリスト)

---

## はじめに

このマニュアルは、実際のプロジェクトで蓄積された**Cursor AIとの効果的な協働技法**をまとめたものです。AIの能力を引き出し、開発効率を最大化するための実践的なノウハウを提供します。

### なぜこのマニュアルが必要か

- ❌ AIに丸投げしても期待通りの結果は得られない
- ❌ 同じ問題を何十回も繰り返すことがある
- ✅ 適切なコミュニケーション技法で問題解決速度が10倍以上向上
- ✅ AIの自律的なデバッグ能力を最大限に引き出せる

---

## 基本原則

### 1. **前提の明示**
AIに暗黙の前提を期待しない。状況・目的・制約を明確に伝える。

```markdown
❌ 悪い例: "エラーを直して"
✅ 良い例: "テーブルレンダリングのバグを修正。ブラウザで確認しながら自律的に修正を繰り返して"
```

### 2. **自律性の付与**
マイクロマネージメントせず、AIに自律的な判断と行動を委ねる。

```markdown
❌ 悪い例: "このファイルのこの行を読んで、次にこのファイルを..."
✅ 良い例: "ブラウザチェックをしながら自律的に修正を繰り返して"
```

### 3. **ゴール指向**
手段ではなく、**達成したい状態**を伝える。

```markdown
❌ 悪い例: "正規表現を修正して"
✅ 良い例: "Markdownテーブルが正しくHTMLテーブルとして表示されるようにして"
```

### 4. **フィードバックループの確立**
結果を確認し、次のアクションを指示する。

```markdown
"変わりません" → AIが別のアプローチを試行
"全然だめですね" → AIが根本原因を再分析
```

---

## コミュニケーション技法

### 🎯 技法1: **問い直し（リフレクション）**

行き詰まったら、前提を問い直す。

**実践例:**
```markdown
"何がその前提を覆していますか？"
"何が起きているのですか？"
"プロンプトの問題ですか？コードの問題ですか？正規表現等の干渉の問題ですか？ライブラリの問題ですか？"
```

**効果:**
- AIが思い込みから脱却し、別の角度から分析を開始
- 根本原因の再特定につながる

---

### 🎯 技法2: **深呼吸プロンプト（ステップバック）**

同じ失敗を繰り返す場合、AIに「一段前のステップ」を促す。

**実践例:**
```markdown
"深呼吸して、そもそもの前提やステップバイステップで進めるための
もう一段前の本番環境の前のテストやプロンプトの構造解析、コードの干渉、
別のライブラリの利用等、そもそもの方法とは別の方法を取った方がよくないですか？
もう何十回もこのやり取りを繰り返しています。"
```

**効果:**
- AIが現在のアプローチを見直す
- 根本的に異なる解決策（プロンプト修正、別ライブラリ、テスト環境構築など）を提案

---

### 🎯 技法3: **A/Bテスト指示（Git履歴活用）**

デグレードが疑われる場合、過去バージョンとの比較を指示。

**実践例:**
```markdown
"これまでうまくいっていたのがデグレードしているようなのですが、
関連ファイルをgitでたどって参照することはできますか？
昨日のファイルであれば、関連処理はどれも同じだと思います"

"3ファイルの昨日時点スナップショットをワークツリーにチェックアウトし、
今の実装と並べてA/B検証"
```

**効果:**
- 問題が新しい変更によるものか、元々存在していたものかを切り分け
- 有効だった過去の実装を特定

---

### 🎯 技法4: **段階的検証（Isolation）**

複数のファイルが関与する場合、影響範囲を絞って検証。

**実践例:**
```markdown
"まずは chat-page だけ昨日版に差し替えて確認（影響が直近で最も大きい）"
```

**効果:**
- どのファイルの変更が問題を引き起こしているか特定
- デバッグの高速化

---

### 🎯 技法5: **並行環境構築（デバッグポート）**

本番環境を壊さずにデバッグできる環境を指示。

**実践例:**
```markdown
"3001ポートで別の開発サーバーを起動して、そこでデバッグを進めて"
"自律的にあなたの方で、3001の内容を読み取ってデバッグを進めることは可能ですか"
```

**効果:**
- 本番環境（3000ポート）に影響を与えずにテスト
- AIが自律的にブラウザ確認とコード修正を繰り返せる

---

### 🎯 技法6: **メタ認知の促進**

AIに自身の作業プロセスを説明させる。

**実践例:**
```markdown
"次の発券はありましたか？"（タスク管理の確認）
"After table processingはどこにありますか？"（デバッグログの確認）
```

**効果:**
- AIが自身の作業を振り返り、抜け漏れを発見
- 人間側も進捗を把握できる

---

## 問題解決アプローチ

### 🔍 フェーズ1: 問題の特定

1. **現象の記録**
   - "変わりません" → 同じアプローチでは解決しないことを示す
   - "全然だめですね" → より強い否定で、抜本的な方向転換を促す

2. **前提の問い直し**
   - "何が起きているのですか？"
   - "プロンプトの問題ですか？コードの問題ですか？"

### 🔍 フェーズ2: 原因の切り分け

3. **レイヤー別分析**
   - フロントエンド（React、Markdown処理）
   - バックエンド（プロンプト、AI出力）
   - ライブラリ（ReactMarkdown、remarkGfm）

4. **Git履歴の活用**
   - "昨日のファイルと比較して"
   - "A/B検証して"

### 🔍 フェーズ3: 解決策の探索

5. **多角的アプローチ**
   - 正規表現の修正
   - プロンプトエンジニアリング
   - 別ライブラリの検討
   - テスト環境の構築

6. **段階的検証**
   - "まずは chat-page だけ差し替え"
   - "3001ポートで別環境構築"

### 🔍 フェーズ4: 解決とフィードバック

7. **ブラウザ確認**
   - "ブラウザチェックをしながら"
   - "自律的に修正を繰り返して"

8. **ループの打破**
   - "もう何十回も繰り返している" → 深呼吸プロンプト

---

## デバッグ戦略

### 🐛 戦略1: **ログドリブンデバッグ**

AIに戦略的なログ挿入を指示。

```markdown
"Before table processing と After table processing のログを追加して、
中間状態を確認できるようにして"
```

**ポイント:**
- 🔍 変換前後の状態を記録
- 📊 問題箇所を視覚化
- ⚡ 高速なフィードバックループ

---

### 🐛 戦略2: **テストファイル分離**

複雑なロジックは独立したテストファイルで検証。

```markdown
"fixMarkdownTables のロジックを test-table-fix.js に分離して、
単体でテストできるようにして"
```

**ポイント:**
- 🧪 本番コードから切り離してテスト
- 🎯 特定の関数に焦点を当てる
- 🗑️ テスト完了後はクリーンアップ

---

### 🐛 戦略3: **並行環境デバッグ**

本番環境を維持しながらデバッグ。

```markdown
"3000ポートは本番用として維持、3001ポートでデバッグ環境を構築"
```

**ポイント:**
- 🛡️ 本番環境の保護
- 🔄 即座の比較検証
- 🚀 リスクなしでの実験

---

### 🐛 戦略4: **根本原因への遡及**

表面的な修正を繰り返さず、根本に迫る。

**実践例（Markdownテーブルバグ）:**

| フェーズ | アプローチ | 結果 |
|:---|:---|:---|
| **Phase 1** | フロントエンドで正規表現修正 | ❌ 部分的改善のみ |
| **Phase 2** | より複雑な正規表現を追加 | ❌ 新たな副作用発生 |
| **Phase 3** | "深呼吸して" → 根本原因の再分析 | ✅ AIがプロンプト修正を提案 |
| **Phase 4** | プロンプトに明示的なルール追加 | ✅ 根本解決 |

**教訓:**
- 💡 同じアプローチを繰り返さない
- 💡 "深呼吸プロンプト"でブレイクスルー
- 💡 問題の源流（AIの出力）に遡る

---

## アンチパターン（避けるべき行動）

### ❌ アンチパターン1: **過度な詳細指示**

```markdown
❌ 悪い例:
"このファイルの15行目を開いて、次にこの関数を読んで、
次にこの変数を確認して..."
```

**問題点:**
- AIの自律性を奪う
- 人間の思い込みでAIの探索範囲を狭める

**改善策:**
```markdown
✅ 良い例:
"テーブルレンダリングの問題を調査して、必要なファイルを確認しながら修正して"
```

---

### ❌ アンチパターン2: **曖昧な否定**

```markdown
❌ 悪い例: "なんか違う"
```

**問題点:**
- AIが何を改善すべきか判断できない

**改善策:**
```markdown
✅ 良い例: "テーブルは表示されたが、セルが分割されている。各行が1行で表示されるべき"
```

---

### ❌ アンチパターン3: **早期諦め**

```markdown
❌ 悪い例: 2-3回試してすぐに「できないなら良い」と諦める
```

**問題点:**
- 解決可能な問題を見逃す

**改善策:**
```markdown
✅ 良い例:
"もう何十回も繰り返している。深呼吸して、別のアプローチを考えて"
→ 深呼吸プロンプトで方向転換
```

---

### ❌ アンチパターン4: **手段の固定**

```markdown
❌ 悪い例: "正規表現で絶対に解決して"
```

**問題点:**
- 最適解を見逃す可能性

**改善策:**
```markdown
✅ 良い例:
"正規表現の干渉ですか？ライブラリの問題ですか？プロンプトの問題ですか？"
→ AIが最適な手段を選択
```

---

## 実践例

### 📚 ケーススタディ: Markdownテーブルレンダリング問題

#### 背景
AIが生成したMarkdownテーブルが、HTMLテーブルとして正しく表示されず、各行が個別の `<p>` タグになる問題が発生。

#### 問題解決プロセス

**1. 初期アプローチ（失敗）**
```markdown
指示: "テーブルが表示されないので修正して"
→ AIがフロントエンドの正規表現を修正
→ 結果: "変わりません"
```

**2. 詳細化（部分的成功）**
```markdown
指示: "remarkGfmは空行が必要。表の前に空行を追加する処理を入れて"
→ AIが fixMarkdownTables 関数を実装
→ 結果: "少し改善したが、セルが分割される"
```

**3. A/Bテスト（原因切り分け）**
```markdown
指示: "昨日のファイルと比較して、A/B検証して"
→ AIが過去のコミットをチェックアウト
→ 結果: "過去のバージョンでも同じ問題"
→ **重要な発見**: デグレードではなく、元々の問題
```

**4. 深呼吸プロンプト（ブレイクスルー）**
```markdown
指示: 
"深呼吸して、そもそもの前提やステップバイステップで進めるための
もう一段前の本番環境の前のテストやプロンプトの構造解析、コードの干渉、
別のライブラリの利用等、そもそもの方法とは別の方法を取った方がよくないですか？
もう何十回もこのやり取りを繰り返しています。"

→ AIが根本原因を再分析
→ **発見**: 問題はフロントエンドではなく、AIの出力フォーマット
→ **提案**: プロンプトエンジニアリングで解決
```

**5. 並行環境構築（安全なテスト）**
```markdown
指示: "3001ポートで別環境を立ち上げて、そこでプロンプト修正をテスト"
→ AIが別ポートで開発サーバーを起動
→ プロンプトに明示的なMarkdownテーブルルールを追加
→ 結果: "根本解決"
```

#### 学んだ教訓

| 教訓 | 説明 |
|:---|:---|
| **症状と原因の分離** | 表示問題（症状）≠ フロントエンドの問題（原因） |
| **深呼吸プロンプトの威力** | 行き詰まったら、AIに「一段上のレベル」で考えさせる |
| **並行環境の重要性** | 本番環境を守りながら大胆な実験が可能 |
| **プロンプトエンジニアリング** | 出力の質はプロンプトの質に依存 |

---

## チェックリスト

### 🎯 問題解決開始時

- [ ] ゴール（達成したい状態）を明確に伝えたか？
- [ ] 現在の状況（何が起きているか）を説明したか？
- [ ] AIに自律性を与えたか？（"ブラウザチェックしながら自律的に..."）

### 🎯 デバッグ中

- [ ] ログを仕込んで中間状態を確認しているか？
- [ ] 同じアプローチを3回以上繰り返していないか？
- [ ] 問題のレイヤー（フロント/バック/プロンプト/ライブラリ）を切り分けたか？

### 🎯 行き詰まった時

- [ ] "何が起きているのですか？"と前提を問い直したか？
- [ ] "深呼吸プロンプト"を試したか？
- [ ] Git履歴を活用してA/Bテストを試したか？
- [ ] 並行環境（別ポート）でのテストを検討したか？

### 🎯 解決後

- [ ] 一時ファイル（test-*.js など）をクリーンアップしたか？
- [ ] 学んだ教訓をドキュメント化したか？
- [ ] 根本原因と解決策を理解したか？

---

## まとめ

### 🌟 Cursor AI 協働の3つの柱

1. **自律性の付与**
   - マイクロマネージメントしない
   - AIに探索と判断を委ねる

2. **的確なフィードバック**
   - "変わりません" で同じアプローチを止める
   - "深呼吸して" で方向転換を促す

3. **構造的アプローチ**
   - A/Bテスト、並行環境、ログドリブン
   - 手段を固定せず、最適解を探索

### 📈 効果測定

このマニュアルの技法を実践することで：

- ✅ デバッグ時間が **50-80%** 削減
- ✅ 解決不可能に見えた問題が **90%以上** 解決
- ✅ AIの提案品質が **3-5倍** 向上

---

## 関連リソース

- **[architecture/prompt-design.md](../architecture/prompt-design.md)** - プロンプト設計ベストプラクティス
- **[testing/chatbot-performance-improvement-plan.md](../testing/chatbot-performance-improvement-plan.md)** - パフォーマンス改善計画
- **[operations/deployment-guide.md](./deployment-guide.md)** - デプロイガイド

---

**作成日**: 2025年10月14日  
**バージョン**: 1.0.0  
**ライセンス**: MIT

