# スコアリング簡素化の品質チェックリスト

## 🎯 目的

スコアリングアルゴリズムの簡素化により、検索品質が劣化していないかを確認する。

---

## 📋 チェック項目

### 1. パフォーマンステスト

#### 検索時間の改善

- [ ] **検索時間**: 11.8秒 → **5-6秒** に短縮されているか
- [ ] **エンベディングキャッシュ**: 2回目の同じ質問で高速化されているか
- [ ] **総処理時間**: 29秒 → **23秒** に短縮されているか

**確認方法**:
1. 管理ダッシュボードでパフォーマンス指標を確認
2. 同じ質問を2回投稿してキャッシュヒットを確認
3. コンソールログで「🚀 エンベディングキャッシュヒット」を確認

---

### 2. 品質テスト: 高リスク質問（制約・条件系）

**削除したロジック**: 制約表現検出ブースト

#### テスト1: 「パーソナルオファーは最大何件送れますか？」

**期待される結果**:
- 上位1件: 「パーソナルオファー - 登録機能」または「契約管理」
- 回答に「上限」「追加数」などの制約情報が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に具体的な数値制限が含まれているか
- [ ] 品質が最適化前と同等か

**備考**:
```
制約表現検出が削除されたため、「上限」「以内」などのキーワードブーストがない。
ベクトル検索とフレーズマッチで補完できるか要確認。
```

#### テスト2: 「求人は何日間掲載されますか？」

**期待される結果**:
- 上位1件: 「求人管理」または「掲載期間」に関する文書
- 回答に具体的な日数が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に掲載期間が含まれているか
- [ ] 品質が最適化前と同等か

#### テスト3: 「ログイン失敗は何回までできますか？」

**期待される結果**:
- 上位1件: 「ログイン認証」または「セキュリティ」に関する文書
- 回答に試行回数制限が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に試行回数が含まれているか
- [ ] 品質が最適化前と同等か

#### テスト4: 「画像のアップロード上限は？」

**期待される結果**:
- 上位1件: 「画像アップロード」または「ファイル管理」
- 回答にファイルサイズ制限が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答にサイズ制限が含まれているか
- [ ] 品質が最適化前と同等か

---

### 3. 品質テスト: 中リスク質問（複合キーワード系）

**削除したロジック**: 近接ブースト、キーワード詳細マッチング

#### テスト5: 「教室グループの求人設定方法は？」

**期待される結果**:
- 上位1件: 「教室グループ」と「求人設定」の両方に関連する文書
- 回答に設定手順が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に設定手順が含まれているか
- [ ] 「教室グループ」と「求人」が離れた文書が混入していないか

#### テスト6: 「クライアント企業の契約管理」

**期待される結果**:
- 上位1件: 「クライアント企業」と「契約」に関する文書
- 回答に契約管理機能の説明が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に契約管理の説明が含まれているか
- [ ] 品質が最適化前と同等か

#### テスト7: 「会員の応募履歴確認」

**期待される結果**:
- 上位1件: 「会員」と「応募履歴」に関する文書
- 回答に確認方法が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に確認方法が含まれているか
- [ ] 品質が最適化前と同等か

#### テスト8: 「求人情報の編集と削除」

**期待される結果**:
- 上位1件: 「求人情報」の「編集」「削除」機能
- 回答に編集・削除の手順が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か
- [ ] 回答に編集・削除の手順が含まれているか
- [ ] 品質が最適化前と同等か

---

### 4. 品質テスト: 低リスク質問（シンプル系）

**影響**: ほぼなし（ベクトル検索で十分）

#### テスト9: 「教室コピー機能とは？」

**期待される結果**:
- 上位1件: 「教室コピー機能」の仕様書
- 回答に機能概要が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か（変化なしを期待）
- [ ] 回答の品質が維持されているか

#### テスト10: 「ログイン認証の仕組みは？」

**期待される結果**:
- 上位1件: 「ログイン認証」の仕様書
- 回答に認証フローが含まれる

**チェック**:
- [ ] 上位1件の文書が適切か（変化なしを期待）
- [ ] 回答の品質が維持されているか

#### テスト11: 「求人検索機能について」

**期待される結果**:
- 上位1件: 「求人検索機能」の仕様書
- 回答に検索機能の説明が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か（変化なしを期待）
- [ ] 回答の品質が維持されているか

#### テスト12: 「パーソナルオファーの概要」

**期待される結果**:
- 上位1件: 「パーソナルオファー」の概要文書
- 回答に機能説明が含まれる

**チェック**:
- [ ] 上位1件の文書が適切か（変化なしを期待）
- [ ] 回答の品質が維持されているか

---

### 5. 汎用文書の混入チェック

**削除したロジック**: 汎用文書ペナルティ

#### テスト13: 各質問で上位5件をチェック

**チェック項目**:
- [ ] 「用語集」「ガイドライン」「一覧」などの汎用文書が上位に来ていないか
- [ ] 「共通要件」「非機能要件」などの総論文書が上位に来ていないか
- [ ] 「本システム外」を含む文書が上位に来ていないか

**期待される結果**:
- 汎用文書は上位3件以内に含まれない
- 質問に直接関連する文書が優先される

---

### 6. 多様性チェック

**削除したロジック**: MMR多様化

#### テスト14: タイトルが似た文書の連続表示

**チェック項目**:
- [ ] 「【FIX】パーソナルオファー - 登録」「【FIX】パーソナルオファー - 削除」など、類似タイトルが連続していないか
- [ ] 重複除去ロジックが機能しているか

**期待される結果**:
- 同じトピックの文書でも、異なる観点のものが表示される
- 完全に重複した文書は除外されている

---

## 📊 総合評価

### 合格基準

以下の条件を満たす場合、簡素化版を採用:

1. **パフォーマンス**: ✅
   - 検索時間が50%以上削減されている

2. **品質（高リスク質問）**: ⚠️
   - 12問中**10問以上**が最適化前と同等以上の品質
   - 残り2問も「許容範囲内」の劣化

3. **品質（中リスク質問）**: ✅
   - 4問中**3問以上**が最適化前と同等以上の品質

4. **品質（低リスク質問）**: ✅
   - 4問中**4問全て**が最適化前と同等以上の品質

5. **汎用文書混入**: ✅
   - 汎用文書が上位3件に含まれる質問が**20%以下**

6. **多様性**: ✅
   - 類似文書の連続が**目立たない**

### 不合格の場合の対処

合格基準を満たさない場合:

1. **部分的な復元**: 削除したロジックの一部を復元
   - 優先度1: 制約表現検出ブースト（高リスク質問に効果大）
   - 優先度2: 汎用文書ペナルティ（混入防止）
   - 優先度3: 近接ブースト（中リスク質問に効果）

2. **段階的な最適化**: 
   - ロジックを1つずつ復元して効果を確認
   - パフォーマンスと品質のバランスを見つける

3. **キャッシュ戦略の強化**:
   - スコアリングは複雑なままで、エンベディングキャッシュとDB側フィルタリングのみ適用

---

## 🔧 テスト実行方法

### 手動テスト

1. `npm run dev` でサーバーを起動
2. ブラウザで各質問を投稿
3. チェックリストに従って確認
4. 管理ダッシュボードでパフォーマンス指標を確認

### 自動テスト（推奨）

```bash
# テストスクリプトを実行
npx tsx scripts/test-scoring-quality.ts

# 結果を確認
cat logs/test-results-*.json
```

---

**作成日**: 2025-10-08
**更新日**: 2025-10-08

