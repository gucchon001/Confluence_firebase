# 会員ログイン機能検索品質テスト仕様書

## 概要

「会員のログイン機能の詳細を教えて」クエリを品質基準として、検索システムの抽出ページと出力結果の品質を評価するテスト仕様書です。

## テスト対象クエリ

**メインクエリ:** `会員のログイン機能の詳細を教えて`

## 品質基準

### 1. 理想の抽出ページ（NotebookLMの出力に基づく）

#### 1.1 主要なログイン機能ページ（優先度：高）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `042_【FIX】会員ログイン・ログアウト機能` | 90+ | `["機能要件"]` | メインのログイン・ログアウト機能 |
| `045_【FIX】パスワード再設定機能` | 80+ | `["機能要件"]` | パスワード再設定機能 |
| `043_【FIX】プロフィール編集機能（基本情報タブ）` | 75+ | `["機能要件"]` | ログイン後のプロフィール編集 |
| `014-1_【FIX】求人応募兼会員登録機能` | 70+ | `["機能要件"]` | 未ログイン時の応募機能 |
| `022_【FIX】記事詳細閲覧機能` | 70+ | `["機能要件"]` | 会員限定記事閲覧機能 |
| `057_【FIX】キープした求人一覧閲覧機能` | 65+ | `["機能要件"]` | ログイン後のキープ機能 |

#### 1.2 セキュリティ関連ページ（優先度：高）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `アカウントロック通知メール（会員宛）` | 75+ | `["機能要件"]` | アカウントロック通知 |
| `ログイン失敗ログ` | 70+ | `["機能要件"]` | ログイン失敗のログ管理 |
| `セッション管理機能` | 65+ | `["機能要件"]` | セッション管理 |

#### 1.3 関連する設定・管理ページ（優先度：中）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `065_【FIX】スカウト・マッチ利用設定機能` | 60+ | `["機能要件"]` | ログイン後の設定機能 |
| `会員認証機能` | 60+ | `["機能要件"]` | 会員認証の基盤 |
| `ログイン状態確認機能` | 55+ | `["機能要件"]` | ログイン状態の確認 |

#### 1.4 会員登録関連ページ（優先度：中）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `会員登録機能` | 60+ | `["機能要件"]` | 会員登録機能 |
| `メールアドレス認証機能` | 55+ | `["機能要件"]` | メールアドレス認証 |

### 2. 除外されるべきページ

#### 2.1 フォルダラベルページ（除外対象）

| ページタイトル | ラベル | 除外理由 |
|---|---|---|
| `■会員管理機能` | `["フォルダ"]` | フォルダラベル |
| `■認証・ログイン機能` | `["機能要件", "フォルダ"]` | フォルダラベル |
| `■セキュリティ機能` | `["機能要件", "フォルダ"]` | フォルダラベル |

#### 2.2 関連性の低いページ（除外対象）

| ページタイトル | ラベル | 除外理由 |
|---|---|---|---|
| `会員統計データ` | `["帳票"]` | ログイン機能の詳細とは直接関係なし |
| `ログイン履歴ログ` | `["ログ"]` | ログイン機能の詳細とは直接関係なし |
| `【作成中】二段階認証機能` | `["共通要件"]` | スコープ外の機能 |

#### 2.3 スコープ外の機能ページ（除外対象）

| ページタイトル | ラベル | 除外理由 |
|---|---|---|---|
| `SNSログイン機能` | `["機能要件"]` | スコープ外（提供されない機能） |
| `SSO認証機能` | `["機能要件"]` | スコープ外（提供されない機能） |
| `ログイン通知機能` | `["機能要件"]` | スコープ外（提供されない機能） |

## テストケース

### テストケース1: 基本検索テスト

**クエリ:** `会員のログイン機能の詳細を教えて`

**期待される結果:**
- 抽出ページ数: 8-12件
- 上位3件に主要なログイン機能ページが含まれる
- フォルダラベルページが除外される
- 関連性の低いページが除外される
- スコープ外の機能ページが除外される

**合格基準:**
- 主要なログイン機能ページ（1.1）のうち5件以上が検索結果に含まれる
- 除外されるべきページ（2.1, 2.2, 2.3）が検索結果に含まれない
- 上位3件のスコアが75以上

### テストケース2: キーワードマッチングテスト

**クエリ:** `会員のログイン機能の詳細を教えて`

**期待されるキーワード抽出:**
- 基本キーワード: `["会員", "ログイン", "機能", "詳細"]`
- 分割キーワード: `["会員ログイン", "ログイン機能", "会員のログイン", "ログイン詳細"]`
- LLM拡張キーワード: ログイン機能に関連する同義語

**理想のキーワード抽出結果:**
```json
{
  "keywords": [
    "会員ログイン", "ログイン機能", "会員", "ログイン", 
    "ログアウト", "パスワード", "認証", "セッション", 
    "アカウントロック", "ログイン詳細", "会員認証"
  ],
  "highPriority": ["会員ログイン", "ログイン機能", "会員", "ログイン"],
  "lowPriority": ["ログアウト", "パスワード", "認証", "セッション", "アカウントロック", "ログイン詳細", "会員認証"]
}
```

**合格基準:**
- キーワードスコアが0でない
- 分割されたキーワードが正しく抽出される
- タイトルマッチングが正しく動作する
- 理想のキーワード抽出結果に近い結果が得られる
- キーワード数が8個以上
- ログイン機能に関連する具体的な機能名が含まれる

### テストケース3: スコアリングテスト

**クエリ:** `会員のログイン機能の詳細を教えて`

**期待されるスコア分布:**
- 主要なログイン機能ページ: 80-95点
- セキュリティ関連ページ: 70-85点
- 関連する設定・管理ページ: 60-75点
- 会員登録関連ページ: 55-70点

**合格基準:**
- スコアが期待値の±10点以内
- スコアの順序が期待される優先度と一致

### テストケース4: 機能分類テスト

**クエリ:** `会員のログイン機能の詳細を教えて`

**期待される機能分類:**
1. **ログイン・ログアウト機能**
   - 会員ログイン・ログアウト機能
   - パスワード再設定機能

2. **セキュリティ機能**
   - アカウントロック機能
   - ログイン失敗ログ
   - セッション管理

3. **認証・認可機能**
   - 会員認証機能
   - ログイン状態確認機能

4. **関連機能**
   - プロフィール編集機能
   - 各種設定機能
   - 会員限定機能

**合格基準:**
- 各機能分類から適切なページが抽出される
- ログイン・ログアウト機能ページが2件以上
- セキュリティ機能ページが2件以上
- 認証・認可機能ページが1件以上
- 関連機能ページが2件以上

### テストケース5: セキュリティ機能テスト

**クエリ:** `会員のログイン機能の詳細を教えて`

**期待されるセキュリティ関連ページ:**
- アカウントロック機能
- エラーメッセージ制限
- ログイン失敗ログ
- セッション管理
- パスワード再設定

**合格基準:**
- セキュリティ関連ページが3件以上抽出される
- アカウントロック機能が含まれる
- ログイン失敗ログが含まれる

## 品質メトリクス

### 1. 検索精度（Precision）

```
Precision = 関連するページ数 / 検索結果総数
```

**目標値:** 0.8以上

### 2. 検索再現率（Recall）

```
Recall = 検索結果に含まれる関連ページ数 / 理想の関連ページ総数
```

**目標値:** 0.7以上

### 3. F1スコア

```
F1 = 2 × (Precision × Recall) / (Precision + Recall)
```

**目標値:** 0.75以上

### 4. 平均スコア

```
Average Score = 検索結果のスコア合計 / 検索結果数
```

**目標値:** 75以上

### 5. 機能分類カバレッジ

```
Coverage = 抽出された機能分類数 / 理想の機能分類数
```

**目標値:** 0.8以上（4分類中3.2以上）

### 6. セキュリティ機能カバレッジ

```
Security Coverage = 抽出されたセキュリティ機能数 / 理想のセキュリティ機能数
```

**目標値:** 0.6以上（5機能中3以上）

## テスト実行手順

### 1. 事前準備

```bash
# 検索システムの起動
npm run dev

# テストデータの確認
npx tsx -e "import { searchLanceDB } from './src/lib/lancedb-search-client'; searchLanceDB({ query: '会員のログイン機能の詳細を教えて', topK: 20 }).then(r => console.log('Search results:', r.map(x => ({ title: x.title, score: x.score, labels: x.labels }))))"
```

### 2. テスト実行

```bash
# テストスクリプトの実行
npx tsx src/tests/member-login-function-search-test.ts
```

### 3. 結果評価

1. 検索結果の確認
2. スコアの検証
3. 除外ページの確認
4. 機能分類の確認
5. セキュリティ機能の確認
6. メトリクスの計算

## 品質改善の指針

### 1. キーワード抽出の改善

- 分割キーワードの精度向上
- ログイン機能関連の同義語拡張
- ストップワードの最適化

### 2. スコアリングの改善

- タイトルマッチングの重み調整
- コンテンツマッチングの精度向上
- ラベルマッチングの最適化

### 3. フィルタリングの改善

- ラベルフィルタリングの精度向上
- 関連性の低いページの除外
- スコープ外機能の除外

### 4. 機能分類の改善

- ログイン・ログアウト機能の識別精度向上
- セキュリティ機能の適切な分類
- 認証・認可機能の分類

### 5. セキュリティ機能の改善

- セキュリティ関連ページの識別精度向上
- アカウントロック機能の適切な抽出
- ログイン失敗ログの分類

## 継続的改善

### 1. 定期的なテスト実行

- 週次での品質テスト実行
- 月次でのメトリクス分析

### 2. フィードバックの収集

- ユーザーフィードバックの収集
- 検索結果の品質評価

### 3. アルゴリズムの改善

- テスト結果に基づくパラメータ調整
- 新しい検索手法の導入

## 参考資料

- [NotebookLMの出力結果](./member-login-function-notebooklm-output.md)
- [検索チューニング計画](./search-tuning-plan.md)
- [検索チューニング結果](./search-tuning-results.md)
- [教室管理検索品質テスト](./classroom-management-search-quality-test.md)
- [オファー機能検索品質テスト](./offer-function-search-quality-test.md)
