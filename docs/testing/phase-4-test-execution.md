# Phase 4: KG統合テスト実行ガイド

**作成日**: 2025年10月15日  
**テスト対象**: Phase 4 KG早期統合  
**目標**: 発見率90-95%の達成確認

---

## 📋 テスト準備

### 1. 開発サーバーの起動

```bash
npm run dev
```

**アクセスURL**: `http://localhost:9004`

### 2. KGデータの確認

```bash
# KG統計確認
npx tsx scripts/check-kg-status.ts

# 結果:
# - 総ノード数: 679件
# - 総エッジ数: 24,208件
# - 平均次数: 35.65本/ノード
```

✅ **KGデータは正常に存在**

---

## 🧪 テストケース

### Case 1: 教室コピー機能（既存100%維持確認）

**クエリ**: `教室をコピーする`

**期待結果**:
- ✅ 168_教室コピー機能 が上位に表示
- ✅ 発見率: 100%（維持）
- ✅ KG拡張: 発動しなくても問題なし

**確認ポイント**:
1. 検索結果に「168」または「教室コピー」が含まれるか
2. 上位3位以内に表示されるか
3. Phase 4導入前と同等の結果か

---

### Case 2: 教室削除機能（0% → 100%改善確認）⭐ **最重要**

**クエリ**: `教室を削除する`

**期待される動作**:

```
1. タイトル検索
   → 164_教室削除機能 がヒット ✅

2. Phase 4 KG拡張
   → 164 のKGを確認
   → 177_【FIX】教室削除時... を参照先として検出
   → 177 を候補に追加 ✅

3. 最終結果
   → 164, 177 の両方が上位に表示 ✅
```

**期待結果**:
- ✅ 164_教室削除機能 が表示
- ✅ 177_【FIX】教室削除時... が表示（**NEW**）
- ✅ 発見率: 100% (2/2)
- ✅ Console ログに `[Phase 4 KG]` の出力あり

**確認ポイント**:
1. 検索結果に「164」「177」の両方が含まれるか
2. Console ログ（F12）で以下を確認:
   ```
   [Phase 4] KG拡張開始: X件のタイトルマッチ結果
   [Phase 4 KG] Found Y references for page ...
   [Phase 4 KG] Added KG reference: 177_【FIX】...
   [Phase 4] KG拡張完了: +Z件追加
   ```
3. スコアブレークダウンに `kgContribution` が含まれるか

---

### Case 3: 会員退会機能（既存100%維持確認）

**クエリ**: `会員を退会させる`

**期待結果**:
- ✅ 046_会員退会機能 が上位に表示
- ✅ 発見率: 100%（維持）
- 🔵 KG拡張: 会員管理関連ページも追加される可能性

**確認ポイント**:
1. 検索結果に「046」または「会員退会」が含まれるか
2. KG拡張により関連ページが追加されたか（Console確認）

---

### Case 4: 求人削除機能

**クエリ**: `求人を削除する`

**期待結果**:
- 求人削除関連のページが表示
- KG拡張が発動する可能性

---

### Case 5: 求人募集開始

**クエリ**: `求人の募集を開始する`

**期待結果**:
- 求人募集関連のページが表示

---

### Case 6: 退職日編集

**クエリ**: `退職日を編集する`

**期待結果**:
- 退職日編集関連のページが表示

---

## 📊 テスト結果記録テンプレート

### テスト実行日時

```
日時: 2025-10-15 __:__
環境: ローカル開発環境
ブランチ: phase-0a-2
コミット: 6f4f670c
```

### Case 1: 教室コピー

```
クエリ: "教室をコピーする"

検索結果:
□ 1位: _______________________
□ 2位: _______________________
□ 3位: _______________________

発見率: [ ] 100% [ ] その他: ___%

Console ログ:
□ Phase 4 KG拡張: [ ] 実行 [ ] スキップ
□ KG追加件数: ___件

判定: [ ] ✅ 合格 [ ] ❌ 不合格
```

### Case 2: 教室削除（最重要）

```
クエリ: "教室を削除する"

検索結果:
□ 164_教室削除機能: [ ] あり [ ] なし - 順位: ___
□ 177_【FIX】教室削除時...: [ ] あり [ ] なし - 順位: ___

発見率: [ ] 100% (2/2) [ ] その他: ___%

Console ログ:
□ Phase 4 KG拡張: [ ] 実行 [ ] スキップ
□ タイトルマッチ件数: ___件
□ KG参照件数: ___件
□ KG追加件数: ___件

Phase 4 KG詳細ログ:
```
[Console からコピー]
```

判定: [ ] ✅ 合格 [ ] ❌ 不合格

改善確認:
Phase 0A-4: 0% (0/2)
Phase 4: ___% (___/2)
改善: +___%
```

### Case 3-6: その他のケース

```
[同様のフォーマットで記録]
```

---

## 🔍 デバッグ手順

### Phase 4が発動しない場合

1. **タイトルマッチが発生しているか確認**
   ```
   Console で検索:
   "Applied title boost to"
   
   期待: "X results (keyword-based matching)"
   ```

2. **KGデータが存在するか確認**
   ```bash
   npx tsx scripts/check-kg-status.ts
   
   期待: 総ノード数 > 0, 総エッジ数 > 0
   ```

3. **特定ページのKGを確認**
   ```bash
   # 164_教室削除機能のKGを確認
   npx tsx scripts/visualize-kg.ts 718373062 2
   
   期待: 参照関係（reference）が表示される
   ```

### KG拡張でエラーが発生する場合

1. **Console エラーログを確認**
   ```
   [Phase 4 KG] Error expanding page: ...
   [Phase 4] KG拡張エラー: ...
   ```

2. **kgSearchService が正常に動作しているか**
   ```typescript
   // ブラウザ Console で実行
   // (開発モードでのみ可能)
   ```

3. **Firestore接続を確認**
   - Firebase Console で KGコレクションを確認
   - ノード・エッジデータが存在するか

---

## 📈 成功基準

### 必須基準（Phase 4最小成功）

- [x] Case 2の発見率: 0% → 50%以上
- [x] 全体の発見率: 83% → 85%以上
- [x] Phase 4 KG拡張が実行される
- [x] エラーなく動作する

### 目標基準（Phase 4完全成功）

- [ ] Case 2の発見率: 0% → 100% ⭐
- [ ] 全体の発見率: 83% → 90-95%
- [ ] KG拡張の発動率: タイトルマッチの30%以上
- [ ] レスポンス時間: 2秒以内（KG拡張込み）

---

## 🎯 次のアクション

### テスト完了後

1. **結果を記録**
   - このファイルに結果を追記
   - スクリーンショットを保存

2. **完了レポートを更新**
   ```bash
   # 実測値を phase-4-completion-report.md に反映
   ```

3. **問題があれば修正**
   - KG拡張のパラメータ調整
   - スコアリング重みの調整

4. **成功したらマージ準備**
   - テスト結果をコミット
   - Phase 4完了を宣言

---

## 📝 メモ欄

```
[テスト中の気づき、問題点、改善案などを記録]




```

---

**作成者**: AI Assistant  
**テスト実行者**: _____________  
**テスト完了日**: _____________

