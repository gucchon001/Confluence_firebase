# 教室コピー機能検索品質テスト仕様書

## 概要

「教室コピー機能でコピー可能な項目は？」クエリを品質基準として、検索システムの抽出ページと出力結果の品質を評価するテスト仕様書です。

## テスト対象クエリ

**メインクエリ:** `教室コピー機能でコピー可能な項目は？`

## 品質基準

### 1. 理想の抽出ページ（NotebookLMの出力に基づく）

#### 1.1 主要な教室コピー機能ページ（優先度：高）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `168_【FIX】教室コピー機能` | 90+ | `["機能要件"]` | メインの教室コピー機能 |
| `教室コピー可能項目一覧` | 85+ | `["機能要件"]` | コピー可能項目の一覧 |
| `教室コピー処理仕様` | 80+ | `["機能要件"]` | コピー処理の詳細仕様 |

#### 1.2 教室情報コピー項目ページ（優先度：高）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `【FIX】教室：基本情報／所在地` | 85+ | `["機能要件"]` | 基本情報のコピー項目 |
| `【FIX】教室：応募情報転送連絡先／応募後連絡先電話番号` | 80+ | `["機能要件"]` | 応募情報転送先のコピー項目 |
| `【FIX】教室：塾チャート` | 80+ | `["機能要件"]` | 塾チャートのコピー項目 |
| `【FIX】教室：ロゴ・スライド画像` | 75+ | `["機能要件"]` | 画像のコピー項目 |

#### 1.3 求人情報コピー項目ページ（優先度：高）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `【FIX】求人：基本情報` | 80+ | `["機能要件"]` | 求人基本情報のコピー項目 |
| `【FIX】求人：勤務条件・指導科目` | 80+ | `["機能要件"]` | 勤務条件のコピー項目 |
| `【FIX】求人：応募条件・研修情報` | 80+ | `["機能要件"]` | 応募条件のコピー項目 |
| `【FIX】求人：応募情報等` | 80+ | `["機能要件"]` | 応募情報のコピー項目 |
| `【FIX】求人：PR情報` | 80+ | `["機能要件"]` | PR情報のコピー項目 |

#### 1.4 教室情報編集機能ページ（優先度：中）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `163_【FIX】教室情報編集機能` | 75+ | `["機能要件"]` | 教室情報編集の詳細項目 |
| `教室情報編集機能（基本情報タブ）` | 70+ | `["機能要件"]` | 基本情報タブの項目 |
| `教室情報編集機能（応募情報タブ）` | 70+ | `["機能要件"]` | 応募情報タブの項目 |

#### 1.5 求人情報編集機能ページ（優先度：中）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `求人情報編集機能（基本情報タブ）` | 75+ | `["機能要件"]` | 求人基本情報タブの項目 |
| `求人情報編集機能（勤務条件タブ）` | 75+ | `["機能要件"]` | 勤務条件タブの項目 |
| `求人情報編集機能（応募条件タブ）` | 75+ | `["機能要件"]` | 応募条件タブの項目 |
| `求人情報編集機能（応募情報タブ）` | 75+ | `["機能要件"]` | 応募情報タブの項目 |
| `求人情報編集機能（PR情報タブ）` | 75+ | `["機能要件"]` | PR情報タブの項目 |

#### 1.6 コピー制限・制約ページ（優先度：中）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `教室コピー制限事項` | 70+ | `["機能要件"]` | コピー制限の詳細 |
| `画像コピー制限` | 70+ | `["機能要件"]` | 画像コピーの制限 |
| `コピー件数制限` | 65+ | `["機能要件"]` | コピー件数の制限 |
| `非同期コピー処理` | 60+ | `["機能要件"]` | 非同期処理の仕様 |

#### 1.7 コピー処理挙動ページ（優先度：中）

| ページタイトル | 期待スコア | ラベル | 説明 |
|---|---|---|---|
| `教室コピー処理挙動` | 75+ | `["機能要件"]` | コピー処理の挙動 |
| `求人数によるコピー挙動` | 70+ | `["機能要件"]` | 求人数による処理分岐 |
| `教室プラン設定` | 65+ | `["機能要件"]` | 教室プランの設定 |

### 2. 除外されるべきページ

#### 2.1 フォルダラベルページ（除外対象）

| ページタイトル | ラベル | 除外理由 |
|---|---|---|---|
| `■教室管理機能` | `["フォルダ"]` | フォルダラベル |
| `■コピー機能` | `["機能要件", "フォルダ"]` | フォルダラベル |
| `■教室情報管理` | `["機能要件", "フォルダ"]` | フォルダラベル |

#### 2.2 関連性の低いページ（除外対象）

| ページタイトル | ラベル | 除外理由 |
|---|---|---|---|
| `教室統計データ` | `["帳票"]` | コピー可能項目とは直接関係なし |
| `教室作成ログ` | `["ログ"]` | コピー可能項目とは直接関係なし |
| `【作成中】教室削除機能` | `["共通要件"]` | コピー可能項目とは直接関係なし |

#### 2.3 コピー対象外の機能ページ（除外対象）

| ページタイトル | ラベル | 除外理由 |
|---|---|---|---|
| `教室削除機能` | `["機能要件"]` | コピー機能とは逆の機能 |
| `教室復元機能` | `["機能要件"]` | コピー機能とは異なる機能 |

## テストケース

### テストケース1: 基本検索テスト

**クエリ:** `教室コピー機能でコピー可能な項目は？`

**期待される結果:**
- 抽出ページ数: 10-15件
- 上位3件に主要な教室コピー機能ページが含まれる
- フォルダラベルページが除外される
- 関連性の低いページが除外される
- コピー対象外の機能ページが除外される

**合格基準:**
- 主要な教室コピー機能ページ（1.1）のうち3件以上が検索結果に含まれる
- 除外されるべきページ（2.1, 2.2, 2.3）が検索結果に含まれない
- 上位3件のスコアが80以上

### テストケース2: キーワードマッチングテスト

**クエリ:** `教室コピー機能でコピー可能な項目は？`

**期待されるキーワード抽出:**
- 基本キーワード: `["教室", "コピー", "機能", "可能", "項目"]`
- 分割キーワード: `["教室コピー", "コピー機能", "コピー可能", "可能項目"]`
- LLM拡張キーワード: 教室コピー機能に関連する同義語

**理想のキーワード抽出結果:**
```json
{
  "keywords": [
    "教室コピー", "コピー機能", "コピー可能", "可能項目", 
    "教室", "コピー", "項目", "基本情報", "求人情報", 
    "応募情報", "塾チャート", "ロゴ", "スライド画像"
  ],
  "highPriority": ["教室コピー", "コピー機能", "コピー可能", "可能項目"],
  "lowPriority": ["教室", "コピー", "項目", "基本情報", "求人情報", "応募情報", "塾チャート", "ロゴ", "スライド画像"]
}
```

**合格基準:**
- キーワードスコアが0でない
- 分割されたキーワードが正しく抽出される
- タイトルマッチングが正しく動作する
- 理想のキーワード抽出結果に近い結果が得られる
- キーワード数が10個以上
- 教室コピー機能に関連する具体的な項目名が含まれる

### テストケース3: スコアリングテスト

**クエリ:** `教室コピー機能でコピー可能な項目は？`

**期待されるスコア分布:**
- 主要な教室コピー機能ページ: 85-95点
- 教室情報コピー項目ページ: 80-90点
- 求人情報コピー項目ページ: 80-90点
- 教室情報編集機能ページ: 70-85点
- 求人情報編集機能ページ: 75-85点
- コピー制限・制約ページ: 65-80点
- コピー処理挙動ページ: 70-85点

**合格基準:**
- スコアが期待値の±10点以内
- スコアの順序が期待される優先度と一致

### テストケース4: 項目分類テスト

**クエリ:** `教室コピー機能でコピー可能な項目は？`

**期待される項目分類:**
1. **教室情報項目**
   - 基本情報（教室名、教室名カナ、ホームページ等）
   - 応募情報転送先
   - 塾チャート
   - ロゴ・スライド画像

2. **求人情報項目**
   - 基本情報
   - 勤務条件・指導科目
   - 応募条件・研修情報
   - 応募情報等
   - PR情報

3. **コピー制限・制約**
   - 画像コピー制限（100件上限）
   - 非同期処理
   - 求人数による処理分岐

4. **コピー処理挙動**
   - 求人数による上書き・新規作成
   - 教室プラン設定

**合格基準:**
- 各項目分類から適切なページが抽出される
- 教室情報項目ページが4件以上
- 求人情報項目ページが5件以上
- コピー制限・制約ページが3件以上
- コピー処理挙動ページが2件以上

### テストケース5: 詳細項目テスト

**クエリ:** `教室コピー機能でコピー可能な項目は？`

**期待される詳細項目ページ:**
- 教室名、教室名カナ、ホームページ
- アクセス方法、管理メモ1、管理メモ2
- 応募情報転送連絡先
- 応募後連絡先電話番号
- 塾チャート各項目
- ロゴ・スライド画像各項目

**合格基準:**
- 詳細項目関連ページが8件以上抽出される
- 基本情報項目が含まれる
- 応募情報項目が含まれる
- 塾チャート項目が含まれる
- 画像項目が含まれる

## 品質メトリクス

### 1. 検索精度（Precision）

```
Precision = 関連するページ数 / 検索結果総数
```

**目標値:** 0.8以上

### 2. 検索再現率（Recall）

```
Recall = 検索結果に含まれる関連ページ数 / 理想の関連ページ総数
```

**目標値:** 0.7以上

### 3. F1スコア

```
F1 = 2 × (Precision × Recall) / (Precision + Recall)
```

**目標値:** 0.75以上

### 4. 平均スコア

```
Average Score = 検索結果のスコア合計 / 検索結果数
```

**目標値:** 80以上

### 5. 項目分類カバレッジ

```
Coverage = 抽出された項目分類数 / 理想の項目分類数
```

**目標値:** 0.8以上（4分類中3.2以上）

### 6. 詳細項目カバレッジ

```
Detail Coverage = 抽出された詳細項目数 / 理想の詳細項目数
```

**目標値:** 0.7以上（10項目中7以上）

## テスト実行手順

### 1. 事前準備

```bash
# 検索システムの起動
npm run dev

# テストデータの確認
npx tsx -e "import { searchLanceDB } from './src/lib/lancedb-search-client'; searchLanceDB({ query: '教室コピー機能でコピー可能な項目は？', topK: 20 }).then(r => console.log('Search results:', r.map(x => ({ title: x.title, score: x.score, labels: x.labels }))))"
```

### 2. テスト実行

```bash
# テストスクリプトの実行
npx tsx src/tests/classroom-copy-function-search-test.ts
```

### 3. 結果評価

1. 検索結果の確認
2. スコアの検証
3. 除外ページの確認
4. 項目分類の確認
5. 詳細項目の確認
6. メトリクスの計算

## 品質改善の指針

### 1. キーワード抽出の改善

- 分割キーワードの精度向上
- 教室コピー機能関連の同義語拡張
- ストップワードの最適化

### 2. スコアリングの改善

- タイトルマッチングの重み調整
- コンテンツマッチングの精度向上
- ラベルマッチングの最適化

### 3. フィルタリングの改善

- ラベルフィルタリングの精度向上
- 関連性の低いページの除外
- コピー対象外機能の除外

### 4. 項目分類の改善

- 教室情報項目の識別精度向上
- 求人情報項目の適切な分類
- コピー制限・制約の分類

### 5. 詳細項目の改善

- 詳細項目関連ページの識別精度向上
- 基本情報項目の適切な抽出
- 応募情報項目の分類

## 継続的改善

### 1. 定期的なテスト実行

- 週次での品質テスト実行
- 月次でのメトリクス分析

### 2. フィードバックの収集

- ユーザーフィードバックの収集
- 検索結果の品質評価

### 3. アルゴリズムの改善

- テスト結果に基づくパラメータ調整
- 新しい検索手法の導入

## 参考資料

- [NotebookLMの出力結果](./classroom-copy-function-notebooklm-output.md)
- [検索チューニング計画](./search-tuning-plan.md)
- [検索チューニング結果](./search-tuning-results.md)
- [教室管理検索品質テスト](./classroom-management-search-quality-test.md)
- [オファー機能検索品質テスト](./offer-function-search-quality-test.md)
- [会員ログイン機能検索品質テスト](./member-login-function-search-quality-test.md)
- [教室削除問題検索品質テスト](./classroom-deletion-issue-search-quality-test.md)
