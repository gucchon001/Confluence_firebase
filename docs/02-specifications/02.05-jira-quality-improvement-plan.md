# Jira品質向上実装計画

**作成日**: 2025年1月  
**バージョン**: 1.0  
**ステータス**: 📋 計画段階  
**目標**: Jira検索をConfluenceと同様の品質レベルに向上させる

---

## 📋 概要

本計画では、Jira検索システムをConfluenceと同様の品質レベルに向上させるため、段階的な実装を行います。既存のConfluence機能に影響を与えないよう、細心の注意を払いながら開発環境→本番環境の順で実装を進めます。

---

## 🎯 目標

### 品質目標

| 項目 | 現状（Jira） | 目標（Confluence同等） | 改善率 |
|------|------------|---------------------|--------|
| **検索性能** | 100-300ms | 7-23ms | **約90%改善** |
| **検索タイプ数** | 2種類 | 4種類 | **2倍** |
| **ラベルフィルタリング** | ❌ | ✅ | **新規実装** |
| **動的キーワード抽出** | ❌ | ✅ | **新規実装** |
| **タイトル救済検索** | ❌ | ✅ | **新規実装** |
| **会話履歴管理** | ❌（未確認） | ✅ | **確認・修正** |

### 非機能目標

- **デグレード防止**: Confluence機能への影響ゼロ
- **段階的実装**: 開発環境で検証後、本番環境へ展開
- **品質保証**: 各フェーズで品質テストを実施

---

## 📊 現状分析

### Confluenceで実装済みの機能

1. **ベクトル検索** (5%)
   - ✅ Jiraでも実装済み

2. **BM25検索** (50% - 最優先)
   - ✅ Jiraでも実装済み

3. **タイトル救済検索** (25%)
   - ❌ Jiraでは未実装
   - 実装場所: `src/lib/lancedb-search-client.ts` (448-599行目)
   - 機能: キーワードからタイトル候補を自動生成し、LIKE検索で救済

4. **ラベルスコア** (15%)
   - ❌ Jiraでは未実装
   - 実装場所: `src/lib/composite-scoring-service.ts` (438-592行目)
   - 機能: StructuredLabelによる分類とスコアリング

5. **動的キーワード抽出**
   - ❌ Jiraでは未実装
   - 実装場所: `src/lib/unified-keyword-extraction-service.ts`
   - 機能: ドメイン知識データベースから関連キーワードを抽出

6. **早期ラベルフィルタリング**
   - ❌ Jiraでは未実装
   - 実装場所: `src/lib/lancedb-search-client.ts` (1426-1432行目)
   - 機能: 議事録、アーカイブ等の早期除外

7. **会話履歴管理**
   - ✅ 実装済み（`src/lib/conversation-service.ts`）
   - ⚠️ Jiraでも動作するか確認が必要

### Jira特有の課題

1. **検索性能**: 100-300ms（Confluence: 7-23ms）
   - 原因: タイトル救済検索、動的キーワード抽出の未実装
   - 対策: 上記機能の実装により改善

2. **結果補完処理**: Jira特有の処理があるため、Confluence機能の適用時に注意が必要
   - 実装場所: `src/lib/hybrid-search-engine.ts` (139-147行目、242-250行目)

---

## 🚀 実装計画

### Phase 1: タイトル救済検索の実装（開発環境）

**目標**: Jira検索にタイトル救済検索を追加し、検索精度を向上

**実装内容**:
1. `src/lib/lancedb-search-client.ts`の`searchLanceDB`関数を確認
2. `tableName === 'jira_issues'`の場合にタイトル救済検索を有効化
3. Jiraテーブル用のタイトル検索ロジックを実装
   - Issue Key（`id`フィールド）での検索に対応
   - タイトル（`title`フィールド）でのLIKE検索

**実装箇所**:
- `src/lib/lancedb-search-client.ts`: 448-599行目付近
- `generateTitleCandidates`関数のJira対応

**テスト項目**:
- [ ] タイトル救済検索がJiraテーブルで動作することを確認
- [ ] Confluenceテーブルへの影響がないことを確認
- [ ] 検索結果の精度が向上することを確認

**リスク**:
- 低: 既存のConfluence機能への影響は最小限（`tableName`で分岐）

**期間**: 1-2日

---

### Phase 2: 動的キーワード抽出の実装（開発環境）

**目標**: Jira検索に動的キーワード抽出を追加し、検索精度を向上

**実装内容**:
1. `src/lib/unified-keyword-extraction-service.ts`を確認
2. Jiraテーブルでも動的キーワード抽出を有効化
3. Jira特有のキーワード（Issue Key、ステータス、優先度等）の抽出に対応

**実装箇所**:
- `src/lib/lancedb-search-client.ts`: 247-257行目付近
- `unifiedKeywordExtractionService.extractKeywordsConfigured`の呼び出し

**テスト項目**:
- [ ] 動的キーワード抽出がJiraテーブルで動作することを確認
- [ ] Confluenceテーブルへの影響がないことを確認
- [ ] Jira特有のキーワードが適切に抽出されることを確認

**リスク**:
- 低: 既存のConfluence機能への影響は最小限（共通サービスを使用）

**期間**: 1-2日

---

### Phase 3: ラベルフィルタリングの実装（開発環境）

**目標**: Jira検索に早期ラベルフィルタリングを追加し、検索精度を向上

**実装内容**:
1. `src/lib/lancedb-search-client.ts`のラベルフィルタリングロジックを確認
2. Jiraテーブルでもラベルフィルタリングを有効化
3. Jira特有のラベル（ステータス、優先度等）のフィルタリングに対応

**実装箇所**:
- `src/lib/lancedb-search-client.ts`: 1426-1432行目付近（ベクトル検索）
- `src/lib/lancedb-search-client.ts`: 707-717行目付近（BM25検索）
- `src/lib/label-manager.ts`: ラベル管理ロジック

**テスト項目**:
- [ ] ラベルフィルタリングがJiraテーブルで動作することを確認
- [ ] Confluenceテーブルへの影響がないことを確認
- [ ] Jira特有のラベルが適切にフィルタリングされることを確認

**リスク**:
- 中: ラベルフィルタリングのロジックが複雑なため、慎重な実装が必要

**期間**: 2-3日

---

### Phase 4: 検索性能最適化（開発環境）

**目標**: Jira検索の性能を7-23msに改善

**実装内容**:
1. パフォーマンスプロファイリングを実施
2. ボトルネックを特定
3. 最適化を実施
   - 不要な処理の削除
   - 並列処理の最適化
   - キャッシュの活用

**実装箇所**:
- `src/lib/lancedb-search-client.ts`: 全体的な最適化
- `src/lib/hybrid-search-engine.ts`: 並列処理の最適化

**テスト項目**:
- [ ] 検索性能が7-23msに改善することを確認
- [ ] Confluenceテーブルへの影響がないことを確認
- [ ] 検索結果の精度が維持されることを確認

**リスク**:
- 中: パフォーマンス最適化は品質への影響を慎重に確認する必要がある

**期間**: 3-5日

---

### Phase 5: 会話履歴管理の確認・修正（開発環境）

**目標**: Jira検索でも会話履歴管理が正常に動作することを確認・修正

**実装内容**:
1. `src/lib/conversation-service.ts`を確認
2. Jira検索結果でも会話履歴が保存されることを確認
3. 必要に応じて修正

**実装箇所**:
- `src/lib/conversation-service.ts`: 会話履歴の保存ロジック
- `src/components/chat-page.tsx`: UI側の会話履歴表示

**テスト項目**:
- [ ] Jira検索結果でも会話履歴が保存されることを確認
- [ ] 会話履歴からJira検索結果を再表示できることを確認
- [ ] Confluence検索への影響がないことを確認

**リスク**:
- 低: 既存の実装を確認・修正するだけ

**期間**: 1-2日

---

### Phase 6: 開発環境での統合テストと品質検証

**目標**: 全機能の統合テストを実施し、品質を検証

**実装内容**:
1. 統合テストの実施
2. 品質テストの実施
3. パフォーマンステストの実施
4. バグ修正

**テスト項目**:
- [ ] 全機能が正常に動作することを確認
- [ ] Confluence機能への影響がないことを確認
- [ ] 検索性能が目標を達成することを確認
- [ ] 検索精度が向上することを確認

**リスク**:
- 中: 統合テストで予期しない問題が発見される可能性

**期間**: 3-5日

---

### Phase 7: 本番環境への段階的デプロイとモニタリング

**目標**: 本番環境に安全にデプロイし、モニタリングを実施

**実装内容**:
1. ステージング環境での最終確認
2. 本番環境への段階的デプロイ
   - Phase 1-2: タイトル救済検索、動的キーワード抽出
   - Phase 3: ラベルフィルタリング
   - Phase 4: 検索性能最適化
   - Phase 5: 会話履歴管理
3. モニタリングとロールバック準備

**デプロイ手順**:
1. ステージング環境で全機能をテスト
2. 本番環境にPhase 1-2をデプロイ
3. 24時間モニタリング
4. 問題がなければPhase 3をデプロイ
5. 同様にPhase 4-5をデプロイ

**モニタリング項目**:
- 検索性能（平均検索時間）
- 検索精度（ユーザーフィードバック）
- エラー率
- メモリ使用量

**リスク**:
- 高: 本番環境への影響を最小限に抑える必要がある

**期間**: 5-7日（段階的デプロイ）

---

## 🔒 デグレード防止策

### 1. コードレビュー

- すべての変更をコードレビューで確認
- Confluence機能への影響を重点的に確認

### 2. テスト

- 各フェーズで単体テストを実施
- Confluence機能の回帰テストを実施
- 統合テストで全体の動作を確認

### 3. 段階的実装

- 一度にすべてを実装せず、段階的に実装
- 各フェーズで品質を確認してから次へ進む

### 4. モニタリング

- 開発環境で十分にテスト
- 本番環境では段階的にデプロイ
- モニタリングで問題を早期発見

### 5. ロールバック準備

- 各フェーズでロールバック手順を準備
- 問題発生時は即座にロールバック可能にする

---

## 📈 成功指標

### 検索性能

- **目標**: 平均検索時間 7-23ms
- **測定方法**: ログから平均検索時間を算出
- **評価基準**: 100回の検索で平均が23ms以下

### 検索精度

- **目標**: Confluenceと同等の検索精度
- **測定方法**: 品質テストで検証
- **評価基準**: 品質テストでConfluenceと同等のスコア

### 機能完成度

- **目標**: Confluenceと同等の機能
- **測定方法**: 機能チェックリストで確認
- **評価基準**: すべての機能が実装済み

---

## 📝 実装チェックリスト

### Phase 1: タイトル救済検索

- [ ] `searchLanceDB`関数で`tableName === 'jira_issues'`の場合にタイトル救済検索を有効化
- [ ] `generateTitleCandidates`関数がJiraテーブルで動作することを確認
- [ ] タイトル検索結果が適切にマージされることを確認
- [ ] Confluenceテーブルへの影響がないことを確認

### Phase 2: 動的キーワード抽出

- [ ] `unifiedKeywordExtractionService`がJiraテーブルで動作することを確認
- [ ] Jira特有のキーワードが適切に抽出されることを確認
- [ ] Confluenceテーブルへの影響がないことを確認

### Phase 3: ラベルフィルタリング

- [ ] ベクトル検索でラベルフィルタリングが動作することを確認
- [ ] BM25検索でラベルフィルタリングが動作することを確認
- [ ] Jira特有のラベルが適切にフィルタリングされることを確認
- [ ] Confluenceテーブルへの影響がないことを確認

### Phase 4: 検索性能最適化

- [ ] パフォーマンスプロファイリングを実施
- [ ] ボトルネックを特定
- [ ] 最適化を実施
- [ ] 検索性能が7-23msに改善することを確認

### Phase 5: 会話履歴管理

- [ ] Jira検索結果でも会話履歴が保存されることを確認
- [ ] 会話履歴からJira検索結果を再表示できることを確認
- [ ] Confluence検索への影響がないことを確認

### Phase 6: 統合テスト

- [ ] 全機能が正常に動作することを確認
- [ ] Confluence機能への影響がないことを確認
- [ ] 検索性能が目標を達成することを確認
- [ ] 検索精度が向上することを確認

### Phase 7: 本番デプロイ

- [ ] ステージング環境で全機能をテスト
- [ ] 本番環境にPhase 1-2をデプロイ
- [ ] 24時間モニタリング
- [ ] 問題がなければPhase 3-5をデプロイ

---

## 🔗 関連ドキュメント

- [Confluence検索システム仕様](./02.02-confluence-spec.md)
- [Jira検索システム仕様](./02.03-jira-spec.md)
- [Confluence / Jira 仕様比較](./02.04-confluence-jira-comparison.md)
- [ハイブリッド検索システム仕様](../01-architecture/02.01.02-hybrid-search-specification.md)
- [データ同期戦略](../04-operations/04.03-data-synchronization-strategy.md)

---

## 📅 スケジュール

| Phase | 期間 | 開始日 | 終了日 | ステータス |
|-------|------|--------|--------|----------|
| Phase 1 | 1-2日 | TBD | TBD | 📋 未開始 |
| Phase 2 | 1-2日 | TBD | TBD | 📋 未開始 |
| Phase 3 | 2-3日 | TBD | TBD | 📋 未開始 |
| Phase 4 | 3-5日 | TBD | TBD | 📋 未開始 |
| Phase 5 | 1-2日 | TBD | TBD | 📋 未開始 |
| Phase 6 | 3-5日 | TBD | TBD | 📋 未開始 |
| Phase 7 | 5-7日 | TBD | TBD | 📋 未開始 |

**合計期間**: 約3-4週間（開発環境: 約2週間、本番環境: 約1-2週間）

---

**最終更新**: 2025年1月  
**作成者**: AI Assistant  
**レビュー**: 未実施

