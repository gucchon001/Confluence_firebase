# 検索システムの取得件数分析

## 現在の取得件数設定

### 1. ベクトル検索
- **設定**: `topK * 30`
- **例**: topK=20 → **600件**
- **問題**: 多すぎる可能性が高い

### 2. BM25検索
- **設定**: `kwCap = Math.max(200, Math.floor(topK * 3))`
- **例**: topK=20 → **200件/キーワード**
- **キーワード数**: 最大5キーワード
- **合計**: 最大 **1000件** (200 × 5)
- **問題**: 多すぎる可能性が高い

### 3. タイトル検索
- **設定**: 候補ごとに最大20件、最大10候補
- **合計**: 最大 **200件**
- **問題**: やや多い可能性

### 4. KG拡張後のベクトル
- **設定**: `topK * 5`
- **例**: topK=20 → **100件**
- **問題**: 適切

### 5. Composite Scoring対象
- **設定**: 上位100件
- **問題**: 適切

### 6. 最終返却
- **設定**: `topK * 3`
- **例**: topK=20 → **60件**
- **問題**: 適切

## 最適化案

### 案1: ベクトル検索の取得件数を削減
- **現在**: `topK * 30` (600件)
- **提案**: `topK * 10` (200件)
- **理由**: 近似検索の誤差を考慮しても、30倍は過剰

### 案2: BM25検索の取得件数を削減
- **現在**: `Math.max(200, Math.floor(topK * 3))` (200件/キーワード)
- **提案**: `Math.max(100, Math.floor(topK * 2))` (100件/キーワード)
- **理由**: 200件/キーワードは過剰、100件で十分

### 案3: タイトル検索の取得件数を削減
- **現在**: 候補ごとに最大20件
- **提案**: 候補ごとに最大10件
- **理由**: タイトル検索は救済的な役割なので、10件で十分

## 期待される効果

- **パフォーマンス向上**: 取得件数削減により、検索時間が短縮
- **メモリ使用量削減**: 処理するデータ量が減る
- **精度への影響**: 最小限（上位結果は保持される）

