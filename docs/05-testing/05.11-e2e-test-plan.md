# E2Eテスト計画書

## 📋 概要

このドキュメントでは、Confluence Spec-Finderシステムの包括的なE2Eテスト計画を定義します。ユーザーフローを網羅的にテストし、システムの品質を保証します。

## 🎯 テスト目標

1. **ユーザーフローの完全なカバレッジ**: 主要なユーザー操作パスをすべてテスト
2. **エッジケースの検証**: 異常系や境界値のテスト
3. **クロスブラウザ対応**: 主要ブラウザでの動作確認
4. **パフォーマンス検証**: 実際のユーザー体験に近い環境での性能テスト
5. **回帰テスト**: 既知の問題の再発防止

## 📊 テストカバレッジマトリックス

### 機能領域別カバレッジ

| 機能領域 | テストケース数 | 優先度 | ステータス |
|---------|--------------|--------|----------|
| 認証・認可 | 8 | 高 | ⏳ 実装中 |
| チャット機能 | 15 | 高 | ⏳ 実装中 |
| 検索機能 | 12 | 高 | ⏳ 実装中 |
| 会話履歴 | 6 | 中 | ⏳ 実装中 |
| 深掘り質問 | 5 | 中 | ⏳ 実装中 |
| エラーハンドリング | 10 | 高 | ✅ 一部実装済み |
| UI/UX | 8 | 中 | ⏳ 実装中 |
| パフォーマンス | 5 | 中 | ⏳ 実装中 |
| **合計** | **69** | - | - |

## 🔍 テストケース詳細

### 1. 認証・認可フロー

#### 1.1 ログインフロー

**テストケース ID**: E2E-AUTH-001  
**優先度**: 高  
**前提条件**: 未ログイン状態

**ステップ**:
1. アプリケーションにアクセス
2. ログイン画面が表示されることを確認
3. "Sign in with Google"ボタンが表示されることを確認
4. ボタンをクリック
5. Google認証画面が表示されることを確認（またはモック認証が実行される）
6. 認証成功後、チャット画面にリダイレクトされることを確認

**期待結果**:
- ログイン画面が正しく表示される
- 認証後、チャット画面に遷移する
- ユーザー情報が正しく表示される

---

**テストケース ID**: E2E-AUTH-002  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. ログイン済み状態でアプリケーションにアクセス
2. チャット画面が直接表示されることを確認
3. ログイン画面にリダイレクトされないことを確認

**期待結果**:
- ログイン画面をスキップしてチャット画面が表示される

---

**テストケース ID**: E2E-AUTH-003  
**優先度**: 高  
**前提条件**: 未ログイン状態

**ステップ**:
1. ログイン画面で認証を試みる
2. 認証が拒否される（ドメイン制限など）
3. エラーメッセージが表示されることを確認

**期待結果**:
- 適切なエラーメッセージが表示される
- ログイン画面に留まる

---

**テストケース ID**: E2E-AUTH-004  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. ログイン済み状態でアプリケーションを使用
2. セッションが期限切れになる（または認証エラーをシミュレート）
3. 自動的にログイン画面にリダイレクトされることを確認

**期待結果**:
- セッション切れ時に適切にリダイレクトされる
- エラーメッセージが表示される

---

**テストケース ID**: E2E-AUTH-005  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. ログアウトボタンをクリック（存在する場合）
2. ログアウトが実行されることを確認
3. ログイン画面にリダイレクトされることを確認

**期待結果**:
- 正常にログアウトできる
- ログイン画面に遷移する

---

**テストケース ID**: E2E-AUTH-006  
**優先度**: 低  
**前提条件**: 未ログイン状態

**ステップ**:
1. ログイン画面で認証を試みる
2. ネットワークエラーをシミュレート
3. エラーハンドリングが適切に動作することを確認

**期待結果**:
- ネットワークエラー時に適切なメッセージが表示される
- リトライオプションが提供される（存在する場合）

---

**テストケース ID**: E2E-AUTH-007  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. 複数のタブでアプリケーションを開く
2. 1つのタブでログアウト
3. 他のタブでもログアウト状態になることを確認

**期待結果**:
- タブ間で認証状態が同期される

---

**テストケース ID**: E2E-AUTH-008  
**優先度**: 低  
**前提条件**: 未ログイン状態

**ステップ**:
1. ログイン画面で認証を試みる
2. 認証プロセス中にページをリロード
3. 認証状態が正しく維持されることを確認

**期待結果**:
- リロード後も認証状態が維持される

---

### 2. チャット機能フロー

#### 2.1 基本的な質問・回答フロー

**テストケース ID**: E2E-CHAT-001  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問入力欄が表示されることを確認
3. 質問を入力（例: "退会した会員が再度登録することは可能ですか"）
4. 送信ボタンをクリック
5. ローディングインジケータが表示されることを確認
6. 回答がストリーミングで表示されることを確認
7. 回答が完全に表示されることを確認
8. 参照元リンクが表示されることを確認

**期待結果**:
- 質問が正しく送信される
- 回答がストリーミングで表示される
- 参照元リンクが正しく表示される

---

**テストケース ID**: E2E-CHAT-002  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 空の質問を送信しようとする
3. バリデーションメッセージが表示されることを確認

**期待結果**:
- 空の質問は送信できない
- 適切なバリデーションメッセージが表示される

---

**テストケース ID**: E2E-CHAT-003  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 非常に長い質問を入力（1000文字以上）
3. 送信ボタンをクリック
4. 質問が正しく処理されることを確認

**期待結果**:
- 長い質問も正しく処理される
- エラーが発生しない

---

**テストケース ID**: E2E-CHAT-004  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 特殊文字を含む質問を入力（例: "「退会」機能について教えてください"）
3. 送信ボタンをクリック
4. 質問が正しく処理されることを確認

**期待結果**:
- 特殊文字が正しく処理される
- エンコーディングエラーが発生しない

---

**テストケース ID**: E2E-CHAT-005  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される前に別の質問を送信
4. 前の回答がキャンセルされ、新しい質問が処理されることを確認

**期待結果**:
- 複数の質問を連続して送信できる
- 前の処理が適切にキャンセルされる

---

**テストケース ID**: E2E-CHAT-006  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答がストリーミング中にページをスクロール
4. スクロール位置が適切に維持されることを確認

**期待結果**:
- ストリーミング中もスクロールが正常に動作する
- UIがフリーズしない

---

**テストケース ID**: E2E-CHAT-007  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答の参照元リンクをクリック
4. 新しいタブで参照元ページが開くことを確認

**期待結果**:
- 参照元リンクが正しく機能する
- 新しいタブで開く

---

**テストケース ID**: E2E-CHAT-008  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 複数の質問を連続して送信
3. 会話履歴が正しく表示されることを確認
4. 各質問と回答のペアが正しく表示されることを確認

**期待結果**:
- 会話履歴が正しく表示される
- 質問と回答のペアが正しく関連付けられる

---

**テストケース ID**: E2E-CHAT-009  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答がマークダウン形式で正しく表示されることを確認
4. テーブル、リスト、コードブロックなどが正しくレンダリングされることを確認

**期待結果**:
- マークダウンが正しくレンダリングされる
- すべてのマークダウン要素が正しく表示される

---

**テストケース ID**: E2E-CHAT-010  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答をコピーする（存在する場合）
4. コピーが正しく機能することを確認

**期待結果**:
- 回答をコピーできる
- コピーした内容が正しい

---

**テストケース ID**: E2E-CHAT-011  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 回答の評価ボタン（存在する場合）をクリック
5. 評価が正しく保存されることを確認

**期待結果**:
- 回答を評価できる
- 評価が正しく保存される

---

**テストケース ID**: E2E-CHAT-012  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. ConfluenceタブとJiraタブを切り替える
3. 各タブで質問を送信
4. 正しいソース（ConfluenceまたはJira）から検索されることを確認

**期待結果**:
- タブ切り替えが正しく機能する
- 各ソースから正しく検索される

---

**テストケース ID**: E2E-CHAT-013  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 関連ページセクションが表示されることを確認
5. 関連ページをクリック
6. 関連ページの詳細が表示されることを確認

**期待結果**:
- 関連ページが正しく表示される
- 関連ページをクリックできる

---

**テストケース ID**: E2E-CHAT-014  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 回答のタイトルが正しく表示されることを確認
5. 回答の内容が正しく表示されることを確認

**期待結果**:
- 回答のタイトルと内容が正しく表示される

---

**テストケース ID**: E2E-CHAT-015  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 回答を削除する（存在する場合）
5. 回答が削除されることを確認

**期待結果**:
- 回答を削除できる
- 削除後、会話履歴からも削除される

---

### 3. 検索機能フロー

#### 3.1 Confluence検索

**テストケース ID**: E2E-SEARCH-001  
**優先度**: 高  
**前提条件**: ログイン済み状態、Confluenceタブ選択

**ステップ**:
1. チャット画面にアクセス
2. Confluenceタブが選択されていることを確認
3. 質問を入力（例: "教室削除機能について"）
4. 送信ボタンをクリック
5. Confluenceページから検索結果が返されることを確認
6. 検索結果が関連性の高い順に表示されることを確認

**期待結果**:
- Confluenceから正しく検索される
- 検索結果が関連性順に表示される

---

**テストケース ID**: E2E-SEARCH-002  
**優先度**: 高  
**前提条件**: ログイン済み状態、Jiraタブ選択

**ステップ**:
1. チャット画面にアクセス
2. Jiraタブを選択
3. 質問を入力（例: "バグ修正の進捗状況"）
4. 送信ボタンをクリック
5. Jira課題から検索結果が返されることを確認
6. Jira特有のフィールド（ステータス、優先度など）が表示されることを確認

**期待結果**:
- Jiraから正しく検索される
- Jira特有のフィールドが正しく表示される

---

**テストケース ID**: E2E-SEARCH-003  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 存在しない内容について質問を入力（例: "存在しない機能について"）
3. 送信ボタンをクリック
4. 適切なメッセージが表示されることを確認（例: "関連する情報が見つかりませんでした"）

**期待結果**:
- 検索結果がない場合、適切なメッセージが表示される

---

**テストケース ID**: E2E-SEARCH-004  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 曖昧な質問を入力（例: "機能"）
3. 送信ボタンをクリック
4. 複数の検索結果が返されることを確認
5. 検索結果が関連性順に表示されることを確認

**期待結果**:
- 曖昧な質問でも検索結果が返される
- 検索結果が関連性順に表示される

---

**テストケース ID**: E2E-SEARCH-005  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 英語の質問を入力（例: "How to delete classroom?"）
3. 送信ボタンをクリック
4. 英語の質問でも正しく検索されることを確認

**期待結果**:
- 英語の質問でも正しく検索される

---

**テストケース ID**: E2E-SEARCH-006  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 日本語と英語が混在した質問を入力（例: "教室削除のdelete機能について"）
3. 送信ボタンをクリック
4. 混在した質問でも正しく検索されることを確認

**期待結果**:
- 混在した質問でも正しく検索される

---

**テストケース ID**: E2E-SEARCH-007  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 特定のページIDに関連する質問を入力（例: "退会した会員が再度登録することは可能ですか"）
3. 送信ボタンをクリック
4. 期待されるページ（pageId=703594590など）が検索結果に含まれることを確認
5. 期待されるページが上位に表示されることを確認

**期待結果**:
- 特定のページが正しく検索される
- 関連性の高いページが上位に表示される

---

**テストケース ID**: E2E-SEARCH-008  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 同じ質問を複数回送信
3. 検索結果の一貫性を確認

**期待結果**:
- 同じ質問に対して一貫した検索結果が返される

---

**テストケース ID**: E2E-SEARCH-009  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 検索結果のスコアリングを確認
3. ラベルマッチングが正しく機能していることを確認

**期待結果**:
- 検索結果が適切にスコアリングされる
- ラベルマッチングが正しく機能する

---

**テストケース ID**: E2E-SEARCH-010  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 検索結果のフィルタリング機能（存在する場合）をテスト
3. フィルタリングが正しく機能することを確認

**期待結果**:
- フィルタリングが正しく機能する

---

**テストケース ID**: E2E-SEARCH-011  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 検索結果のページネーション（存在する場合）をテスト
3. ページネーションが正しく機能することを確認

**期待結果**:
- ページネーションが正しく機能する

---

**テストケース ID**: E2E-SEARCH-012  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 検索結果のソート機能（存在する場合）をテスト
3. ソートが正しく機能することを確認

**期待結果**:
- ソートが正しく機能する

---

### 4. 会話履歴フロー

#### 4.1 会話履歴の表示

**テストケース ID**: E2E-HISTORY-001  
**優先度**: 高  
**前提条件**: ログイン済み状態、会話履歴が存在

**ステップ**:
1. チャット画面にアクセス
2. 会話履歴セクションが表示されることを確認
3. 過去の会話が一覧で表示されることを確認
4. 会話のタイトルが正しく表示されることを確認

**期待結果**:
- 会話履歴が正しく表示される
- 会話のタイトルが正しく表示される

---

**テストケース ID**: E2E-HISTORY-002  
**優先度**: 高  
**前提条件**: ログイン済み状態、会話履歴が存在

**ステップ**:
1. チャット画面にアクセス
2. 会話履歴から会話を選択
3. 選択した会話の内容が表示されることを確認
4. 質問と回答のペアが正しく表示されることを確認

**期待結果**:
- 会話を選択できる
- 会話の内容が正しく表示される

---

**テストケース ID**: E2E-HISTORY-003  
**優先度**: 中  
**前提条件**: ログイン済み状態、会話履歴が存在

**ステップ**:
1. チャット画面にアクセス
2. 会話履歴から会話を削除（存在する場合）
3. 会話が削除されることを確認
4. 会話履歴からも削除されることを確認

**期待結果**:
- 会話を削除できる
- 削除後、会話履歴からも削除される

---

**テストケース ID**: E2E-HISTORY-004  
**優先度**: 中  
**前提条件**: ログイン済み状態、会話履歴が存在

**ステップ**:
1. チャット画面にアクセス
2. 会話履歴を検索（存在する場合）
3. 検索が正しく機能することを確認

**期待結果**:
- 会話履歴を検索できる
- 検索結果が正しく表示される

---

**テストケース ID**: E2E-HISTORY-005  
**優先度**: 中  
**前提条件**: ログイン済み状態、会話履歴が存在

**ステップ**:
1. チャット画面にアクセス
2. 会話履歴をソート（存在する場合）
3. ソートが正しく機能することを確認

**期待結果**:
- 会話履歴をソートできる
- ソート結果が正しく表示される

---

**テストケース ID**: E2E-HISTORY-006  
**優先度**: 低  
**前提条件**: ログイン済み状態、会話履歴が存在

**ステップ**:
1. チャット画面にアクセス
2. 会話履歴をエクスポート（存在する場合）
3. エクスポートが正しく機能することを確認

**期待結果**:
- 会話履歴をエクスポートできる
- エクスポートした内容が正しい

---

### 5. 深掘り質問フロー

#### 5.1 フォローアップ質問

**テストケース ID**: E2E-FOLLOWUP-001  
**優先度**: 高  
**前提条件**: ログイン済み状態、質問と回答が存在

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. フォローアップ質問を入力
5. フォローアップ質問が前の会話の文脈を理解していることを確認

**期待結果**:
- フォローアップ質問が正しく処理される
- 前の会話の文脈が維持される

---

**テストケース ID**: E2E-FOLLOWUP-002  
**優先度**: 中  
**前提条件**: ログイン済み状態、質問と回答が存在

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 複数のフォローアップ質問を連続して送信
5. 各質問が前の会話の文脈を理解していることを確認

**期待結果**:
- 複数のフォローアップ質問が正しく処理される
- 会話の文脈が維持される

---

**テストケース ID**: E2E-FOLLOWUP-003  
**優先度**: 中  
**前提条件**: ログイン済み状態、質問と回答が存在

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 提案されたフォローアップ質問（存在する場合）をクリック
5. 提案された質問が正しく送信されることを確認

**期待結果**:
- 提案されたフォローアップ質問をクリックできる
- 質問が正しく送信される

---

**テストケース ID**: E2E-FOLLOWUP-004  
**優先度**: 低  
**前提条件**: ログイン済み状態、質問と回答が存在

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 会話の文脈をクリア（存在する場合）
5. 新しい質問が前の会話の文脈を参照しないことを確認

**期待結果**:
- 会話の文脈をクリアできる
- 新しい質問が前の会話の文脈を参照しない

---

**テストケース ID**: E2E-FOLLOWUP-005  
**優先度**: 中  
**前提条件**: ログイン済み状態、質問と回答が存在

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が表示される
4. 会話履歴から別の会話を選択
5. 新しい質問が選択した会話の文脈を参照することを確認

**期待結果**:
- 会話履歴から会話を選択できる
- 選択した会話の文脈が維持される

---

### 6. エラーハンドリングフロー

#### 6.1 APIエラー

**テストケース ID**: E2E-ERROR-001  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. APIエラーをシミュレート
4. 適切なエラーメッセージが表示されることを確認
5. リトライオプションが提供されることを確認（存在する場合）

**期待結果**:
- エラーメッセージが適切に表示される
- リトライオプションが提供される

---

**テストケース ID**: E2E-ERROR-002  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. ネットワークエラーをシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- ネットワークエラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-003  
**優先度**: 高  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. タイムアウトエラーをシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- タイムアウトエラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-004  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. サーバーエラー（500）をシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- サーバーエラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-005  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 認証エラー（401）をシミュレート
4. ログイン画面にリダイレクトされることを確認

**期待結果**:
- 認証エラー時にログイン画面にリダイレクトされる

---

**テストケース ID**: E2E-ERROR-006  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 権限エラー（403）をシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- 権限エラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-007  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. レート制限エラー（429）をシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- レート制限エラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-008  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 不正なリクエストエラー（400）をシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- 不正なリクエストエラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-009  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 予期しないエラーをシミュレート
4. 適切なエラーメッセージが表示されることを確認

**期待結果**:
- 予期しないエラー時に適切なメッセージが表示される

---

**テストケース ID**: E2E-ERROR-010  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. エラーが発生した後、リトライボタンをクリック（存在する場合）
4. リトライが正しく機能することを確認

**期待結果**:
- リトライが正しく機能する

---

### 7. UI/UXフロー

#### 7.1 レスポンシブデザイン

**テストケース ID**: E2E-UI-001  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. モバイルサイズ（375px）で表示
3. UIが正しく表示されることを確認
4. すべての機能が使用可能であることを確認

**期待結果**:
- モバイルサイズでUIが正しく表示される
- すべての機能が使用可能である

---

**テストケース ID**: E2E-UI-002  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. タブレットサイズ（768px）で表示
3. UIが正しく表示されることを確認
4. すべての機能が使用可能であることを確認

**期待結果**:
- タブレットサイズでUIが正しく表示される
- すべての機能が使用可能である

---

**テストケース ID**: E2E-UI-003  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. デスクトップサイズ（1920px）で表示
3. UIが正しく表示されることを確認
4. すべての機能が使用可能であることを確認

**期待結果**:
- デスクトップサイズでUIが正しく表示される
- すべての機能が使用可能である

---

**テストケース ID**: E2E-UI-004  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. ダークモード（存在する場合）を有効化
3. UIが正しく表示されることを確認

**期待結果**:
- ダークモードでUIが正しく表示される

---

**テストケース ID**: E2E-UI-005  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. キーボードナビゲーションで操作
3. すべての機能がキーボードで操作可能であることを確認

**期待結果**:
- キーボードナビゲーションが正しく機能する
- すべての機能がキーボードで操作可能である

---

**テストケース ID**: E2E-UI-006  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. スクリーンリーダー（存在する場合）で操作
3. すべての機能がアクセシブルであることを確認

**期待結果**:
- スクリーンリーダーで正しく操作できる
- すべての機能がアクセシブルである

---

**テストケース ID**: E2E-UI-007  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. ローディング状態が正しく表示されることを確認
3. エラー状態が正しく表示されることを確認
4. 成功状態が正しく表示されることを確認

**期待結果**:
- すべての状態が正しく表示される

---

**テストケース ID**: E2E-UI-008  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. アニメーション（存在する場合）が正しく動作することを確認
3. トランジション（存在する場合）が正しく動作することを確認

**期待結果**:
- アニメーションとトランジションが正しく動作する

---

### 8. パフォーマンスフロー

#### 8.1 パフォーマンステスト

**テストケース ID**: E2E-PERF-001  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. ページの読み込み時間を測定
3. 読み込み時間が3秒以内であることを確認

**期待結果**:
- ページの読み込み時間が3秒以内である

---

**テストケース ID**: E2E-PERF-002  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 最初のチャンクが表示されるまでの時間を測定
4. 最初のチャンクが5秒以内に表示されることを確認

**期待結果**:
- 最初のチャンクが5秒以内に表示される

---

**テストケース ID**: E2E-PERF-003  
**優先度**: 中  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 質問を送信
3. 回答が完全に表示されるまでの時間を測定
4. 回答が30秒以内に完全に表示されることを確認

**期待結果**:
- 回答が30秒以内に完全に表示される

---

**テストケース ID**: E2E-PERF-004  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. 大量の会話履歴を読み込む
3. 会話履歴の読み込み時間を測定
4. 会話履歴が5秒以内に読み込まれることを確認

**期待結果**:
- 会話履歴が5秒以内に読み込まれる

---

**テストケース ID**: E2E-PERF-005  
**優先度**: 低  
**前提条件**: ログイン済み状態

**ステップ**:
1. チャット画面にアクセス
2. メモリ使用量を監視
3. 長時間使用してもメモリリークが発生しないことを確認

**期待結果**:
- メモリリークが発生しない

---

## 🚀 実装計画

### Phase 1: 基本フロー（優先度: 高）

1. **認証フロー** (E2E-AUTH-001 ～ 004)
2. **基本的なチャットフロー** (E2E-CHAT-001 ～ 002)
3. **検索フロー** (E2E-SEARCH-001 ～ 002, 007)
4. **エラーハンドリング** (E2E-ERROR-001 ～ 005)

**期間**: 2週間

### Phase 2: 拡張フロー（優先度: 中）

1. **会話履歴フロー** (E2E-HISTORY-001 ～ 003)
2. **深掘り質問フロー** (E2E-FOLLOWUP-001 ～ 002)
3. **UI/UXフロー** (E2E-UI-001 ～ 003, 005, 007)
4. **パフォーマンスフロー** (E2E-PERF-001 ～ 003)

**期間**: 2週間

### Phase 3: エッジケース（優先度: 低）

1. **エッジケースのテスト** (残りのテストケース)
2. **クロスブラウザテスト**
3. **回帰テスト**

**期間**: 1週間

## 📝 テスト実装ガイドライン

### テストファイル構造

```
src/tests/e2e/
├── auth/
│   ├── login.spec.ts (既存)
│   ├── logout.spec.ts (新規)
│   └── session-management.spec.ts (新規)
├── chat/
│   ├── chat.spec.ts (既存)
│   ├── chat-simple.spec.ts (既存)
│   ├── chat-advanced.spec.ts (新規)
│   └── chat-edge-cases.spec.ts (新規)
├── search/
│   ├── confluence-search.spec.ts (新規)
│   ├── jira-search.spec.ts (新規)
│   └── search-edge-cases.spec.ts (新規)
├── history/
│   └── conversation-history.spec.ts (既存、拡張)
├── followup/
│   └── follow-up-questions.spec.ts (既存、拡張)
├── error/
│   └── error-scenarios.spec.ts (既存、拡張)
├── ui/
│   ├── responsive.spec.ts (新規)
│   └── accessibility.spec.ts (新規)
├── performance/
│   └── performance.spec.ts (新規)
└── helpers.ts (既存、拡張)
```

### テスト実装のベストプラクティス

1. **Page Object Model (POM) パターンの使用**
   - 各ページの要素と操作をPage Objectクラスにまとめる
   - テストコードの可読性と保守性を向上

2. **ヘルパー関数の活用**
   - 共通の操作はヘルパー関数に抽出
   - モックデータの生成もヘルパー関数で管理

3. **テストデータの管理**
   - テストデータは別ファイルで管理
   - 環境ごとに異なるテストデータを使用可能に

4. **アサーションの明確化**
   - 各テストケースで期待結果を明確に定義
   - 適切なアサーションを使用

5. **エラーハンドリング**
   - テスト失敗時のデバッグ情報を充実
   - スクリーンショットとログを自動保存

## 🔧 実装例

### 新しいテストファイルのテンプレート

```typescript
import { test, expect } from '@playwright/test';
import { mockAuthState, mockChatService, mockRAGService } from '../helpers';

test.describe('テストスイート名', () => {
  test.beforeEach(async ({ page }) => {
    // セットアップ処理
    await mockAuthState(page, true);
    await mockChatService(page);
    await mockRAGService(page);
    await page.goto('/?mock=true');
  });

  test('テストケース名', async ({ page }) => {
    // テストステップ
    // 1. アクション
    // 2. アサーション
  });
});
```

## 📊 進捗管理

### テスト実装状況の追跡

- [ ] Phase 1: 基本フロー (0/15) - **保留中**
- [ ] Phase 2: 拡張フロー (0/20) - **保留中**
- [ ] Phase 3: エッジケース (0/34) - **保留中**

### テスト実行状況

**現状（2025年11月時点）:**
- 実装済み: 33件のテストケース
- 実行結果: 9件成功、23件失敗、1件スキップ
- 方針: **現状維持** - 失敗しているテストは修正せず、必要になったら再開

**実行ポリシー:**
- 通常時: E2Eテストは実行しない
- リリース前: 必要に応じて手動で実行
- 重大な問題発生時: 必要に応じて再開・修正

## 🎯 成功基準

1. **カバレッジ**: すべてのテストケースが実装されている
2. **成功率**: テストの成功率が95%以上
3. **実行時間**: すべてのテストが30分以内に完了
4. **安定性**: テストが安定して実行できる（フレーキーテストが5%以下）

## ⚠️ 現状の方針（2025年11月）

**E2Eテストは現状維持の方針を採用しています。**

### 理由
1. 既存のテストカバレッジが高い（データ検証、機能テスト、統合テスト、パフォーマンステスト）
2. E2Eテストの実装・保守コストが高い
3. 現在23件のテストが失敗しており、修正に時間がかかる見込み
4. プロジェクトの性質上、既存のテストで主要機能を十分にカバーしている

### 運用方針
- **通常時**: E2Eテストは実行しない
- **リリース前**: 必要に応じて手動で実行（オプション）
- **重大な問題発生時**: 必要に応じて再開・修正を検討
- **将来**: チーム拡大やプロジェクト規模拡大時に再評価

### 代替手段
- 既存の機能テスト（`npm run test:feature`）で主要機能を検証
- 手動テストでUI/UXを確認
- 統合テスト（`npm run test:integration`）でデータフローを検証

## 📚 関連ドキュメント

- [テスト実行ガイド](./05.08-test-execution-guide.md)
- [テストカバレッジ分析](./05.10-test-coverage-analysis.md)
- [Playwright公式ドキュメント](https://playwright.dev/)

