# APIã‚­ãƒ¼æ¼æ´©ã®æ ¹æœ¬åŸå› åˆ†æ

## ğŸš¨ æ¼æ´©ã®åŸå› 

APIã‚­ãƒ¼ãŒæ¼æ´©ã—ãŸä¸»ãªåŸå› ã¯ã€**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã«APIã‚­ãƒ¼ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãŸã“ã¨**ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã§ã‚ã‚Œã°èª°ã§ã‚‚è¦‹ã‚‹ã“ã¨ãŒã§ãã€GoogleãŒæ¤œå‡ºã—ã¦æ¼æ´©ã¨ã—ã¦å ±å‘Šã—ã¾ã—ãŸã€‚

## æ¼æ´©ç®‡æ‰€ã®è©³ç´°

### 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæœ€å„ªå…ˆã§ä¿®æ­£ãŒå¿…è¦ï¼‰

#### `docs/05-testing/05.20-update-gemini-api-key.md`
- **å•é¡Œ**: æ–°ã—ã„Gemini APIã‚­ãƒ¼ï¼ˆ`AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM`ï¼‰ãŒè¤‡æ•°ç®‡æ‰€ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸ
- **å½±éŸ¿**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã§ã‚ã‚Œã°èª°ã§ã‚‚è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹
- **ä¿®æ­£**: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆ`your-gemini-api-key`ï¼‰ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹

#### `docs/05-testing/05.25-gemini-api-key-reissue.md`
- **å•é¡Œ**: æ¼æ´©ã—ãŸAPIã‚­ãƒ¼ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ãŸï¼ˆä¾‹ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ãŸãŒã€å®Ÿéš›ã®ã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ãŸï¼‰
- **å½±éŸ¿**: åŒæ§˜ã«å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã§è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹
- **ä¿®æ­£**: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹

### 2. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### `scripts/test-gemini-api.js`
- **å•é¡Œ**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦APIã‚­ãƒ¼ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãŸ
  ```javascript
  const apiKey = process.env.GEMINI_API_KEY || 'AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM';
  ```
- **å½±éŸ¿**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹
- **ä¿®æ­£**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å‰Šé™¤ã—ã€ç’°å¢ƒå¤‰æ•°ãŒå¿…é ˆã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹

## ä¿®æ­£æ‰‹é †

### 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£

ã™ã¹ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’å‰Šé™¤ã—ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç½®ãæ›ãˆã¾ã™ã€‚

```markdown
# âŒ æ‚ªã„ä¾‹
GEMINI_API_KEY=AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM

# âœ… è‰¯ã„ä¾‹
GEMINI_API_KEY=your-gemini-api-key
```

### 2. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£

`scripts/test-gemini-api.js`ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```javascript
// âŒ æ‚ªã„ä¾‹
const apiKey = process.env.GEMINI_API_KEY || 'AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM';

// âœ… è‰¯ã„ä¾‹
const apiKey = process.env.GEMINI_API_KEY;
if (!apiKey) {
  console.error('âŒ ã‚¨ãƒ©ãƒ¼: GEMINI_API_KEYç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
  process.exit(1);
}
```

### 3. Gitå±¥æ­´ã‹ã‚‰ã®å‰Šé™¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

æ—¢ã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹APIã‚­ãƒ¼ã‚’Gitå±¥æ­´ã‹ã‚‰å®Œå…¨ã«å‰Šé™¤ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

**æ³¨æ„**: ã“ã®æ“ä½œã¯æ…é‡ã«è¡Œã£ã¦ãã ã•ã„ã€‚Gitå±¥æ­´ã‚’æ›¸ãæ›ãˆã‚‹ãŸã‚ã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚

```bash
# BFG Repo-Cleanerã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
# https://rtyley.github.io/bfg-repo-cleaner/

# ã¾ãŸã¯ git filter-branch ã‚’ä½¿ç”¨
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch docs/05-testing/05.20-update-gemini-api-key.md scripts/test-gemini-api.js" \
  --prune-empty --tag-name-filter cat -- --all
```

## ä»Šå¾Œã®å¯¾ç­–

### 1. ãƒ—ãƒ¬ã‚³ãƒŸãƒƒãƒˆãƒ•ãƒƒã‚¯ã®è¨­å®š

`.git/hooks/pre-commit`ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«APIã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

```bash
#!/bin/bash
# APIã‚­ãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
if git diff --cached --name-only | xargs grep -E "AIzaSy[A-Za-z0-9_-]{35}" 2>/dev/null; then
  echo "âŒ ã‚¨ãƒ©ãƒ¼: APIã‚­ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ã‚³ãƒŸãƒƒãƒˆã‚’ä¸­æ­¢ã—ã¾ã™ã€‚"
  exit 1
fi
```

### 2. GitHub Actionsã§ã®æ¤œè¨¼

`.github/workflows/security-check.yml`ã‚’ä½œæˆã—ã¦ã€ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«APIã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

```yaml
name: Security Check

on: [push, pull_request]

jobs:
  check-api-keys:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Check for API keys
        run: |
          if grep -r "AIzaSy[A-Za-z0-9_-]{35}" --include="*.md" --include="*.yaml" --include="*.ts" --include="*.js" .; then
            echo "âŒ ã‚¨ãƒ©ãƒ¼: APIã‚­ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
            exit 1
          fi
```

### 3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½¿ç”¨

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯å¸¸ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã€å®Ÿéš›ã®APIã‚­ãƒ¼ã¯è¨˜è¼‰ã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

### 4. ç’°å¢ƒå¤‰æ•°ã®ã¿ã§ç®¡ç†

APIã‚­ãƒ¼ã¯ä»¥ä¸‹ã®å ´æ‰€ã§ã®ã¿ç®¡ç†ã—ã€ãã‚Œä»¥å¤–ã®å ´æ‰€ã«ã¯è¨˜è¼‰ã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ï¼š

- âœ… `.env.local`ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„ï¼‰
- âœ… GitHub Secretsï¼ˆCI/CDç’°å¢ƒï¼‰
- âœ… Firebase Secret Managerï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- âŒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- âŒ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ï¼‰
- âŒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`apphosting.yaml`ãªã©ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã¿ï¼‰

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã™ã¹ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’å‰Šé™¤
- [ ] ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å‰Šé™¤
- [ ] ãƒ—ãƒ¬ã‚³ãƒŸãƒƒãƒˆãƒ•ãƒƒã‚¯ã‚’è¨­å®š
- [ ] GitHub Actionsã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
- [ ] ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«APIã‚­ãƒ¼ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å…±æœ‰

## å‚è€ƒãƒªãƒ³ã‚¯

- [Google AI Studio - API Keys](https://makersuite.google.com/app/apikey)
- [GitHub Secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Firebase Secret Manager](https://firebase.google.com/docs/app-hosting/manage-secrets)
- [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/)

