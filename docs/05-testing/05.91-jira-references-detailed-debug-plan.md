# Jiraæ¤œç´¢ - å‚ç…§å…ƒæŠ½å‡ºã®è©³ç´°ãƒ‡ãƒãƒƒã‚°è¨ˆç”»

**ä½œæˆæ—¥**: 2025-01-27  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ” ãƒ‡ãƒãƒƒã‚°ä¸­

---

## ğŸ“‹ è¿½åŠ ã—ãŸãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°

### 1. `extractUsedReferenceIndices`ã®çµæœ
```typescript
console.log(`[streaming-summarize] extractUsedReferenceIndicesçµæœ: ${usedIndices.size}ä»¶ (allReferences: ${allReferences.length}ä»¶)`);
```

### 2. `finalReferences`ï¼ˆextractUsedReferenceIndiceså¾Œï¼‰
```typescript
console.log(`[streaming-summarize] finalReferencesï¼ˆextractUsedReferenceIndiceså¾Œï¼‰: ${finalReferences.length}ä»¶`);
```

### 3. `finalReferenceIds`ã¨`enhancedReferences`ã®è©³ç´°æ¯”è¼ƒ
```typescript
console.log(`[streaming-summarize] finalReferenceIds: ${finalReferenceIds.size}ä»¶ (finalReferences: ${finalReferences.length}ä»¶, enhancedReferences: ${enhancedReferences.length}ä»¶)`);
console.log(`[streaming-summarize] finalReferenceIdsã®å†…å®¹ï¼ˆä¸Šä½5ä»¶ï¼‰: ${Array.from(finalReferenceIds).slice(0, 5).join(', ')}`);
console.log(`[streaming-summarize] enhancedReferencesã®IDï¼ˆä¸Šä½5ä»¶ï¼‰: ${enhancedReferences.slice(0, 5).map((r: any) => r.id || r.issue_key || r.title).join(', ')}`);
```

### 4. IDä¸ä¸€è‡´ã®è©³ç´°ãƒ­ã‚°
```typescript
if (!matched && enhancedReferences.indexOf(ref) < 3) {
  console.log(`[streaming-summarize] âš ï¸  IDä¸ä¸€è‡´: ref.id=${ref.id}, ref.issue_key=${ref.issue_key}, ref.title=${ref.title?.substring(0, 30)}`);
}
```

### 5. `enhancedFinalRefs`ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œï¼‰
```typescript
console.log(`[streaming-summarize] enhancedFinalRefsï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œï¼‰: ${enhancedFinalRefs.length}ä»¶`);
```

### 6. `finalReferences`ï¼ˆæœ€çµ‚ï¼‰
```typescript
console.log(`[streaming-summarize] finalReferencesï¼ˆæœ€çµ‚ï¼‰: ${finalReferences.length}ä»¶`);
```

---

## ğŸ” ç¢ºèªã™ã¹ããƒã‚¤ãƒ³ãƒˆ

### ã‚¹ãƒ†ãƒƒãƒ—1: æ¤œç´¢çµæœã®å–å¾—
- âœ… æ¤œç´¢çµæœãŒ30ä»¶å–å¾—ã§ãã¦ã„ã‚‹ã‹

### ã‚¹ãƒ†ãƒƒãƒ—2: allReferencesã®æº–å‚™
- âœ… allReferencesãŒ30ä»¶æº–å‚™ã§ãã¦ã„ã‚‹ã‹

### ã‚¹ãƒ†ãƒƒãƒ—3: extractUsedReferenceIndicesã®å®Ÿè¡Œ
- âš ï¸ ä½•ä»¶ã®å‚ç…§å…ƒãŒæŠ½å‡ºã•ã‚Œã¦ã„ã‚‹ã‹
- âš ï¸ å®Ÿéš›ã®AIå›ç­”ãŒã©ã®ã‚ˆã†ãªå½¢å¼ã§è¿”ã£ã¦ãã‚‹ã‹

### ã‚¹ãƒ†ãƒƒãƒ—4: finalReferencesã®æ±ºå®š
- âš ï¸ extractUsedReferenceIndicesãŒ0ä»¶ã®å ´åˆã€allReferencesï¼ˆ30ä»¶ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹

### ã‚¹ãƒ†ãƒƒãƒ—5: enhanceReferencesã®å®Ÿè¡Œ
- âš ï¸ immediateReferencesãŒä½•ä»¶è¿”ã£ã¦ãã¦ã„ã‚‹ã‹
- âš ï¸ enhancedReferencesã®IDå½¢å¼ãŒfinalReferencesã®IDå½¢å¼ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹

### ã‚¹ãƒ†ãƒƒãƒ—6: finalReferencesã¸ã®æ‹¡å¼µçµæœã®é©ç”¨
- âš ï¸ finalReferenceIdsã¨enhancedReferencesã®IDãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹
- âš ï¸ IDä¸ä¸€è‡´ãŒç™ºç”Ÿã—ã¦ã„ã‚‹å ´åˆã€ãã®åŸå› ã¯ä½•ã‹

### ã‚¹ãƒ†ãƒƒãƒ—7: finalReferencesã®æœ€çµ‚çš„ãªæ±ºå®š
- âš ï¸ æœ€çµ‚çš„ãªfinalReferencesãŒä½•ä»¶ã«ãªã£ã¦ã„ã‚‹ã‹

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ**: `scripts/test-jira-references-api-detailed.ts`ã‚’å®Ÿè¡Œ
2. **ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª**: å„ã‚¹ãƒ†ãƒƒãƒ—ã§ã®å‚ç…§å…ƒã®æ•°ã‚’ç¢ºèª
3. **IDä¸ä¸€è‡´ã®åŸå› ã‚’ç‰¹å®š**: `finalReferenceIds`ã¨`enhancedReferences`ã®IDå½¢å¼ã®é•ã„ã‚’ç¢ºèª

---

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `src/ai/flows/streaming-summarize-confluence-docs.ts`: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
- `scripts/test-jira-references-api-detailed.ts`: å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `src/lib/reference-enhancer.ts`: `enhanceReferences`ã®å®Ÿè£…

