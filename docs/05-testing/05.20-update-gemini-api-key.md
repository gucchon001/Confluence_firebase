# Gemini APIã‚­ãƒ¼æ›´æ–°æ‰‹é †

## âœ… å®Œäº†ã—ãŸä½œæ¥­

- `.env.local`ã«æ–°ã—ã„Gemini APIã‚­ãƒ¼ã‚’è¨­å®šæ¸ˆã¿
  - æ–°ã—ã„ã‚­ãƒ¼: `your-gemini-api-key`ï¼ˆå®Ÿéš›ã®ã‚­ãƒ¼ã¯`.env.local`ã‚’å‚ç…§ï¼‰

## ğŸ”„ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. GitHub Secretsã®æ›´æ–°ï¼ˆGitHub CLIã‚’ä½¿ç”¨ï¼‰

PowerShellã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```powershell
# æ–°ã—ã„Gemini APIã‚­ãƒ¼ã‚’GitHub Secretsã«è¨­å®š
# æ³¨æ„: å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šã—ã¦ãã ã•ã„ï¼ˆ.env.localã‹ã‚‰å–å¾—ï¼‰
gh secret set GEMINI_API_KEY --body "your-gemini-api-key"
```

ã¾ãŸã¯ã€`.env.local`ã‹ã‚‰è‡ªå‹•çš„ã«èª­ã¿è¾¼ã‚€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼š

```powershell
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œï¼ˆ.env.localã‹ã‚‰è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¿ã¾ã™ï¼‰
.\scripts\setup-github-secrets.ps1
```

**æ³¨æ„**: GitHub CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã€ã¾ãŸã¯èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€å…ˆã«ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```powershell
# GitHub CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
gh --version

# èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆ
gh auth login
```

### 2. è¨­å®šã®ç¢ºèª

```powershell
# GitHub Secretsã®ä¸€è¦§ã‚’ç¢ºèª
gh secret list
```

`GEMINI_API_KEY`ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€è¨­å®šã¯å®Œäº†ã§ã™ã€‚

### 3. Firebase Secret Managerã®æ›´æ–°

Firebase App Hostingã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€Secret Managerã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

```powershell
# .env.localã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€
Get-Content .env.local | ForEach-Object {
    if ($_ -match '^([^=]+)=(.*)$') {
        $name = $matches[1]
        $value = $matches[2]
        [Environment]::SetEnvironmentVariable($name, $value, "Process")
    }
}

# æ–°ã—ã„Gemini APIã‚­ãƒ¼ã‚’Secret Managerã«è¿½åŠ 
# æ³¨æ„: å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šã—ã¦ãã ã•ã„ï¼ˆ.env.localã‹ã‚‰å–å¾—ï¼‰
echo -n "your-gemini-api-key" | gcloud secrets versions add gemini_api_key `
  --project=confluence-copilot-ppjye `
  --data-file=-
```

ã¾ãŸã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼š

```powershell
.\scripts\setup-firebase-secrets.ps1
```

### 4. å‹•ä½œç¢ºèª

#### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ç¢ºèª

```powershell
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦APIã‚­ãƒ¼ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèª
npm run test -- src/tests/api/endpoints.test.ts
```

#### GitHub Actionsã§ã®ç¢ºèª

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹
2. Actionsã‚¿ãƒ–ã‚’é–‹ã
3. ä»»æ„ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œï¼ˆä¾‹: JiraåŒæœŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰
4. ãƒ­ã‚°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã‹ç¢ºèª

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

1. **å¤ã„APIã‚­ãƒ¼ã®ç„¡åŠ¹åŒ–**
   - [Google AI Studio](https://makersuite.google.com/app/apikey)ã§å¤ã„APIã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ã¦ãã ã•ã„
   - å¤ã„ã‚­ãƒ¼: `AIzaSyDgbOANBYpo-H5V9-HLwJR36fhNonSz4h4`ï¼ˆæ¼æ´©ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚‹ã‚­ãƒ¼ï¼‰

2. **`.env.local`ã¯Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„**
   - `.env.local`ã¯`.gitignore`ã§é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹å¿ƒé…ã¯ã‚ã‚Šã¾ã›ã‚“
   - ãŸã ã—ã€ä»–ã®ç’°å¢ƒï¼ˆGitHub Secretsã€Firebase Secret Managerï¼‰ã«ã‚‚è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

3. **APIã‚­ãƒ¼ã®å†ç™ºè¡Œ**
   - ã‚‚ã—æ–°ã—ã„ã‚­ãƒ¼ã‚‚å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€å†åº¦æ–°ã—ã„ã‚­ãƒ¼ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„
   - ãã®éš›ã¯ã€ã™ã¹ã¦ã®ç’°å¢ƒã§æ›´æ–°ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„

## ğŸ“ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] `.env.local`ã«æ–°ã—ã„Gemini APIã‚­ãƒ¼ã‚’è¨­å®š
- [ ] GitHub Secretsã‚’æ›´æ–°ï¼ˆ`gh secret set GEMINI_API_KEY`ï¼‰
- [ ] Firebase Secret Managerã‚’æ›´æ–°
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œç¢ºèª
- [ ] GitHub Actionsã§å‹•ä½œç¢ºèª
- [ ] Firebase App Hostingã§å‹•ä½œç¢ºèª
- [ ] å¤ã„APIã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### GitHub Secretsã®æ›´æ–°ï¼ˆ1è¡Œã‚³ãƒãƒ³ãƒ‰ï¼‰

```powershell
# æ³¨æ„: å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šã—ã¦ãã ã•ã„ï¼ˆ.env.localã‹ã‚‰å–å¾—ï¼‰
gh secret set GEMINI_API_KEY --body "your-gemini-api-key"
```

### Firebase Secret Managerã®æ›´æ–°ï¼ˆ1è¡Œã‚³ãƒãƒ³ãƒ‰ï¼‰

```powershell
# æ³¨æ„: å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šã—ã¦ãã ã•ã„ï¼ˆ.env.localã‹ã‚‰å–å¾—ï¼‰
echo -n "your-gemini-api-key" | gcloud secrets versions add gemini_api_key --project=confluence-copilot-ppjye --data-file=-
```
