# 品質テスト基準 (2025-11-22)

**作成日**: 2025年11月22日  
**目的**: パフォーマンス改善時に検索品質が低下しないことを保証

---

## 📋 品質テスト基準

### テストクエリ1

**クエリ**: `退会した会員が同じアドレス使ったらどんな表示がでますか`

**合格基準**: 検索結果の10位以内に以下のページが含まれること

- **ページ**: `045_【FIX】パスワード再設定機能`

---

### テストクエリ2

**クエリ**: `ユーザーが応募したら、その同一の求人には何日間応募できなくなるか`

**合格基準**: 検索結果の10位以内に以下のページが含まれること

- **ページ**: `014_【FIX】求人応募機能`

---

### 全体的な合格基準

**必須条件**: 上記のすべてのテストクエリで合格基準を満たすこと

---

## 🔍 品質テストの実施方法

### 1. テストスクリプトの作成

検索結果を確認するためのテストスクリプトを作成する必要があります。

### 2. テスト実行

```bash
# 品質テストを実行
npm run test:quality -- --query="退会した会員が同じアドレス使ったらどんな表示がでますか"
```

### 3. 結果確認

- 検索結果の上位10件に `045_【FIX】パスワード再設定機能` が含まれているか確認
- 含まれていない場合は、改善案を見直す必要がある

---

## ⚠️ パフォーマンス改善時の注意点

### 品質に影響を与える可能性のある改善

以下の改善は、検索品質に影響を与える可能性があります：

1. **Composite Scoringの結果数を削減（100件 → 50件）**
   - 影響: 中程度
   - 理由: スコアリング対象が減ることで、関連性の高いページが除外される可能性

2. **RRF融合処理の早期絞り込み（全件 → 100件）**
   - 影響: 中程度
   - 理由: RRF計算前に結果を絞り込むことで、関連性の高いページが除外される可能性

3. **タイトル救済検索の候補数を削減（10件 → 5件）**
   - 影響: 低
   - 理由: タイトル救済検索は補助的な機能のため、影響は限定的

4. **重複除去処理の最適化**
   - 影響: 低
   - 理由: 処理順序の変更のみで、結果は変わらない

---

## 📊 品質テストの実施計画

### Phase 1: ベースライン測定

1. 現在の実装で品質テストを実行
2. 検索結果の上位10件を記録
3. `045_【FIX】パスワード再設定機能` の順位を記録

### Phase 2: 改善案の評価

各改善案を個別に実装し、品質テストを実行：

1. **改善案1**: Composite Scoringの結果数を削減
   - 品質テストを実行
   - 合格基準を満たすか確認

2. **改善案2**: RRF融合処理の早期絞り込み
   - 品質テストを実行
   - 合格基準を満たすか確認

3. **改善案3**: タイトル救済検索の候補数を削減
   - 品質テストを実行
   - 合格基準を満たすか確認

4. **改善案4**: 重複除去処理の最適化
   - 品質テストを実行
   - 合格基準を満たすか確認

### Phase 3: 組み合わせテスト

複数の改善案を組み合わせて品質テストを実行：

1. 改善案1 + 改善案2
2. 改善案1 + 改善案2 + 改善案3
3. 改善案1 + 改善案2 + 改善案3 + 改善案4

---

## 🔧 品質テストスクリプトの作成

品質テストを自動化するスクリプトを作成する必要があります。

### スクリプトの要件

1. 指定されたクエリで検索を実行
2. 検索結果の上位10件を取得
3. 指定されたページが含まれているか確認
4. 結果をレポート形式で出力

---

## 📝 品質テスト結果の記録

品質テストの結果は、以下の形式で記録します：

```markdown
## 品質テスト結果

**日時**: 2025-11-22
**クエリ**: 退会した会員が同じアドレス使ったらどんな表示がでますか
**改善案**: [改善案の名前]

### 検索結果（上位10件）

1. [ページタイトル1]
2. [ページタイトル2]
...
10. [ページタイトル10]

### 結果

- ✅ **合格**: `045_【FIX】パスワード再設定機能` が10位以内に含まれている
- ❌ **不合格**: `045_【FIX】パスワード再設定機能` が10位以内に含まれていない

### 順位

`045_【FIX】パスワード再設定機能` の順位: [順位]
```

---

## 🔗 関連ドキュメント

- [クエリ3 パフォーマンス改善計画](./05.48-query3-performance-improvement-plan-2025-11-22.md)
- [クエリ3 詳細分析](./05.47-query3-detailed-analysis-2025-11-22.md)

