# Firebase Secret Manageræ›´æ–°æ‰‹é †

## ğŸš¨ ç·Šæ€¥å¯¾å¿œ

æœ¬ç•ªç’°å¢ƒã§Gemini APIã‚­ãƒ¼ãŒæœŸé™åˆ‡ã‚Œã«ãªã£ã¦ã„ã¾ã™ã€‚Firebase Secret Managerã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## æ–¹æ³•1: Firebase Consoleã‹ã‚‰æ›´æ–°ï¼ˆæ¨å¥¨ï¼‰

1. [Firebase Console](https://console.firebase.google.com/project/confluence-copilot-ppjye)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒSecret Managerã€ã‚’é¸æŠ
3. `gemini_api_key`ã‚’æ¤œç´¢
4. ã€Œæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. æ–°ã—ã„APIã‚­ãƒ¼ã‚’å…¥åŠ›: `AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM`
6. ã€Œè¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

## æ–¹æ³•2: gcloud CLIã‹ã‚‰æ›´æ–°

### å‰ææ¡ä»¶

1. Google Cloud CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
2. é©åˆ‡ãªæ¨©é™ã‚’æŒã¤ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨

```powershell
# 1. Google Cloudã«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§èªè¨¼ï¼‰
gcloud auth login

# 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®š
gcloud config set project confluence-copilot-ppjye

# 3. æ–°ã—ã„Gemini APIã‚­ãƒ¼ã‚’Secret Managerã«è¿½åŠ 
echo -n "AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM" | gcloud secrets versions add gemini_api_key --project=confluence-copilot-ppjye --data-file=-

# 4. æ›´æ–°ã‚’ç¢ºèª
gcloud secrets versions list gemini_api_key --project=confluence-copilot-ppjye
```

### æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

Firebase Service Accountã«ã¯Secret Managerã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’è¡Œã£ã¦ãã ã•ã„ï¼š

1. **å€‹äººã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³**:
   ```powershell
   gcloud auth login
   ```

2. **IAMæ¨©é™ã‚’ç¢ºèª**:
   - [Google Cloud Console](https://console.cloud.google.com/iam-admin/iam?project=confluence-copilot-ppjye)ã«ã‚¢ã‚¯ã‚»ã‚¹
   - è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«`Secret Manager Admin`ãƒ­ãƒ¼ãƒ«ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. **Firebase Consoleã‹ã‚‰æ‰‹å‹•æ›´æ–°**ï¼ˆæ–¹æ³•1ã‚’æ¨å¥¨ï¼‰

## æ–¹æ³•3: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰

```powershell
# .env.localã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€
Get-Content .env.local | ForEach-Object {
    if ($_ -match '^GEMINI_API_KEY=(.*)$') {
        $env:GEMINI_API_KEY = $matches[1]
    }
}

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
.\scripts\setup-firebase-secrets.ps1
```

## æ›´æ–°å¾Œã®ç¢ºèª

1. **Secret Managerã§ç¢ºèª**:
   ```powershell
   gcloud secrets versions list gemini_api_key --project=confluence-copilot-ppjye
   ```

2. **æœ¬ç•ªç’°å¢ƒã®ãƒ­ã‚°ã‚’ç¢ºèª**:
   - [Firebase Console](https://console.firebase.google.com/project/confluence-copilot-ppjye/logs)ã§ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤**ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰:
   ```powershell
   firebase deploy --only hosting
   ```

## æ³¨æ„äº‹é …

- Secret Managerã®æ›´æ–°ã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ï¼ˆå†ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ä¸è¦ï¼‰
- æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨ã€è‡ªå‹•çš„ã«æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™
- å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯å‰Šé™¤ã›ãšã«æ®‹ã—ã¦ãŠãã“ã¨ã‚’æ¨å¥¨ï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Permission denied"

- å€‹äººã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- IAMæ¨©é™ã‚’ç¢ºèªï¼ˆ`Secret Manager Admin`ãƒ­ãƒ¼ãƒ«ãŒå¿…è¦ï¼‰

### ã‚¨ãƒ©ãƒ¼: "Secret not found"

- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€å…ˆã«ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
  ```powershell
  echo -n "AIzaSyD6h4V0PENM6YiGHwlW3uq3hQB2JzwUAZM" | gcloud secrets create gemini_api_key --project=confluence-copilot-ppjye --data-file=-
  ```

