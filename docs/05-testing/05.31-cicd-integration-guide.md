# CI/CD統合ガイド

## 📋 概要

GitHub Actionsを使用してテストを自動実行する仕組みを実装しました。

## 🚀 ワークフローの動作

### 自動実行タイミング

1. **プルリクエスト時**
   - mainブランチまたはdevelopブランチへのプルリクエスト時に自動実行

2. **プッシュ時**
   - mainブランチへのプッシュ時に自動実行

3. **手動実行**
   - GitHub Actionsページから手動で実行可能
   - テストタイプを選択可能（all, unit, integration, api, deployment）

### 実行されるテスト

1. **TypeScript型チェック**
   - `npm run typecheck`を実行

2. **ユニットテスト**
   - `npm run test:unit`を実行

3. **統合テスト**
   - `npm run test:integration`を実行
   - 環境変数が設定されている

4. **APIエンドポイントテスト**
   - `npm run test -- src/tests/api`を実行
   - 環境変数が設定されている

5. **デプロイ前検証テスト**
   - `npm run test -- src/tests/deployment`を実行
   - 環境変数が設定されている
   - ビルドテストはスキップ（時間がかかるため）

## 📝 使用方法

### プルリクエスト時の自動実行

1. プルリクエストを作成
2. GitHub Actionsが自動的にテストを実行
3. テスト結果をプルリクエストページで確認

### 手動実行

1. GitHubリポジトリの「Actions」タブにアクセス
2. 「Tests」ワークフローを選択
3. 「Run workflow」ボタンをクリック
4. テストタイプを選択（all, unit, integration, api, deployment）
5. 「Run workflow」を再度クリックして実行

### テストタイプの選択

- **all**: すべてのテストを実行（デフォルト）
- **unit**: ユニットテストのみ実行
- **integration**: 統合テストのみ実行
- **api**: APIエンドポイントテストのみ実行
- **deployment**: デプロイ前検証テストのみ実行

## ⚙️ 必要なGitHub Secrets

以下のシークレットがGitHubリポジトリに設定されている必要があります：

| Secret名 | 説明 |
|---------|------|
| `CONFLUENCE_BASE_URL` | ConfluenceベースURL |
| `CONFLUENCE_USER_EMAIL` | Confluenceユーザーメールアドレス |
| `CONFLUENCE_API_TOKEN` | Confluence APIトークン |
| `CONFLUENCE_SPACE_KEY` | Confluenceスペースキー |
| `GEMINI_API_KEY` | Gemini APIキー |
| `NEXT_PUBLIC_FIREBASE_API_KEY` | Firebase APIキー |
| `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN` | Firebase認証ドメイン |
| `NEXT_PUBLIC_FIREBASE_PROJECT_ID` | FirebaseプロジェクトID |
| `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET` | Firebaseストレージバケット |
| `NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID` | Firebaseメッセージング送信者ID |
| `NEXT_PUBLIC_FIREBASE_APP_ID` | FirebaseアプリID |
| `GOOGLE_APPLICATION_CREDENTIALS` | Google Cloud認証情報（JSON） |

## 🔍 テスト結果の確認

### GitHub Actionsページで確認

1. GitHubリポジトリの「Actions」タブにアクセス
2. 「Tests」ワークフローを選択
3. 実行履歴から確認したい実行をクリック
4. 各ステップの詳細ログを確認

### プルリクエストページで確認

1. プルリクエストページにアクセス
2. 「Checks」タブでテスト結果を確認
3. 失敗したテストの詳細を確認

## 📊 テスト結果のアーティファクト

テスト実行後、以下のアーティファクトがアップロードされます：

- `coverage/`: テストカバレッジレポート
- `test-results/`: テスト結果レポート

アーティファクトは7日間保持されます。

## ⚠️ 注意事項

1. **環境変数の設定**
   - すべての必要なGitHub Secretsが設定されていることを確認してください
   - シークレットが設定されていない場合、テストが失敗する可能性があります

2. **ビルドテストのスキップ**
   - デプロイ前検証テストでは、ビルドテストがスキップされます（時間がかかるため）
   - 実際のビルドをテストする場合は、手動で実行してください

3. **テスト実行時間**
   - すべてのテストを実行する場合、数分かかる可能性があります
   - 特定のテストタイプのみを実行することで、実行時間を短縮できます

## 🔗 関連ドキュメント

- [GitHub Actionsワークフローテスト状況](./05.17-github-actions-test-status.md)
- [デプロイ前検証テスト](./05.07-production-readiness-verification.md)
- [テスト実行ガイド](./05.08-test-execution-guide.md)

