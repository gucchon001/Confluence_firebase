# ベースライン品質テスト (2025-11-22)

**作成日**: 2025年11月22日  
**目的**: 現在の実装での検索品質を測定し、改善案の評価基準とする

---

## 📋 テスト設定

### テストクエリ

**クエリ**: `退会した会員が同じアドレス使ったらどんな表示がでますか`

### 合格基準

**必須条件**: 検索結果の10位以内に以下のページが含まれること

- **ページ**: `045_【FIX】パスワード再設定機能`

---

## 🔧 テスト実行方法

### 1. 環境変数の確認

`.env.local`ファイルに以下の環境変数が設定されていることを確認：

- `GEMINI_API_KEY`
- `CONFLUENCE_BASE_URL`
- `CONFLUENCE_USER_EMAIL`
- `CONFLUENCE_API_TOKEN`
- `CONFLUENCE_SPACE_KEY`

### 2. テスト実行

```bash
npm run test:search-quality -- --query="退会した会員が同じアドレス使ったらどんな表示がでますか" --target="045_【FIX】パスワード再設定機能"
```

---

## 📊 テスト結果

### ステータス

- ✅ **完了**: 2025年11月22日

### ベースライン結果

#### 検索結果（上位10件）

1. 【FIX】会員：指導可能科目 (Page ID: 714932317)
2. 046_【FIX】会員退会機能 (Page ID: 704643076)
3. 434_【FIX】会員情報編集機能 (Page ID: 704741457)
4. 041_【FIX】会員新規登録機能 (Page ID: 702906392)
5. 430_【作成中】会員管理機能 (Page ID: 704479585)
6. **045_【FIX】パスワード再設定機能** (Page ID: 703594590) ⭐
7. 042_【FIX】会員ログイン・ログアウト機能 (Page ID: 703889475)
8. ユーザー登録・退会フロー（テンプレ） (Page ID: 666927160)
9. 433_【作成中】会員情報詳細閲覧機能 (Page ID: 704053700)
10. 431_【FIX】会員情報一覧閲覧・検索機能 (Page ID: 713392189)

#### 対象ページの順位

- **`045_【FIX】パスワード再設定機能`**: **6位** ✅

#### テスト結果

- ✅ **合格**: 対象ページが10位以内に含まれている（6位）

#### パフォーマンス

- **検索時間**: 10399ms (約10.4秒)
- **検索結果数**: 30件
- **BM25検索時間**: 7032ms (約7.0秒)
- **ベクトル検索時間**: 1608ms (約1.6秒)

---

## 📝 ベースライン記録

### 検索品質

- **対象ページの順位**: 6位
- **合格基準**: 10位以内 ✅
- **マージン**: 4位の余裕

### パフォーマンス

- **検索処理完了時間**: 10399ms
- **目標**: 2000ms以下
- **改善が必要**: 約5.2倍の削減が必要

---

## 🔍 分析

### 検索品質の評価

現在の実装では、対象ページが6位に含まれており、合格基準（10位以内）を満たしています。4位のマージンがあるため、パフォーマンス改善を行っても品質を維持できる可能性が高いです。

### パフォーマンスの評価

検索時間が約10.4秒と長く、目標の2000ms以下を大きく上回っています。特にBM25検索が7.0秒と長いため、改善の余地があります。

### 改善案の影響予測

1. **Composite Scoringの結果数を削減（100件 → 50件）**
   - 影響: 中程度
   - 予測: 6位のマージンがあるため、品質への影響は限定的

2. **RRF融合処理の早期絞り込み（全件 → 100件）**
   - 影響: 中程度
   - 予測: 6位のマージンがあるため、品質への影響は限定的

3. **タイトル救済検索の候補数を削減（10件 → 5件）**
   - 影響: 低
   - 予測: 品質への影響はほとんどない

4. **重複除去処理の最適化**
   - 影響: 低
   - 予測: 品質への影響はない

---

## 🔗 関連ドキュメント

- [品質テスト基準](./05.50-quality-test-criteria-2025-11-22.md)
- [クエリ3 パフォーマンス改善計画](./05.48-query3-performance-improvement-plan-2025-11-22.md)

