# 主要機能関連テスト

検索、要約、ストリーミング等の主要機能の動作確認を行うテストです。

## 📚 関連ドキュメント

テストを理解するために、以下のドキュメントを参照してください：

- **[ハイブリッド検索システム仕様](../../architecture/02.01.02-hybrid-search-specification.md)**: ハイブリッド検索の完全仕様書
- **[ハイブリッド検索クイックリファレンス](../../architecture/02.01.01-hybrid-search-quick-reference.md)**: ハイブリッド検索のクイックリファレンス
- **[プロンプト設計](../../architecture/03.02.01-prompt-design.md)**: AIプロンプトの設計仕様
- **[Confluence検索システム仕様](../../specifications/confluence-spec.md)**: Confluenceページの検索・要約機能の詳細仕様
- **[Jira検索システム仕様](../../specifications/jira-spec.md)**: Jira課題の検索・要約機能の詳細仕様
- **[システム全体仕様書](../../specifications/spec.md)**: システム全体の機能要件と技術スタック

## 🚀 テスト実行方法

### 一括実行

```bash
# Windows
scripts\run-feature-tests.bat

# または npm script
npm run test:feature

# または直接実行
npx tsx src/tests/runners/feature-tests-runner.ts
```

### 個別実行

各テストは個別に実行することもできます。詳細は各テストの説明を参照してください。

## 📋 テスト項目

### 1. 検索品質テスト

#### 1.1 基本検索テスト

**目的**: 基本的な検索機能が正しく動作しているか確認

**テストケース**: [`phase-0a-4-test-criteria.md`](./phase-0a-4-test-criteria.md)を参照

**主要クエリ**:
1. 退会した会員が再度登録することは可能ですか → `046_【FIX】退会機能`
2. 教室削除ができないのは何が原因ですか → `164_【FIX】教室削除機能`
3. 教室コピーでコピーされる項目を教えてください → `168_【FIX】教室コピー機能`
4. 塾講師が同時に何件まで応募できるか教えてください → `014_【FIX】応募機能`
5. 重複応募不可期間はいつからいつまでですか → `014_【FIX】応募機能`
6. 塾講師プロフィールの学年・職業を更新する方法を教えてください → `721_【FIX】塾講師-学年・職業更新機能`

**実行方法**:
```bash
# 一括実行（推奨）
scripts\run-feature-tests.bat
# または
npx tsx src/tests/runners/feature-tests-runner.ts

# 個別実行
npx tsx src/tests/classroom-deletion-issue-search-test.ts
npx tsx src/tests/classroom-deletion-keyword-quality-test.ts
npx tsx src/tests/classroom-management-search-test.ts

# npm scripts（利用可能な場合）
npm run test:search-ranking-classroom-deletion
npm run test:label-and-title-matching
```

**確認項目**:
- [ ] 期待されるページが検索結果の上位に表示される
- [ ] 検索時間が目標値以内（2秒以下）
- [ ] 検索結果の関連性が高い

#### 1.2 教室管理検索品質テスト

**詳細**: [`case_classroom-management-search-quality-test.md`](./case_classroom-management-search-quality-test.md)を参照

**確認項目**:
- [ ] 教室削除機能が正しく検索される
- [ ] ラベルマッチングが正しく動作する
- [ ] タイトルマッチングが正しく動作する

#### 1.3 Jira検索品質テスト

**詳細**: [`jira-quality-testcases.md`](./jira-quality-testcases.md)を参照

**確認項目**:
- [ ] Jiraイシューが正しく検索される
- [ ] イシューのフィールドが正しく表示される
- [ ] Jira固有の検索が正しく動作する

### 2. 回答生成テスト

#### 2.1 ストリーミング要約

**目的**: ストリーミング要約が正しく動作しているか確認

**実行方法**:
```bash
# 一括実行
scripts\run-feature-tests.bat

# 個別実行
npx tsx src/tests/test-streaming-direct.ts
```

**確認項目**:
- [ ] ストリーミングが正常に開始される
- [ ] チャンクが順次配信される
- [ ] 回答が完全に生成される
- [ ] 参照元が正しく表示される

#### 2.2 参照元フィルタリング

**目的**: 実際に使用された参照元のみが表示されるか確認

**確認項目**:
- [ ] 参照元が正しく抽出される
- [ ] 使用されていない参照元が除外される
- [ ] 参照元のURLが正しい

### 3. ハイブリッド検索テスト

#### 3.1 ベクトル検索

**目的**: ベクトル検索が正しく動作しているか確認

**実行方法**:
```bash
# 一括実行
scripts\run-feature-tests.bat

# 個別実行
npx tsx src/tests/vector-search-quality-test.ts
npx tsx src/tests/vector-search-consistency-test.ts
```

**確認項目**:
- [ ] ベクトル検索が実行される
- [ ] 検索結果の距離が正しく計算される
- [ ] 検索結果の順位が適切

#### 3.2 BM25検索

**目的**: キーワード検索（BM25）が正しく動作しているか確認

**確認項目**:
- [ ] Lunrインデックスが使用される
- [ ] キーワードマッチングが正しく動作する
- [ ] 検索結果のスコアが適切

#### 3.3 ハイブリッド統合

**目的**: ベクトル検索とBM25検索の統合が正しく動作しているか確認

**実行方法**:
```bash
# 一括実行
scripts\run-feature-tests.bat

# 個別実行
npx tsx src/tests/real-hybrid-search-test.ts
```

**確認項目**:
- [ ] 両方の検索結果が統合される
- [ ] RRF（Reciprocal Rank Fusion）が正しく適用される
- [ ] 最終的な検索結果の順位が適切

### 4. ラベル・タイトルマッチングテスト

**実行方法**:
```bash
# 一括実行
scripts\run-feature-tests.bat

# 個別実行
npx tsx src/tests/keyword-quality-test.ts

# npm scripts（利用可能な場合）
npm run test:label-and-title-matching
npm run test:feature-name-matching
```

**確認項目**:
- [ ] ラベルマッチングが正しく動作する
- [ ] タイトルマッチングが正しく動作する
- [ ] スコアリングが適切

## 📊 テスト結果

### Phase 0A-4 テスト基準

詳細なテスト基準と結果は [`05-phase-0a-4-test-criteria.md`](./05-phase-0a-4-test-criteria.md) を参照してください。

**主要テストケース**:
1. 退会した会員が再度登録することは可能ですか → `046_【FIX】退会機能`
2. 教室削除ができないのは何が原因ですか → `164_【FIX】教室削除機能`
3. 教室コピーでコピーされる項目を教えてください → `168_【FIX】教室コピー機能`
4. 塾講師が同時に何件まで応募できるか教えてください → `014_【FIX】応募機能`
5. 重複応募不可期間はいつからいつまでですか → `014_【FIX】応募機能`
6. 塾講師プロフィールの学年・職業を更新する方法を教えてください → `721_【FIX】塾講師-学年・職業更新機能`

### Phase 4 テスト実行結果

詳細な実行結果は [`06-phase-4-test-execution.md`](./06-phase-4-test-execution.md) を参照してください。

### 教室管理検索品質テスト

詳細なテスト仕様は [`07-case-classroom-management-search-quality-test.md`](./07-case-classroom-management-search-quality-test.md) を参照してください。

### Jira品質テストケース

詳細なテストケースは [`08-jira-quality-testcases.md`](./08-jira-quality-testcases.md) を参照してください。

## 🔄 定期的な実行

以下のテストは定期的に実行することを推奨します：

- **検索品質**: 検索アルゴリズム変更後、データ更新後
- **回答生成**: AIモデル変更後、プロンプト変更後
- **ハイブリッド検索**: 検索ロジック変更後

