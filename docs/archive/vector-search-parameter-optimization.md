# Vector Search パラメータ最適化

## 検索パラメータの調整

Vector Search APIの検索結果を改善するため、以下のパラメータを調整しました。

### 1. `neighborCount`

- **説明**: 検索結果として返される近傍（類似ドキュメント）の最大数
- **調整前**: 5
- **調整後**: 10
- **効果**: より多くの検索結果を取得することで、関連性の高いドキュメントが見つかる可能性が高まります

### 2. `distanceThreshold`

- **説明**: 検索結果として含める最大距離（類似度の閾値）
- **調整前**: 0.8
- **調整後**: 0.95
- **効果**: 閾値を緩和することで、完全一致ではないが関連性のあるドキュメントも検索結果に含めることができます

## 実装箇所

```typescript
// src/ai/flows/retrieve-relevant-docs.ts
const searchResults = await searchVectorIndex({
  embeddingVector,
  neighborCount: 10, // 近傍数を5から10に増加
  distanceThreshold: 0.95 // 類似度の閾値を0.8から0.95に緩和（0.0〜1.0）
});
```

## パラメータ調整のガイドライン

### `neighborCount`の調整

- **少なすぎる場合**: 関連性の高いドキュメントが見つからない可能性がある
- **多すぎる場合**: ノイズが増え、関連性の低いドキュメントも含まれる可能性がある
- **推奨範囲**: 5～20（用途によって調整）

### `distanceThreshold`の調整

- **小さすぎる場合（例: 0.5）**: 厳格な一致のみ返され、結果が少なくなる
- **大きすぎる場合（例: 0.99）**: 関連性の低いドキュメントも多く含まれる
- **推奨範囲**: 0.7～0.95（データの性質によって調整）

## 今後の最適化方針

1. **段階的なパラメータ調整**:
   - 検索結果が0件の場合、徐々に`distanceThreshold`を上げる
   - 検索結果が多すぎる場合、徐々に`distanceThreshold`を下げる

2. **ユーザーフィードバックに基づく調整**:
   - 検索結果の関連性に基づいて最適なパラメータを特定

3. **検索クエリの拡張**:
   - 元のクエリを拡張して検索精度を向上させる
   - 例: 同義語の追加、キーワード抽出など
