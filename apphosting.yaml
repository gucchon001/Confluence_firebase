# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

runConfig:
  # インスタンス設定（コールドスタート軽減のためminを1に）
  minInstances: 1
  maxInstances: 4
  
  # メモリ設定（埋め込みモデル + インメモリDB対応）
  memoryMiB: 4096
  
  # CPU設定
  cpu: 2
  
  # Phase 0A-4 FIX: Cloud Run Gen2への移行（高速インメモリファイルシステム）
  # Gen2の利点:
  # - /dev/shm (tmpfs) による高速メモリI/O
  # - enrichWithAllChunks: 31秒 → 1秒未満
  # - 検索全体: 66.6秒 → 10秒以内（目標）
  executionEnvironment: gen2

# 環境変数（runConfigと同じレベル）
env:
  # Next.js Public環境変数（ビルド時とランタイム時に必要）
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    value: AIzaSyAgaGihnyshajIN2YC7CdJR_H0bJMg_hkI
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
    value: confluence-copilot-ppjye.firebaseapp.com
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
    value: confluence-copilot-ppjye
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
    value: confluence-copilot-ppjye.firebasestorage.app
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: "122015916118"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_APP_ID
    value: 1:122015916118:web:50d117434b1318f173dbf7
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_USE_MOCK_DATA
    value: "false"
    availability:
      - BUILD
      - RUNTIME
  
  # Confluence API（ランタイムのみ）
  - variable: CONFLUENCE_BASE_URL
    value: https://giginc.atlassian.net
    availability:
      - RUNTIME
  
  - variable: CONFLUENCE_USER_EMAIL
    value: kanri@jukust.jp
    availability:
      - RUNTIME
  
  - variable: CONFLUENCE_API_TOKEN
    secret: confluence_api_token
    availability:
      - RUNTIME
  
  - variable: CONFLUENCE_SPACE_KEY
    value: CLIENTTOMO
    availability:
      - RUNTIME
  
  # Google Cloud（ビルド時とランタイムの両方）
  - variable: GOOGLE_CLOUD_PROJECT
    value: confluence-copilot-ppjye
    availability:
      - BUILD
      - RUNTIME
  
  # Gemini API（ビルド時とランタイムの両方）
  - variable: GEMINI_API_KEY
    secret: gemini_api_key
    availability:
      - BUILD
      - RUNTIME
  
  # その他（ランタイムのみ）
  - variable: EMBEDDINGS_PROVIDER
    value: local
    availability:
      - RUNTIME
  
  - variable: USE_LLM_EXPANSION
    value: "true"
    availability:
      - RUNTIME
  
  # ビルド最適化: データダウンロードをスキップ（実行時にCloud Storageから直接読み込む）
  # Note: false = ビルド時にダウンロード, true = 実行時に読み込み
  # Phase 0A-4 Step 2: インメモリFSを使用するため、ビルド時ダウンロードをスキップ
  - variable: SKIP_DATA_DOWNLOAD
    value: "true"
    availability:
      - BUILD
      - RUNTIME
  
  # Phase 0A-4 Step 2: インメモリファイルシステムを再有効化（import修正済み）
  - variable: USE_INMEMORY_FS
    value: "true"
    availability:
      - RUNTIME
  
  # Cloud Storage設定（インメモリローダー用）
  - variable: STORAGE_BUCKET
    value: confluence-firebase-c3a86.firebasestorage.app
    availability:
      - RUNTIME